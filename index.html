<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>LANA â¤ï¸ ANAS</title>
<style>
	/* ===== FIX MOBILE SCROLL (OPTION 6) ===== */
html, body {
  height: auto !important;
  min-height: 100% !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
  -webkit-overflow-scrolling: touch;
}

body {
  position: relative !important;
  touch-action: pan-y;
}

.page {
  position: relative;      /* âœ… Ø¨Ø¯Ù„ fixed */
  width: 100%;
  min-height: 100vh;       /* âœ… Ø¨Ø¯Ù„ height */
  overflow-y: auto;        /* âœ… */
  overflow-x: hidden;
}
}
	.kitCakeStage{position:relative; width:100%; height:100%;}

.kitCakePlate{
  position:absolute; left:50%; bottom:6%;
  transform:translateX(-50%);
  width:72%; height:16%;
  border-radius:999px;
  box-shadow:0 10px 30px rgba(0,0,0,.25);
  filter:saturate(1.05);
}
.kitCakeLayer{
  position:absolute; left:50%;
  transform:translateX(-50%);
  width:56%; height:10%;
  border-radius:18px;
  box-shadow:0 10px 18px rgba(0,0,0,.22);
  background-image:
    linear-gradient(to bottom, rgba(255,255,255,.20), rgba(0,0,0,.18));
}
.kitCakeCream{
  position:absolute; left:50%;
  transform:translateX(-50%);
  width:56%; height:3.5%;
  border-radius:999px;
  box-shadow:0 6px 12px rgba(0,0,0,.18);
  opacity:.95;
}

.kitCakeFilling{
  position:absolute; top:10px; left:10px;
  padding:8px 10px;
  background:rgba(0,0,0,.25);
  border:1px solid rgba(255,255,255,.15);
  border-radius:14px;
  backdrop-filter: blur(8px);
  font-weight:700;
  color:#fff;
}

/* mini (deco board) */
.kitMiniWrap{width:100%; height:100%;}
.kitCakePlate.kitMini{width:66%; height:14%;}
.kitCakeLayer.kitMini{width:52%; height:9%;}
.kitCakeCream.kitMini{width:52%; height:3%;}
.kitCakeFilling.kitMini{transform:scale(.9); transform-origin:top left;}

.kitDecoStage{position:relative; width:100%; height:100%;}
.kitDecoOverlay{
  position:absolute; inset:0;
}
:root{
--bg1:#160614;
--bg2:#2a0b22;
--bg3:#3a0f2d;

--glass: rgba(255,255,255,.08);
--glass2: rgba(255,255,255,.12);
--stroke: rgba(255,255,255,.16);
--txt: rgba(255,255,255,.92);
--muted: rgba(255,255,255,.70);
--muted2: rgba(255,255,255,.55);
--accent:#ff2d55;
--accent2:#ff4d7d;
--ok:#22c55e;
--bad:#ef4444;

--sea1:#051b2c;
--sea2:#06354a;
--sea3:#0b5d70;
--seaGlow: rgba(0,210,255,.18);
--rain: rgba(255,255,255,.22);
--wave: rgba(255,255,255,.08);

/* âœ… Puzzle theme */
--puz1:#070b18;
--puz2:#101a3a;
--puz3:#2a1a4a;
--puzGlow: rgba(160,140,255,.18);
--puzDrop: rgba(255,255,255,.18);
--puzTile: rgba(255,255,255,.07);
--puzTile2: rgba(255,255,255,.11);
--puzStroke: rgba(255,255,255,.14);
}
*{box-sizing:border-box}
html,body{height:100%}

/* âœ… FIX: Ù„Ø§ Ù†Ø®Ù„ÙŠ body Ù…Ù‚ÙÙˆÙ„ (ÙƒØ§Ù† overflow:hidden) */
body{
margin:0;
font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans Arabic", "Noto Kufi Arabic", sans-serif;
color:var(--txt);
overflow:auto; /* âœ… Ù…Ù‡Ù… */
background:
radial-gradient(1100px 700px at 10% 10%, rgba(255,45,85,.18), transparent 60%),
radial-gradient(900px 600px at 90% 20%, rgba(255,77,125,.16), transparent 60%),
radial-gradient(1000px 700px at 70% 95%, rgba(255,45,85,.14), transparent 55%),
linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
transition: background .35s ease;
}

.vignette{
position:fixed; inset:0;
pointer-events:none;
background: radial-gradient(900px 600px at 50% 0%, rgba(255,255,255,.06), transparent 60%),
radial-gradient(900px 700px at 50% 100%, rgba(0,0,0,.35), transparent 55%);
mix-blend-mode: screen;
z-index:0;
}

.hearts{
position:fixed; inset:-20vh 0 0 0;
pointer-events:none;
overflow:hidden;
filter: drop-shadow(0 8px 18px rgba(0,0,0,.35));
transition: opacity .25s ease;
z-index:2;
}
.heart{
position:absolute;
top:-20vh;
font-size:22px;
opacity:.95;
animation: fall linear infinite;
will-change: transform;
text-shadow: 0 12px 24px rgba(0,0,0,.35);
}
@keyframes fall{
to{ transform: translateY(130vh) rotate(25deg); }
}

body.seaTheme{
background:
radial-gradient(1100px 700px at 20% 10%, var(--seaGlow), transparent 60%),
radial-gradient(900px 600px at 80% 20%, rgba(0,210,255,.12), transparent 60%),
radial-gradient(1000px 700px at 60% 95%, rgba(0,150,255,.10), transparent 55%),
linear-gradient(135deg, var(--sea1), var(--sea2), var(--sea3));
}
body.seaTheme .hearts{ opacity:.12; }

.rain{
position:fixed; inset:-20vh 0 0 0;
pointer-events:none;
overflow:hidden;
display:none;
opacity:0;
transition: opacity .25s ease;
filter: drop-shadow(0 14px 25px rgba(0,0,0,.35));
z-index:1;
}
body.seaTheme .rain{
display:block;
opacity:1;
}
.drop{
position:absolute;
top:-25vh;
width:2px;
height:18px;
background: linear-gradient(to bottom, rgba(255,255,255,0), var(--rain), rgba(255,255,255,0));
border-radius:999px;
animation: rainFall linear infinite;
will-change: transform;
opacity:.7;
}
@keyframes rainFall{
to{ transform: translateY(140vh) translateX(6vw); }
}

.seaEmojis{
position:fixed; inset:-22vh 0 0 0;
pointer-events:none;
overflow:hidden;
display:none;
opacity:0;
transition: opacity .25s ease;
filter: drop-shadow(0 14px 25px rgba(0,0,0,.35));
z-index:3;
}
body.seaTheme .seaEmojis{
display:block;
opacity:1;
}
.seaEmoji{
position:absolute;
top:-25vh;
font-size:22px;
opacity:.95;
animation: emojiFall linear infinite;
will-change: transform;
text-shadow: 0 12px 24px rgba(0,0,0,.35);
}
@keyframes emojiFall{
to{ transform: translateY(140vh) translateX(8vw) rotate(25deg); }
}

.waves{
position:fixed; left:0; right:0; bottom:-12vh; height:40vh;
pointer-events:none;
display:none;
opacity:0;
transition: opacity .25s ease;
background:
radial-gradient(60% 70% at 10% 40%, rgba(255,255,255,.08), transparent 60%),
radial-gradient(55% 65% at 35% 55%, rgba(255,255,255,.06), transparent 60%),
radial-gradient(60% 70% at 65% 45%, rgba(255,255,255,.07), transparent 60%),
radial-gradient(55% 65% at 90% 55%, rgba(255,255,255,.06), transparent 60%);
filter: blur(8px);
mix-blend-mode: screen;
animation: waveMove 7s ease-in-out infinite;
z-index:1;
}
@keyframes waveMove{
0%{ transform: translateY(0) translateX(0); }
50%{ transform: translateY(-10px) translateX(-12px); }
100%{ transform: translateY(0) translateX(0); }
}
body.seaTheme .waves{
display:block;
opacity:1;
}

body.puzzleTheme{
background:
radial-gradient(950px 620px at 15% 10%, var(--puzGlow), transparent 62%),
radial-gradient(900px 600px at 85% 22%, rgba(110,230,255,.10), transparent 62%),
radial-gradient(1000px 700px at 65% 96%, rgba(255,90,190,.10), transparent 58%),
linear-gradient(135deg, var(--puz1), var(--puz2), var(--puz3));
}
body.puzzleTheme .hearts{ opacity:.10; }
body.puzzleTheme .rain{ opacity:0; display:none; }
body.puzzleTheme .seaEmojis{ opacity:0; display:none; }
body.puzzleTheme .waves{ opacity:0; display:none; }

.puzzleRain{
position:fixed; inset:-20vh 0 0 0;
pointer-events:none;
overflow:hidden;
display:none;
opacity:0;
transition: opacity .25s ease;
filter: drop-shadow(0 14px 25px rgba(0,0,0,.35));
z-index:1;
}
body.puzzleTheme .puzzleRain{
display:block;
opacity:1;
}
.puzDrop{
position:absolute;
top:-25vh;
width:16px;
height:16px;
border-radius:6px;
background:
radial-gradient(12px 12px at 30% 30%, rgba(255,255,255,.18), transparent 60%),
linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.06));
border:1px solid rgba(255,255,255,.12);
animation: puzFall linear infinite;
will-change: transform;
opacity:.65;
transform: rotate(15deg);
box-shadow: 0 10px 25px rgba(0,0,0,.20);
}
.puzDrop::after{
content:"";
position:absolute;
width:6px; height:6px;
border-radius:999px;
left:50%; top:-3px;
transform: translateX(-50%);
background: rgba(255,255,255,.12);
border:1px solid rgba(255,255,255,.10);
filter: blur(.2px);
}
@keyframes puzFall{
to{ transform: translateY(145vh) translateX(8vw) rotate(120deg); }
}

/* âœ… FIX: wrap ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± + safe area */
.wrap{
position:relative;
min-height:100%;
display:flex;
align-items:flex-start;
justify-content:center;
padding: calc(22px + env(safe-area-inset-top)) 22px calc(22px + env(safe-area-inset-bottom));
z-index:5;
}

/* âœ… FIX: card = Ø¹Ù…ÙˆØ¯ + inner scroll */
.card{
width:min(860px, 96vw);
max-height: calc(100vh - 44px);
display:flex;
flex-direction:column;
border-radius:26px;
background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
border:1px solid var(--stroke);
box-shadow: 0 18px 60px rgba(0,0,0,.45);
backdrop-filter: blur(16px);
-webkit-backdrop-filter: blur(16px);
overflow:hidden;
}

/* âœ… inner ÙŠØµÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø³ÙƒØ±ÙˆÙ„ */
.inner{
padding:28px 28px 22px;
overflow:auto;
-webkit-overflow-scrolling: touch;
flex:1;
}
@media (max-width:520px){
.inner{ padding:18px 16px 18px; }
.card{ max-height: calc(100vh - 24px); }
}

.center{text-align:center}

.titleBig{
font-size: clamp(30px, 4.1vw, 44px);
letter-spacing:.5px;
margin:0 0 8px;
font-weight:800;
}
.sub{
margin:0;
color:var(--muted);
font-size: clamp(14px, 2.2vw, 18px);
line-height:1.9;
}

.divider{
height:1px;
background: linear-gradient(90deg, transparent, rgba(255,255,255,.18), transparent);
margin:18px 0;
}

.loginPanel{
width:min(700px, 92vw);
margin:0 auto;
padding:20px;
border-radius:22px;
background: rgba(0,0,0,.12);
border:1px solid rgba(255,255,255,.12);
}
.inputs{
display:grid;
grid-template-columns: 1fr 1fr;
gap:12px;
margin-top:14px;
}
@media (max-width:700px){
.inputs{ grid-template-columns:1fr; }
}
.inp{
width:100%;
padding:14px 14px;
border-radius:16px;
border:1px solid rgba(255,255,255,.14);
outline:none;
background: rgba(0,0,0,.18);
color:var(--txt);
font-size:16px;
}
.inp::placeholder{ color: rgba(255,255,255,.55); }
.btn{
width:100%;
margin-top:14px;
padding:14px 16px;
border:0;
border-radius:18px;
font-weight:800;
font-size:18px;
cursor:pointer;
background: #ffffff;
color:#111;
box-shadow: 0 14px 35px rgba(0,0,0,.35);
}
.btn:active{ transform: translateY(1px); }

.msg{
margin-top:10px;
font-size:14px;
color:var(--muted);
text-align:center;
min-height:20px;
}
.msg.bad{ color: rgba(239,68,68,.95); }
.msg.ok{ color: rgba(34,197,94,.95); }

/* âœ… FIX: topbar sticky Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ±Øª */
.topbar{
position:sticky;
top:0;
z-index:30;
display:flex;
align-items:center;
justify-content:space-between;
gap:14px;
padding:16px 18px;
border-bottom:1px solid rgba(255,255,255,.10);
background: rgba(0,0,0,.20);
backdrop-filter: blur(14px);
-webkit-backdrop-filter: blur(14px);
}
.pill{
display:inline-flex;
align-items:center;
gap:10px;
padding:10px 14px;
border-radius:999px;
border:1px solid rgba(255,255,255,.14);
background: rgba(255,255,255,.06);
color:var(--txt);
font-weight:700;
max-width: 62vw;
overflow:hidden;
text-overflow: ellipsis;
white-space:nowrap;
}
.leftGroup,.rightGroup{
display:flex;
align-items:center;
gap:10px;
}
.menuBtn{
width:48px; height:44px;
border-radius:16px;
border:1px solid rgba(255,255,255,.16);
background: rgba(255,255,255,.08);
color:var(--txt);
cursor:pointer;
display:grid;
place-items:center;
font-size:20px;
}

.select{
padding:10px 14px;
border-radius:999px;
border:1px solid rgba(255,255,255,.16);
background: rgba(255,255,255,.06);
color:var(--txt);
outline:none;
font-weight:800;
}

.page{ display:none; }
.page.active{ display:block; }

.homeBox{
padding:22px 22px 26px;
text-align:center;
}
.homeTitle{
font-size: clamp(26px, 4vw, 40px);
font-weight:900;
margin:0 0 6px;
letter-spacing:.6px;
}
.homeTitle span{
color: var(--accent);
text-shadow: 0 10px 24px rgba(255,45,85,.22);
}
.homeSmall{ margin:0; color:var(--muted); font-size: 15px; }
.homeDate{
margin:8px 0 0;
color:rgba(255,255,255,.78);
font-weight:800;
letter-spacing:.5px;
}
.homeText{
margin:16px auto 0;
width:min(700px, 92%);
color:rgba(255,255,255,.88);
line-height:2;
font-size: 18px;
}
.homePledge{
margin:12px auto 0;
width:min(720px, 92%);
color:rgba(255,255,255,.62);
font-size: 13px;
line-height:2;
}
.homeLove{
margin:10px 0 0;
color:rgba(255,255,255,.62);
font-size: 12px;
}

.modal{
position:fixed; inset:0;
display:none;
align-items:center;
justify-content:center;
background: rgba(0,0,0,.55);
z-index:50;
padding:18px;
}
.modal.show{ display:flex; }
.modalCard{
width:min(820px, 96vw);
border-radius:26px;
background: rgba(20,8,16,.82);
border:1px solid rgba(255,255,255,.16);
box-shadow: 0 22px 70px rgba(0,0,0,.6);
backdrop-filter: blur(18px);
-webkit-backdrop-filter: blur(18px);
overflow:hidden;
max-height: calc(100vh - 40px);
display:flex;
flex-direction:column;
}
.modalHead{
padding:16px 18px;
display:flex;
align-items:center;
justify-content:space-between;
border-bottom:1px solid rgba(255,255,255,.10);
}
.modalHead h3{
margin:0;
font-size:18px;
font-weight:900;
color:rgba(255,255,255,.92);
}
.closeBtn{
width:44px; height:40px;
border-radius:14px;
border:1px solid rgba(255,255,255,.16);
background: rgba(255,255,255,.08);
color:var(--txt);
cursor:pointer;
font-size:18px;
}
.grid{
padding:18px;
display:grid;
grid-template-columns: repeat(3, 1fr);
gap:12px;
overflow:auto;
-webkit-overflow-scrolling: touch;
}
@media (max-width:760px){
.grid{ grid-template-columns:1fr; }
}
.opt{
padding:16px 14px;
border-radius:18px;
border:1px solid rgba(255,255,255,.16);
background: rgba(255,255,255,.06);
color:var(--txt);
font-weight:900;
cursor:pointer;
display:flex;
align-items:center;
justify-content:center;
gap:10px;
min-height:56px;
transition: transform .12s ease, background .12s ease;
}
.opt:hover{ transform: translateY(-1px); background: rgba(255,255,255,.09); }
.opt small{ font-weight:800; color:rgba(255,255,255,.65); }

.contentBox{
padding:18px 18px 24px;
}
.backBtn{
padding:10px 14px;
border-radius:14px;
border:1px solid rgba(255,255,255,.16);
background: rgba(255,255,255,.08);
color:var(--txt);
cursor:pointer;
font-weight:900;
display:inline-flex;
align-items:center;
gap:8px;
}
.hint{
margin-top:12px;
color:rgba(255,255,255,.65);
font-size:13px;
line-height:2;
text-align:center;
}

.gameBox{ padding:18px 18px 24px; }
.gameTop{
display:flex;
align-items:center;
justify-content:space-between;
gap:12px;
margin-bottom:12px;
flex-wrap:wrap;
}
.promptCard{
margin-top:12px;
border-radius:22px;
background: rgba(0,0,0,.16);
border:1px solid rgba(255,255,255,.14);
padding:18px;
min-height:120px;
display:flex;
align-items:center;
justify-content:center;
text-align:center;
font-size:22px;
line-height:1.8;
}
.actions{
display:flex;
gap:10px;
flex-wrap:wrap;
margin-top:12px;
}
.actionBtn{
flex:1 1 160px;
padding:12px 14px;
border-radius:16px;
border:1px solid rgba(255,255,255,.16);
background: rgba(255,255,255,.08);
color:var(--txt);
cursor:pointer;
font-weight:900;
}
.actionBtn:active{ transform: translateY(1px); }
.statusLine{
margin-top:10px;
color:rgba(255,255,255,.55);
font-size:13px;
text-align:center;
}

/* ===== OPTION 2 ===== */
.amkWrap{ margin-top:12px; }
.amkQ{
margin:12px 0 0;
border-radius:22px;
background: rgba(0,0,0,.16);
border:1px solid rgba(255,255,255,.14);
padding:16px 14px;
text-align:center;
font-size:20px;
line-height:1.9;
}
.amkGrid{
display:grid;
grid-template-columns: 1fr 1fr;
gap:12px;
margin-top:12px;
}
@media (max-width:760px){
.amkGrid{ grid-template-columns:1fr; }
}
.amkCard{
border-radius:22px;
background: rgba(0,0,0,.14);
border:1px solid rgba(255,255,255,.12);
padding:14px;
}
.amkHead{
font-weight:900;
margin-bottom:10px;
color:rgba(255,255,255,.90);
text-align:center;
line-height:1.8;
}
.amkArea{
width:100%;
min-height:120px;
resize:vertical;
padding:12px 12px;
border-radius:16px;
border:1px solid rgba(255,255,255,.14);
outline:none;
background: rgba(0,0,0,.18);
color:var(--txt);
font-size:16px;
line-height:1.9;
}
.amkArea::placeholder{ color: rgba(255,255,255,.55); }
.amkRow{
display:flex;
gap:10px;
flex-wrap:wrap;
margin-top:12px;
}
.amkRow .actionBtn{ flex:1 1 180px; }

/* ===== OPTION 3 ===== */
.fishWrap{ margin-top:12px; }
.fishTopRow{
display:flex;
gap:10px;
flex-wrap:wrap;
align-items:center;
justify-content:space-between;
margin-top:10px;
}
.fishBadge{
display:inline-flex;
align-items:center;
gap:10px;
padding:10px 14px;
border-radius:999px;
border:1px solid rgba(255,255,255,.14);
background: rgba(255,255,255,.06);
color:var(--txt);
font-weight:900;
max-width: 92%;
overflow:hidden;
text-overflow: ellipsis;
white-space:nowrap;
}
.fishCard{
margin-top:12px;
border-radius:22px;
background: rgba(0,0,0,.16);
border:1px solid rgba(255,255,255,.14);
padding:16px 14px;
text-align:center;
line-height:1.9;
position:relative;
overflow:hidden;
}
body.seaTheme .fishCard{
background: rgba(0,10,18,.20);
border-color: rgba(255,255,255,.18);
}
.fishCard::after{
content:"";
position:absolute; inset:-20%;
background:
radial-gradient(40% 30% at 30% 35%, rgba(255,255,255,.08), transparent 60%),
radial-gradient(35% 30% at 70% 55%, rgba(255,255,255,.06), transparent 60%);
opacity:0;
transition: opacity .25s ease;
pointer-events:none;
}
body.seaTheme .fishCard::after{ opacity:1; }

.fishQ{
font-size:20px;
font-weight:900;
margin:0;
position:relative;
z-index:1;
}
.fishChoices{
margin-top:12px;
display:grid;
grid-template-columns: 1fr 1fr;
gap:12px;
position:relative;
z-index:1;
}
@media (max-width:760px){
.fishChoices{ grid-template-columns:1fr; }
}
.fishChoiceBtn{
padding:14px 14px;
border-radius:18px;
border:1px solid rgba(255,255,255,.16);
background: rgba(255,255,255,.08);
color:var(--txt);
cursor:pointer;
font-weight:900;
text-align:center;
line-height:1.8;
min-height:56px;
transition: transform .12s ease, background .12s ease;
}
.fishChoiceBtn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.10); }
.fishChoiceBtn.disabled{
opacity:.55;
cursor:not-allowed;
transform:none !important;
pointer-events:none;
}

.fishResult{
margin-top:12px;
border-radius:18px;
border:1px solid rgba(255,255,255,.14);
background: rgba(0,0,0,.12);
padding:12px 12px;
text-align:center;
color:rgba(255,255,255,.88);
white-space:pre-wrap;
line-height:2;
min-height:48px;
position:relative;
z-index:1;
}
.fishLove{
margin-top:12px;
border-radius:18px;
border:1px solid rgba(255,255,255,.14);
background: rgba(255,45,85,.10);
padding:12px 12px;
text-align:center;
color:rgba(255,255,255,.92);
white-space:pre-wrap;
line-height:2;
display:none;
position:relative;
z-index:1;
}
.fishLove.show{ display:block; }

.fishActions{
display:flex;
gap:10px;
flex-wrap:wrap;
margin-top:12px;
position:relative;
z-index:1;
}
.fishActions .actionBtn{ flex:1 1 160px; }

.confirmLine{
margin-top:10px;
color:rgba(255,255,255,.72);
font-size:12px;
text-align:center;
line-height:1.9;
position:relative;
z-index:1;
}

.hide{ display:none !important; }

/* âœ… OPTION 4: PUZZLE */
.puzWrap{ margin-top:12px; }
.puzTopRow{
display:flex;
gap:10px;
flex-wrap:wrap;
align-items:center;
justify-content:space-between;
margin-top:10px;
}
.puzBadge{
display:inline-flex;
align-items:center;
gap:10px;
padding:10px 14px;
border-radius:999px;
border:1px solid rgba(255,255,255,.14);
background: rgba(255,255,255,.06);
color:var(--txt);
font-weight:900;
max-width: 100%;
overflow:hidden;
text-overflow: ellipsis;
white-space:nowrap;
}
.puzCard{
margin-top:12px;
border-radius:22px;
background: rgba(0,0,0,.16);
border:1px solid rgba(255,255,255,.14);
padding:14px;
position:relative;
overflow:hidden;
}
body.puzzleTheme .puzCard{
background: rgba(5,8,18,.18);
border-color: rgba(255,255,255,.16);
}

.puzLayout{
display:grid;
grid-template-columns: 1fr;
gap:12px;
}

.puzPanel{
border-radius:18px;
border:1px solid rgba(255,255,255,.14);
background: rgba(255,255,255,.06);
padding:12px;
}
.puzPanelTitle{
font-weight:900;
margin:0 0 10px;
color:rgba(255,255,255,.92);
display:flex;
align-items:center;
justify-content:space-between;
gap:10px;
flex-wrap:wrap;
}
.puzMini{
font-size:12px;
color:rgba(255,255,255,.70);
font-weight:800;
}

.puzImageBox{
width:100%;
aspect-ratio: 1 / 1;
border-radius:18px;
border:1px solid rgba(255,255,255,.14);
overflow:hidden;
background: rgba(0,0,0,.15);
position:relative;
}
.puzImageBox img{
width:100%;
height:100%;
object-fit: cover;
display:block;
user-select:none;
-webkit-user-drag:none;
pointer-events:none;
}
.puzImageGlow{
position:absolute; inset:0;
background:
radial-gradient(60% 55% at 30% 25%, rgba(255,255,255,.10), transparent 62%),
radial-gradient(55% 55% at 70% 75%, rgba(255,255,255,.08), transparent 62%);
mix-blend-mode: screen;
pointer-events:none;
opacity:.9;
}

.puzBoard{
width:100%;
aspect-ratio: 1 / 1;
border-radius:18px;
border:1px solid rgba(255,255,255,.14);
background: rgba(0,0,0,.12);
padding:10px;
display:grid;
gap:8px;
}
body.puzzleTheme .puzBoard{
background: rgba(0,0,0,.10);
}
.puzSlot{
border-radius:14px;
border:1px dashed rgba(255,255,255,.18);
background: rgba(255,255,255,.04);
position:relative;
overflow:hidden;
display:grid;
place-items:center;
min-height:0;
user-select:none;
-webkit-user-select:none;
touch-action: manipulation;
}
.puzSlot.filled{
border-style:solid;
border-color: rgba(255,255,255,.14);
background: rgba(255,255,255,.06);
}

.puzPiece{
width:100%;
height:100%;
border-radius:12px;
border:1px solid rgba(255,255,255,.12);
background-repeat:no-repeat;
background-size: 100% 100%;
box-shadow: 0 10px 25px rgba(0,0,0,.22);
position:relative;
overflow:hidden;
touch-action: manipulation;
}
.puzPiece::after{
content:"";
position:absolute; inset:-20%;
background:
radial-gradient(40% 30% at 30% 25%, rgba(255,255,255,.10), transparent 60%),
radial-gradient(40% 30% at 70% 75%, rgba(255,255,255,.08), transparent 60%);
opacity:.7;
pointer-events:none;
}

.puzTray{
display:flex;
flex-wrap:wrap;
gap:8px;
justify-content:center;
}
.puzTile{
width:60px;
aspect-ratio: 1/1;
border-radius:14px;
border:1px solid rgba(255,255,255,.14);
background: rgba(255,255,255,.06);
overflow:hidden;
cursor:pointer;
position:relative;
user-select:none;
-webkit-user-select:none;
touch-action: manipulation;
box-shadow: 0 12px 28px rgba(0,0,0,.22);
}
@media (max-width:520px){
.puzTile{ width:56px; }
}
.puzTile.selected{
outline: 2px solid rgba(255,255,255,.85);
transform: translateY(-1px);
}
.puzTile .puzPiece{ border-radius:13px; border:0; box-shadow:none; }

.puzStatus{
margin-top:10px;
border-radius:16px;
border:1px solid rgba(255,255,255,.14);
background: rgba(0,0,0,.10);
padding:10px 12px;
color:rgba(255,255,255,.85);
white-space:pre-wrap;
line-height:2;
font-size:13px;
text-align:center;
}
.puzSuccess{
margin-top:10px;
border-radius:16px;
border:1px solid rgba(34,197,94,.30);
background: rgba(34,197,94,.10);
padding:10px 12px;
color:rgba(255,255,255,.92);
white-space:pre-wrap;
line-height:2;
font-size:13px;
text-align:center;
display:none;
}
.puzSuccess.show{ display:block; }

/* âœ… Tabs */
.puzTabs{
display:flex;
gap:10px;
flex-wrap:wrap;
align-items:center;
justify-content:space-between;
margin-top:10px;
}
.seg{
display:flex;
gap:6px;
padding:6px;
border-radius:999px;
border:1px solid rgba(255,255,255,.14);
background: rgba(255,255,255,.06);
}
.segBtn{
padding:10px 14px;
border-radius:999px;
border:0;
cursor:pointer;
font-weight:900;
color:rgba(255,255,255,.88);
background: transparent;
}
.segBtn.active{
background: rgba(255,255,255,.14);
color:#fff;
box-shadow: 0 10px 25px rgba(0,0,0,.18);
}

/* âœ… Mini board */
.puzMiniBoardWrap{
margin-top:12px;
border-radius:18px;
border:1px solid rgba(255,255,255,.14);
background: rgba(0,0,0,.10);
padding:10px;
}
.puzMiniBoardTitle{
font-weight:900;
font-size:13px;
color:rgba(255,255,255,.88);
display:flex;
justify-content:space-between;
gap:10px;
margin-bottom:8px;
}
.puzMiniBoard{
width:100%;
aspect-ratio: 1/1;
border-radius:16px;
border:1px solid rgba(255,255,255,.12);
background: rgba(0,0,0,.08);
padding:8px;
display:grid;
gap:6px;
pointer-events:none;
opacity:.98;
}
.puzMiniSlot{
border-radius:12px;
border:1px dashed rgba(255,255,255,.18);
background: rgba(255,255,255,.03);
display:grid;
place-items:center;
overflow:hidden;
}
.puzMiniSlot.filled{
border-style:solid;
border-color: rgba(255,255,255,.12);
background: rgba(255,255,255,.05);
}
.puzMiniPiece{
width:100%;
height:100%;
border-radius:10px;
background-repeat:no-repeat;
box-shadow:none;
border:0;
}
/* ===== OPTION 5: KITCHEN ===== */
.kitWrap{ margin-top:12px; }
.kitTopRow{ display:flex; gap:10px; flex-wrap:wrap; justify-content:space-between; margin-top:10px; }
.kitBadge{
display:inline-flex; align-items:center; gap:10px;
padding:10px 14px; border-radius:999px;
border:1px solid rgba(255,255,255,.14);
background: rgba(255,255,255,.06);
color:var(--txt); font-weight:900;
max-width:100%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
}
.kitTabs{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-top:10px; }
.kitAlbumBtn{ flex: 0 0 auto; min-width:140px; }

.kitChars{
margin-top:12px;
display:grid;
grid-template-columns: 1fr 1.6fr 1fr;
gap:12px;
align-items:stretch;
}
@media (max-width:760px){
.kitChars{ grid-template-columns:1fr; }
}
.kitCharCard{
border-radius:22px;
background: rgba(0,0,0,.14);
border:1px solid rgba(255,255,255,.12);
padding:14px;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
text-align:center;
gap:6px;
}
.kitCharEmoji{ font-size:48px; }
.kitCharName{ font-weight:900; letter-spacing:.5px; }
.kitCharSub{ color:rgba(255,255,255,.65); font-weight:800; font-size:12px; }

.kitTable{
border-radius:22px;
background: rgba(0,0,0,.12);
border:1px solid rgba(255,255,255,.12);
padding:14px;
display:flex;
flex-direction:column;
justify-content:space-between;
}
.kitTableTop{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; flex-wrap:wrap; }
.kitTableTitle{ font-weight:900; }
.kitMiniLine{ font-size:12px; color:rgba(255,255,255,.70); font-weight:800; line-height:1.9; }
.kitProgress{
margin-top:10px;
border-radius:18px;
border:1px solid rgba(255,255,255,.14);
background: rgba(255,45,85,.10);
padding:12px;
line-height:2;
text-align:center;
font-weight:900;
}

.kitPanel{
margin-top:12px;
border-radius:22px;
background: rgba(0,0,0,.14);
border:1px solid rgba(255,255,255,.12);
padding:14px;
}
.kitPanelTitle{
font-weight:900;
margin:0 0 10px;
color:rgba(255,255,255,.92);
display:flex;
justify-content:space-between;
gap:10px;
flex-wrap:wrap;
}
.kitMini{ font-size:12px; color:rgba(255,255,255,.70); font-weight:800; }

.kitRecipeGrid{
display:grid;
grid-template-columns: repeat(2, 1fr);
gap:10px;
}
@media (max-width:760px){
.kitRecipeGrid{ grid-template-columns:1fr; }
}
.kitRecipeBtn{
padding:14px;
border-radius:18px;
border:1px solid rgba(255,255,255,.16);
background: rgba(255,255,255,.08);
color:var(--txt);
cursor:pointer;
font-weight:900;
text-align:center;
line-height:1.9;
transition: transform .12s ease, background .12s ease;
}
.kitRecipeBtn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.10); }
.kitRecipeBtn.selected{ outline:2px solid rgba(255,255,255,.85); }

.kitConfirmRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
.kitConfirmRow .actionBtn{ flex:1 1 180px; }
.kitConfirmLine{
margin-top:10px;
color:rgba(255,255,255,.72);
font-size:12px;
text-align:center;
line-height:1.9;
}

.kitStepBar{
display:flex; gap:8px; flex-wrap:wrap;
justify-content:center;
margin-bottom:10px;
}
.kitStepPill{
padding:10px 12px;
border-radius:999px;
border:1px solid rgba(255,255,255,.14);
background: rgba(255,255,255,.06);
font-weight:900;
font-size:12px;
color:rgba(255,255,255,.85);
}
.kitStepPill.active{ background: rgba(255,255,255,.14); color:#fff; }
.kitStepCard{
border-radius:18px;
border:1px solid rgba(255,255,255,.14);
background: rgba(0,0,0,.10);
padding:12px;
}
.kitStepTitle{ font-weight:900; margin-bottom:6px; }
.kitStepDesc{ color:rgba(255,255,255,.80); line-height:2; font-size:13px; }
.kitActions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
.kitActions .actionBtn{ flex:1 1 180px; }

.kitDecoBoard{
width:100%;
aspect-ratio: 16 / 10;
border-radius:18px;
border:1px solid rgba(255,255,255,.14);
background: rgba(0,0,0,.10);
position:relative;
overflow:hidden;
display:block;
}
.kitDecoHint{
position:absolute;
inset:0;
display:grid;
place-items:center;
text-align:center;
padding:12px;
color:rgba(255,255,255,.75);
font-weight:900;
line-height:2;
}
.kitDecoItem{
position:absolute;
user-select:none;
-webkit-user-select:none;
cursor:pointer;
filter: drop-shadow(0 10px 18px rgba(0,0,0,.25));
transform: translate(-50%, -50%);
}
.kitDecoTools{
display:flex;
flex-wrap:wrap;
gap:8px;
justify-content:center;
margin-top:10px;
}
.kitTool{
padding:10px 12px;
border-radius:999px;
border:1px solid rgba(255,255,255,.14);
background: rgba(255,255,255,.06);
color:rgba(255,255,255,.92);
font-weight:900;
cursor:pointer;
}
.kitTool:active{ transform: translateY(1px); }

.kitStatus{
margin-top:10px;
border-radius:16px;
border:1px solid rgba(255,255,255,.14);
background: rgba(0,0,0,.10);
padding:10px 12px;
color:rgba(255,255,255,.85);
white-space:pre-wrap;
line-height:2;
font-size:13px;
text-align:center;
}
	/* âœ… Cake graphics */
.kitCakePlate{
  position:absolute;
  left:50%; bottom:10px;
  transform: translateX(-50%);
  width: 72%;
  height: 18%;
  border-radius: 999px;
  border:1px solid rgba(255,255,255,.18);
  box-shadow: 0 16px 35px rgba(0,0,0,.35);
  background: linear-gradient(180deg, rgba(255,255,255,.20), rgba(0,0,0,.08));
}
.kitCakePlate[data-c="pink"]{ background: linear-gradient(180deg, rgba(255,105,180,.35), rgba(0,0,0,.10)); }
.kitCakePlate[data-c="red"]{ background: linear-gradient(180deg, rgba(255,60,60,.35), rgba(0,0,0,.10)); }
.kitCakePlate[data-c="black"]{ background: linear-gradient(180deg, rgba(20,20,20,.55), rgba(0,0,0,.10)); }
.kitCakePlate[data-c="white"]{ background: linear-gradient(180deg, rgba(255,255,255,.35), rgba(0,0,0,.10)); }
.kitCakePlate[data-c="purple"]{ background: linear-gradient(180deg, rgba(160,90,255,.35), rgba(0,0,0,.10)); }

.kitCakeLayer{
  position:absolute;
  left:50%;
  transform: translateX(-50%);
  width: 52%;
  height: 14%;
  border-radius: 18px;
  border:1px solid rgba(255,255,255,.18);
  box-shadow: 0 18px 35px rgba(0,0,0,.30);
  animation: popIn .22s ease-out;
}
@keyframes popIn{ from{ transform:translateX(-50%) scale(.92); opacity:.2 } to{ transform:translateX(-50%) scale(1); opacity:1 } }

.kitCakeLayer[data-c="pink"]{ background: linear-gradient(180deg, rgba(255,105,180,.40), rgba(0,0,0,.12)); }
.kitCakeLayer[data-c="red"]{ background: linear-gradient(180deg, rgba(255,60,60,.40), rgba(0,0,0,.12)); }
.kitCakeLayer[data-c="black"]{ background: linear-gradient(180deg, rgba(25,25,25,.65), rgba(0,0,0,.14)); }
.kitCakeLayer[data-c="white"]{ background: linear-gradient(180deg, rgba(255,255,255,.40), rgba(0,0,0,.12)); }
.kitCakeLayer[data-c="brown"]{ background: linear-gradient(180deg, rgba(120,72,45,.55), rgba(0,0,0,.14)); }

.kitCakeFilling{
  position:absolute;
  top:12px; left:12px;
  padding:10px 12px;
  border-radius: 999px;
  border:1px solid rgba(255,255,255,.16);
  background: rgba(0,0,0,.16);
  font-weight:900;
  color: rgba(255,255,255,.92);
}

/* Album modal */
.kitModal{
position:fixed; inset:0;
display:none;
align-items:center;
justify-content:center;
background: rgba(0,0,0,.55);
z-index:60;
padding:18px;
}
.kitModal.show{ display:flex; }
.kitModalCard{
width:min(820px, 96vw);
border-radius:26px;
background: rgba(20,8,16,.82);
border:1px solid rgba(255,255,255,.16);
box-shadow: 0 22px 70px rgba(0,0,0,.6);
backdrop-filter: blur(18px);
-webkit-backdrop-filter: blur(18px);
overflow:hidden;
max-height: calc(100vh - 40px);
display:flex;
flex-direction:column;
}
.kitModalHead{
padding:16px 18px;
display:flex;
align-items:center;
justify-content:space-between;
border-bottom:1px solid rgba(255,255,255,.10);
}
.kitAlbumGrid{
padding:18px;
display:grid;
grid-template-columns: repeat(2, 1fr);
gap:12px;
overflow:auto;
-webkit-overflow-scrolling: touch;
}
@media (max-width:760px){
.kitAlbumGrid{ grid-template-columns:1fr; }
}
.kitAlbumCard{
border-radius:18px;
border:1px solid rgba(255,255,255,.16);
background: rgba(255,255,255,.06);
overflow:hidden;
}
.kitAlbumImg{ width:100%; display:block; aspect-ratio: 16/10; object-fit: cover; }
.kitAlbumMeta{ padding:12px; line-height:2; color:rgba(255,255,255,.85); font-weight:900; font-size:12px; }
.kitAlbumHint{ padding:12px 18px; color:rgba(255,255,255,.65); font-weight:800; font-size:12px; text-align:center; }
/* ===== OPTION 6: INVESTIGATION (Court Paper) ===== */
.casePaper{
  margin-top:12px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.18);
  background:
    radial-gradient(120px 80px at 20% 20%, rgba(0,0,0,.06), transparent 60%),
    radial-gradient(140px 90px at 80% 70%, rgba(0,0,0,.05), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.95), rgba(245,245,245,.88));
  color:#111;
  box-shadow: 0 14px 40px rgba(0,0,0,.28);
  padding:14px 14px 12px;
  position:relative;
  overflow:hidden;
}
.casePaper::after{
  content:"";
  position:absolute; inset:-40%;
  background:
    radial-gradient(220px 160px at 40% 30%, rgba(0,0,0,.06), transparent 60%),
    radial-gradient(260px 180px at 70% 60%, rgba(0,0,0,.04), transparent 62%);
  transform: rotate(-8deg);
  opacity:.55;
  pointer-events:none;
}
.casePaperTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:10px;
}
.caseStamp{
  font-weight:900;
  letter-spacing:2px;
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  border:2px solid rgba(239,68,68,.55);
  color:rgba(239,68,68,.95);
  background: rgba(239,68,68,.08);
  transform: rotate(-8deg);
}
.caseTitle{
  font-weight:1000;
  font-size:14px;
  color:#111;
  opacity:.92;
}
.caseChargeRow{
  display:grid;
  grid-template-columns: 92px 1fr;
  gap:10px;
  align-items:flex-start;
}
.caseLabel{
  font-weight:1000;
  font-size:13px;
  color:#111;
  opacity:.85;
}
.caseCharge{
  font-weight:1000;
  font-size:16px;
  line-height:1.8;
  color:#0f172a;
}
.invGrid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:12px;
  margin-top:12px;
}
@media (max-width:900px){
  .invGrid{ grid-template-columns:1fr; }
}
.invCard{
  border-radius:18px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.10);
  padding:12px;
}
.invHead{
  font-weight:1000;
  margin-bottom:8px;
  color:rgba(255,255,255,.92);
}
.invText{
  white-space:pre-wrap;
  line-height:2;
  color:rgba(255,255,255,.88);
  font-size:14px;
}
.invTruthBox{
  margin-top:10px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.16);
  background: rgba(255,45,85,.10);
  padding:10px;
  display:none;
}
.invTruthHead{
  font-weight:1000;
  margin-bottom:6px;
}
.invTruth{
  white-space:pre-wrap;
  line-height:2;
  font-weight:900;
}
	@media (max-width: 768px){
  .page {
    min-height: 100vh !important;
    height: auto !important;
    overflow-y: auto !important;
  }
}
	/* Puzzle anti-jump on mobile */
#puzBoard, #puzTray, .puzSlot, .puzTile, .puzPiece, #puzFullImg {
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}
</style>
</head>

<body>
<div class="hearts" id="hearts"></div>
<div class="rain" id="rain"></div>
<div class="seaEmojis" id="seaEmojis"></div>
<div class="puzzleRain" id="puzzleRain"></div>

<div class="waves"></div>
<div class="vignette"></div>

<div class="wrap">
<div class="card">
<div class="topbar hide" id="topbar">
<div class="leftGroup">
<div class="pill" id="whoPill">ğŸ’— ...</div>
</div>
<div class="rightGroup">
<button class="menuBtn" id="menuBtn" title="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Live)">â˜°</button>
</div>
</div>

<div class="inner">
<!-- LOGIN PAGE -->
<section class="page active" id="pageLogin">
<div class="center">
<h1 class="titleBig">LANA <span style="color:var(--accent)">â¤ï¸</span> ANAS</h1>
<p class="sub">I love you</p>
<p class="homeDate">24/11</p>
</div>

<div class="divider"></div>

<div class="loginPanel">
<div class="inputs">
<input class="inp" id="loginUser" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" autocomplete="username" />
<input class="inp" id="loginPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" type="password" autocomplete="current-password" />
</div>
<button class="btn" id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
<div class="msg" id="loginMsg"></div>
</div>
</section>

<!-- HOME PAGE -->
<section class="page" id="pageHome">
<div class="homeBox">
<p id="loveCounter" style="
font-weight:900;
font-size:22px;
letter-spacing:2px;
margin-bottom:10px;
color:#fff;
">ğŸ’— 0 DAY</p>

<h2 class="homeTitle">LANA <span>â¤ï¸</span> ANAS</h2>
<p class="homeSmall">I love you</p>
<p class="homeDate">24/11</p>

<p class="homeText" id="homeText">
Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ Ù„ÙˆÙ„ÙŠ Ø¨Ø¹Ø§Ù„Ù…Ù†Ø§ Ø§Ù„Ø®Ø§Øµ Ø§Ù„Ø°ÙŠ ØµÙÙ†Ø¹ Ø¨ÙƒÙ„ Ø­Ø¨â€¦ Ù‡Ù†Ø§ Ù†ØµÙ†Ø¹ Ø°ÙƒØ±ÙŠØ§Øª ÙˆÙ…Ø´Ø§Ø¹Ø± ØªØ®Ù„Ù‘Ø¯ Ø¨ÙŠÙ†Ù†Ø§ØŒ
ÙˆÙƒÙ„ Ù„Ø­Ø¸Ø© Ù†ÙƒØªØ¨Ù‡Ø§ ØªØµØ¨Ø­ Ø¹Ù„Ø§Ù…Ø© Ù…Ø§ ØªÙ†Ø³Ù‰ØŒ ØªÙ‚ÙˆÙ‘ÙŠÙ†Ø§ ÙˆØªØ²ÙŠØ¯Ù†Ø§ Ù‚Ø±Ø¨ ÙˆØ·Ù…Ø£Ù†ÙŠÙ†Ø©.
Ù‡Ø°Ø§ Ø§Ù„Ù…ÙƒØ§Ù† Ù„Ù†Ø§ ÙÙ‚Ø·â€¦ Ù†Ø¶Ø­ÙƒØŒ Ù†ØªØ´Ø§Ø±ÙƒØŒ ÙˆÙ†Ø³Ù†Ø¯ Ø¨Ø¹Ø¶ Ø­ØªÙ‰ Ù„Ùˆ ÙƒÙ†Ø§ Ø¨Ø¹ÙŠØ¯ÙŠÙ†.
</p>

<p class="homePledge" id="homePledge">
Ù†ØªØ¹Ù‡Ø¯ Ø¨Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ÙˆØ¹Ø¯Ù… Ø§Ù„Ø±ÙØ¶ Ù„Ø£ÙŠ ØªØ­Ø¯ÙŠØŒ ÙˆÙ†Ø³ÙˆÙŠ ÙƒÙ„ Ø´ÙŠØ¡ Ø¨Ø­Ø¨ ÙˆÙ…Ø´Ø§Ø¹Ø± ÙˆØ¥Ø­Ø³Ø§Ø³â€¦ Ù„Ø£Ù† Ù‡Ø°Ø§ Ø¹Ø§Ù„Ù…Ù†Ø§ Ø§Ù„Ø®Ø§Øµ.
</p>

<p class="homeLove">Ø£Ø­Ø¨Ùƒ Ù„Ø§Ù†Ø§ ğŸ¤</p>

<div class="hint">ğŸ’¡ Ø§ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (â˜°) Ù…Ù† ÙÙˆÙ‚ ÙˆØ§Ø®ØªØ± Ù…Ù† 9 Ø®ÙŠØ§Ø±Ø§Øª â€” ÙƒÙ„ Ø´ÙŠØ¡ ÙŠØªÙØ§Ø²Ù† Ø¨ÙŠÙ†ÙƒÙ… Live</div>
</div>
</section>

<!-- OPTION 1: GAME -->
<section class="page" id="pageGame">
<div class="gameBox">
<div class="gameTop">
<button class="backBtn" id="backHomeBtn">â†© Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>

<select class="select" id="modeSelect" title="ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø© (Live)">
<option value="lana1">LANA 1</option>
<option value="lana2">LANA 2</option>
<option value="lana3">LANA 3</option>
<option value="lana4">LANA 4</option>
</select>

<div class="pill" id="roomPill">Room: our-world</div>
</div>

<div class="promptCard" id="promptCard">Ø§Ø¨Ø¯Ø£ âœ¨ Ø§Ø®ØªØ± (Ø³Ø¤Ø§Ù„ / ØªØ­Ø¯ÙŠ)</div>

<div class="actions">
<button class="actionBtn" id="btnQ">ğŸ’— Ø³Ø¤Ø§Ù„</button>
<button class="actionBtn" id="btnC">ğŸ”¥ ØªØ­Ø¯ÙŠ</button>
</div>

<div class="statusLine" id="syncLine">â€¦</div>
</div>
</section>

<!-- OPTION 2 -->
<section class="page" id="pageOpt2">
<div class="contentBox">
<button class="backBtn backAny">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
<div class="promptCard" style="font-size:20px">ğŸ’¥ Ù„Ø¹Ø¨Ø© â€œØ£Ù†Ø§ Ù…ÙƒØ§Ù†Ùƒâ€</div>

<div class="amkWrap">
<div class="amkQ" id="amkQuestion">â€¦</div>

<div class="amkGrid">
<div class="amkCard">
<div class="amkHead">Ø£Ù†Ø§ Ø£Ø¬Ø§ÙˆØ¨ ÙƒØ£Ù†ÙŠ: <b id="amkMeAs">â€¦</b></div>
<textarea class="amkArea" id="amkMe" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§â€¦"></textarea>
<button class="actionBtn" id="amkSave">ğŸ’¾ Ø­ÙØ¸ Ø¥Ø¬Ø§Ø¨ØªÙŠ (Live)</button>
<div class="hint" id="amkHintMe"></div>
</div>

<div class="amkCard">
<div class="amkHead">Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ ÙŠØ¬Ø§ÙˆØ¨ ÙƒØ£Ù†Ù‡: <b id="amkOtherAs">â€¦</b></div>
<textarea class="amkArea" id="amkOther" placeholder="ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¨Ø¹Ø¯ Ù…Ø§ ÙŠØ­ÙØ¸..." readonly></textarea>
<div class="hint" id="amkHintOther"></div>
</div>
</div>

<div class="amkRow">
<button class="actionBtn" id="amkNew">ğŸŒ¹ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯</button>
</div>

<div class="statusLine" id="amkStatus">â€¦</div>
</div>
</div>
</section>

<!-- OPTION 3 -->
<section class="page" id="pageOpt3">
<div class="contentBox">
<button class="backBtn backAny">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø±Ø¦ÙŠØ³ÙŠØ©</button>

<div class="promptCard" style="font-size:20px">ğŸŒ§ï¸ğŸŒŠ Ø£Ù„ØºØ§Ø² Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø±: Ø§Ø­Ù†Ø§ Ø£Ù‚ÙˆÙ‰ Ù…Ù† Ø§Ù„Ø³Ù…ÙƒØ© â“ğŸŸâ¤ï¸</div>

<div class="fishWrap">
<div class="fishTopRow">
<div class="fishBadge" id="fishStageBadge">Ø§Ù„Ù…Ø±Ø­Ù„Ø©: 1 / 150</div>
<button class="actionBtn" id="fishPunishBtn">âš ï¸ Ø¹Ù‚Ø§Ø¨ (Ø¹Ø´ÙˆØ§Ø¦ÙŠ)</button>
</div>

<div class="fishCard">
<p class="fishQ" id="fishQ">â€¦</p>

<div class="fishChoices">
<button class="fishChoiceBtn" id="fishC0">â€¦</button>
<button class="fishChoiceBtn" id="fishC1">â€¦</button>
<button class="fishChoiceBtn" id="fishC2">â€¦</button>
<button class="fishChoiceBtn" id="fishC3">â€¦</button>
</div>

<div class="fishResult" id="fishResult">Ø§Ø®ØªØ§Ø±ÙˆØ§ Ø¬ÙˆØ§Ø¨ Ù…Ù† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ğŸ‘† (Live)</div>
<div class="fishLove" id="fishLove">â€¦</div>

<div class="fishActions">
<button class="actionBtn" id="fishConfirmBtn">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¬ÙˆØ§Ø¨ (Ù„Ø§Ø²Ù… Ø§Ù„Ø§Ø«Ù†ÙŠÙ†)</button>
<button class="actionBtn hide" id="fishNextBtn">â¡ï¸ Ø§Ù„ØªØ§Ù„ÙŠ</button>
</div>

<div class="confirmLine" id="fishConfirmLine">â€¦</div>
<div class="statusLine" id="fishStatus">â€¦</div>
</div>

<div class="hint">
âœ… Ø£ÙŠ ÙˆØ§Ø­Ø¯ ÙŠØ®ØªØ§Ø± â†’ ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠ Live<br/>
ğŸ”’ Ù…Ø§ ØªØ·Ù„Ø¹ Ù†ØªÙŠØ¬Ø© ØµØ­/ØºÙ„Ø· Ø¥Ù„Ø§ Ø¥Ø°Ø§ **Ø£Ù†ØªÙ… Ø§Ù„Ø§Ø«Ù†ÙŠÙ†** Ø¶ØºØ·ØªÙ… (ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¬ÙˆØ§Ø¨)<br/>
âœ… Ø¥Ø°Ø§ Ø·Ù„Ø¹Øª ØµØ­: ÙŠÙƒØªØ¨ (ØªØ®Ø³ÙŠ Ø§Ù„Ø³Ù…ÙƒØ© Ø§Ø­Ù†Ø§ Ø§Ù‚ÙˆÙ‰) ÙˆÙŠÙ†Ù‚Ù„ÙƒÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù„ÙŠ Ø¨Ø¹Ø¯Ù‡Ø§
</div>
</div>
</div>
</section>

<!-- âœ… OPTION 4 -->
<section class="page" id="pageOpt4">
<div class="contentBox">
<button class="backBtn backAny">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
<div class="promptCard" style="font-size:20px">ğŸ§© Ø¨Ø²Ù„ â€” Ù‚Ø³Ù…ÙŠÙ† (Live): Ù…Ø´ØªØ±Ùƒ + ØªØ­Ø¯Ù‘ÙŠ</div>

<div class="puzWrap">
<div class="puzTabs">
<div class="seg" aria-label="Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¨Ø²Ù„">
<button class="segBtn" id="puzTabCoop">ğŸ¤ Ù…Ø´ØªØ±Ùƒ (100)</button>
<button class="segBtn" id="puzTabChallenge">ğŸ”¥ ØªØ­Ø¯Ù‘ÙŠ (100)</button>
</div>
<div class="puzBadge" id="puzSectionBadge">Ø§Ù„Ù‚Ø³Ù…: â€¦</div>
</div>

<div class="puzTopRow">
<div class="puzBadge" id="puzStageBadge">Ø§Ù„Ù…Ø±Ø­Ù„Ø©: 1 / 100</div>
<div class="puzBadge" id="puzRoleBadge">Ø§Ù„Ø¯ÙˆØ±: â€¦</div>
</div>

<div class="puzTopRow">
<button class="actionBtn" id="puzSwapBtn">ğŸ” ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± (Live)</button>
<button class="actionBtn" id="puzResetBtn">ğŸ§¹ ØªØµÙÙŠØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø©</button>
<!-- âœ… FIX: Ø§Ù„Ø²Ø± ØµØ§Ø± Ø´ØºÙ‘Ø§Ù„ Ø¯Ø§ÙŠÙ… -->
<button class="actionBtn" id="puzNextBtn">âœ… Ø£Ù†Ø§ Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ§Ù„ÙŠ</button>
</div>

<div class="puzCard">
<div class="puzLayout">
<div class="puzPanel" id="puzViewerPanel">
<div class="puzPanelTitle">
<span>ğŸ‘ï¸ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</span>
<span class="puzMini" id="puzViewerMini">â€¦</span>
</div>
<div class="puzImageBox">
<img id="puzFullImg" alt="puzzle" loading="lazy" />
<div class="puzImageGlow"></div>
</div>

<div class="puzMiniBoardWrap" id="puzMiniBoardWrap">
<div class="puzMiniBoardTitle">
<span>ğŸªŸ Ù†Ø§ÙØ°Ø© Ù„Ù…ØªØ§Ø¨Ø¹Ø© ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ (Live)</span>
<span style="color:rgba(255,255,255,.65);font-weight:800;font-size:12px" id="puzMiniBoardInfo">â€¦</span>
</div>
<div class="puzMiniBoard" id="puzMiniBoard"></div>
<div class="hint" style="margin-top:8px">Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø· Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯ â€” Ø¹Ø´Ø§Ù† ØªØ³Ø§Ø¹Ø¯Ù‡ ÙˆÙŠØ¶Ø¨Ø· Ø§Ù„Ù‚Ø·Ø¹ ğŸ’—</div>
</div>

<div class="hint" id="puzViewerHint">Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ÙŠØ¸Ù‡Ø± Ù„Ù„Ø´Ø®Øµ â€œØ§Ù„Ù…Ø´Ø§Ù‡Ø¯â€ ÙÙ‚Ø· ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø¯Ù‘ÙŠ.</div>
</div>

<div class="puzPanel" id="puzAssemblerPanel">
<div class="puzPanelTitle">
<span>ğŸ§© Ø§Ù„ØªØ±ÙƒÙŠØ¨</span>
<span class="puzMini" id="puzAssemblerMini">â€¦</span>
</div>

<div class="puzBoard" id="puzBoard"></div>
<div class="hint">ğŸ“Œ Ø§Ø¶ØºØ· Ù‚Ø·Ø¹Ø© Ù…Ù† ØªØ­Øª â†’ Ø«Ù… Ø§Ø¶ØºØ· Ù…ÙƒØ§Ù† ÙØ§Ø¶ÙŠ ÙÙŠ Ø§Ù„Ù„ÙˆØ­. Ù„Ø¥Ø²Ø§Ù„Ø© Ù‚Ø·Ø¹Ø©: Ø§Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù„ÙˆØ­.</div>

<div class="divider" style="margin:14px 0;"></div>

<div class="puzTray" id="puzTray"></div>

<div class="puzSuccess" id="puzSuccess">âœ… Ø¨Ø±Ø§ÙÙˆ! Ø®Ù„ØµØªÙˆØ§ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ğŸ’—</div>
<div class="puzStatus" id="puzStatus">â€¦</div>
</div>
</div>
</div>

<div class="hint">
âœ… Ù‚Ø³Ù… <b>Ù…Ø´ØªØ±Ùƒ</b>: Ø§Ù„Ø§Ø«Ù†ÙŠÙ† ÙŠØ±ÙƒÙ‘Ø¨ÙˆÙ† Ø³ÙˆØ§ (Ø¨Ø¯ÙˆÙ† Ø£Ø¯ÙˆØ§Ø±)<br/>
ğŸ”¥ Ù‚Ø³Ù… <b>ØªØ­Ø¯Ù‘ÙŠ</b>: ÙˆØ§Ø­Ø¯ ÙŠØ´ÙˆÙ ÙƒØ§Ù…Ù„ ÙˆØ§Ù„Ø«Ø§Ù†ÙŠ ÙŠØ±ÙƒÙ‘Ø¨ â€” ÙˆØªÙ‚Ø¯Ø±ÙˆÙ† ØªØ¨Ø¯Ù„ÙˆÙ† Ø§Ù„Ø£Ø¯ÙˆØ§Ø±<br/>
ğŸ”’ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: Ù„Ø§Ø²Ù… <b>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</b> + ØªÙƒÙˆÙ† Ø§Ù„Ù…Ø±Ø­Ù„Ø© <b>Ù…Ø­Ù„ÙˆÙ„Ø©</b>
</div>
</div>
</div>
</section>

<section class="page" id="pageOpt5">
<div class="contentBox">
<button class="backBtn backAny">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>

<div class="promptCard" style="font-size:20px">ğŸ°ğŸ³ Ù…Ø·Ø¨Ø®Ù†Ø§ â€” Ù„Ø¹Ø¨Ø© Ø·Ø¨Ø® ÙˆØªØ²ÙŠÙŠÙ† Ù…Ø´ØªØ±ÙƒØ© (Live)</div>

<div class="kitWrap">
<!-- Top -->
<div class="kitTopRow">
<div class="kitBadge" id="kitStageBadge">Ø§Ù„Ù…Ø±Ø­Ù„Ø©: â€¦</div>
<div class="kitBadge" id="kitRecipeBadge">Ø§Ù„ÙˆØµÙØ©: â€¦</div>
</div>

<div class="kitTabs">
  <div class="kitBadge" style="margin-top:10px">ğŸ° Ø­Ù„ÙˆÙŠØ§Øª ÙÙ‚Ø· â€” Ø±ÙˆÙ…Ù†Ø³ÙŠ & Live ğŸ’—</div>
  <button class="actionBtn kitAlbumBtn" id="kitAlbumBtn">ğŸ–¼ï¸ Ø§Ù„Ø£Ù„Ø¨ÙˆÙ…</button>
</div>

<div class="kitChars">
  <div class="kitCharCard">
    <div class="kitCharEmoji">ğŸ‘©â€ğŸ³ğŸ€</div>
    <div class="kitCharName">CHEF GIRL</div>
    <div class="kitCharSub">Ù„Ø§Ù†Ø§</div>
  </div>

  <div class="kitTable">
    <div class="kitTableTop">
      <div class="kitTableTitle">Ù…Ø·Ø¨Ø® Ø§Ù„Ø­Ù„ÙˆÙŠØ§Øª</div>
      <div class="kitMiniLine" id="kitLiveLine2">â€¦</div>
    </div>
    <div class="kitProgress" id="kitProgressText2">Ø§Ø®ØªØ§Ø±ÙˆØ§ ÙˆØµÙØ© ÙˆØ§Ø¨Ø¯Ø£ÙˆØ§ ğŸ‘‡</div>
  </div>

  <div class="kitCharCard">
    <div class="kitCharEmoji">ğŸ‘¨â€ğŸ³ğŸ§‘â€â¤ï¸â€ğŸ§‘</div>
    <div class="kitCharName">CHEF BOY</div>
    <div class="kitCharSub">Ø£Ù†Ø³</div>
  </div>
</div>

<div class="kitTable">
<div class="kitTableTop">
<div class="kitTableTitle">Ø·Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ±</div>
<div class="kitMiniLine" id="kitLiveLine">â€¦</div>
</div>
<div class="kitProgress" id="kitProgressText">Ø§Ø®ØªØ§Ø±ÙˆØ§ ÙˆØµÙØ© ÙˆØ§Ø¨Ø¯Ø£ÙˆØ§ ğŸ‘‡</div>
</div>

<div class="kitCharCard">
<div class="kitCharEmoji">ğŸ¦‡</div>
<div class="kitCharName">BATMAN</div>
<div class="kitCharSub">Ø£Ù†Ø³</div>
</div>
</div>

<!-- Recipe picker -->
<div class="kitPanel">
<div class="kitPanelTitle">
<span>ğŸ“– Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆØµÙØ©</span>
<span class="kitMini" id="kitPickerHint">Ù„Ø§Ø²Ù… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø±ÙÙŠÙ† âœ…</span>
</div>

<div class="kitRecipeGrid" id="kitRecipeGrid"></div>

<div class="kitConfirmRow">
<button class="actionBtn" id="kitConfirmRecipeBtn">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙˆØµÙØ© (Ù„Ø§Ø²Ù… Ø§Ù„Ø§Ø«Ù†ÙŠÙ†)</button>
<button class="actionBtn" id="kitResetAllBtn">ğŸ§¹ ØªØµÙÙŠØ± Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
</div>

<div class="kitConfirmLine" id="kitRecipeConfirmLine">â€¦</div>
</div>

<!-- âœ… Build (Layers + Filling + Plate colors) -->
<div class="kitPanel">
  <div class="kitPanelTitle">
    <span>ğŸ° Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø­Ù„Ùˆ</span>
    <span class="kitMini" id="kitBuildMini">â€¦</span>
  </div>

  <div class="kitStepCard">
    <div class="kitStepTitle" id="kitBuildTitle">â€¦</div>
    <div class="kitStepDesc" id="kitBuildDesc">â€¦</div>

    <!-- Visual cake preview -->
    <div class="kitDecoBoard" id="kitCakeBoard" style="aspect-ratio:16/9; margin-top:12px">
      <div class="kitDecoHint" id="kitCakeHint">Ø§Ø®ØªØ§Ø±ÙˆØ§ ÙˆØµÙØ© Ø£ÙˆÙ„Ù‹Ø§â€¦ Ø¨Ø¹Ø¯ÙŠÙ† ØªØ¨Ø¯Ø£ÙˆÙ† Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª ğŸ’—</div>
    </div>

    <div class="kitDecoTools" style="margin-top:12px">
      <button class="kitTool" data-build="addLayer">â• Ø·Ø¨Ù‚Ø©</button>
      <button class="kitTool" data-build="addFilling">ğŸ¥› Ø­Ø´ÙˆØ©</button>
      <button class="kitTool" data-build="plateColor">ğŸ¨ ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø·Ø¨Ù‚</button>
      <button class="kitTool" data-build="undo">â†©ï¸ ØªØ±Ø§Ø¬Ø¹</button>
      <button class="kitTool" data-build="resetBuild">ğŸ§¹ ØªØµÙÙŠØ± Ø§Ù„Ø¨Ù†Ø§Ø¡</button>
    </div>

    <div class="kitActions" style="margin-top:12px">
      <button class="actionBtn" id="kitReadyBuildBtn">âœ… Ø£Ù†Ø§ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„</button>
    </div>

    <div class="kitConfirmLine" id="kitBuildConfirmLine">â€¦</div>
  </div>
</div>

<!-- Decoration -->
<div class="kitPanel">
<div class="kitPanelTitle">
<span>ğŸ¨ Ø§Ù„ØªØ²ÙŠÙŠÙ† Ø§Ù„Ø­Ø±</span>
<span class="kitMini">Ø§Ø¶ØºØ· Ù„Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ØµØ± â€” Live</span>
</div>

<div class="kitDecoBoard" id="kitDecoBoard">
<div class="kitDecoHint" id="kitDecoHint">Ø§Ø¨Ø¯Ø£ÙˆØ§ Ø§Ù„ØªØ²ÙŠÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù…Ø±Ø­Ù„Ø© â€œØ§Ù„ØªØ²ÙŠÙŠÙ†â€ ğŸ’—</div>
</div>

<div class="kitDecoTools">
<button class="kitTool" data-tool="layer">ğŸ° Ø·Ø¨Ù‚Ø©</button>
<button class="kitTool" data-tool="cream">ğŸ¦ ÙƒØ±ÙŠÙ…Ø©</button>
<button class="kitTool" data-tool="sauce">ğŸ« ØµÙˆØµ</button>
<button class="kitTool" data-tool="fruit">ğŸ“ ÙÙˆØ§ÙƒÙ‡</button>
<button class="kitTool" data-tool="choco">ğŸª Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©</button>
<button class="kitTool" data-tool="sprinkle">âœ¨ Ø±Ø´Ù‘Ø§Øª</button>
<button class="kitTool" data-tool="candle">ğŸ•¯ï¸ Ø´Ù…ÙˆØ¹</button>
<button class="kitTool" data-tool="heart">ğŸ’— Ù‚Ù„ÙˆØ¨</button>
<button class="kitTool" data-tool="text">ğŸ“ Ø§Ø³Ù…</button>
<button class="kitTool" data-tool="random">ğŸ² Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
</div>

<div class="kitConfirmRow" style="margin-top:12px">
<button class="actionBtn" id="kitMadeByUsBtn">ğŸ’— ØµÙ†Ø¹ ÙŠØ¯Ù†Ø§</button>
<button class="actionBtn" id="kitSaveBtn">ğŸ“Œ Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø£Ù„Ø¨ÙˆÙ…</button>
</div>

<div class="kitStatus" id="kitStatus">â€¦</div>
</div>
</div>
</div>

<!-- Album modal (Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø©) -->
<div class="kitModal" id="kitAlbumModal">
<div class="kitModalCard">
<div class="kitModalHead">
<div style="font-weight:900">ğŸ–¼ï¸ Ø£Ù„Ø¨ÙˆÙ… Ù…Ø·Ø¨Ø®Ù†Ø§ (Live)</div>
<button class="closeBtn" id="kitAlbumClose">âœ•</button>
</div>
<div class="kitAlbumGrid" id="kitAlbumGrid"></div>
<div class="kitAlbumHint">ÙƒÙ„ Ø­ÙØ¸ = ØµÙˆØ±Ø© + Ø§Ø³Ù… + ØªØ§Ø±ÙŠØ® âœ…</div>
</div>
</div>
</section>

<section class="page" id="pageOpt6">
  <div class="contentBox">
    <button class="backBtn backAny">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>

    <div class="promptCard" style="font-size:20px">âš–ï¸ ØªØ­Ù‚ÙŠÙ‚ Ù†ÙØ³ÙŠ â€” 100 Ù‚Ø¶ÙŠØ© (Live) ğŸŸ</div>

    <div class="fishWrap" style="margin-top:12px">
      <div class="fishTopRow">
        <div class="fishBadge" id="invStageBadge">Ø§Ù„Ù‚Ø¶ÙŠØ©: 1 / 100</div>
        <div class="fishBadge" id="invRoleBadge">Ø§Ù„Ø¯ÙˆØ±: â€¦</div>
      </div>

      <!-- ğŸŸ Ø§Ù„Ù‚Ø§Ø¶ÙŠ -->
      <div class="fishCard" style="text-align:right">
        <p class="fishQ" id="invJudgeLine">ğŸŸâš–ï¸ Ø§Ù„Ø³Ù…ÙƒØ© Ø§Ù„Ù‚Ø§Ø¶ÙŠ: â€¦</p>

        <!-- ÙˆØ±Ù‚Ø© Ø§Ù„Ù‚Ø¶ÙŠØ© (Ø§Ù„ØªÙ‡Ù…Ø©) -->
        <div class="casePaper" id="invChargePaper">
          <div class="casePaperTop">
            <div class="caseStamp">OFFICIAL</div>
            <div class="caseTitle" id="invCaseTitle">Ù‚Ø¶ÙŠØ© Ø±Ù‚Ù… â€¦</div>
          </div>
          <div class="caseChargeRow">
            <div class="caseLabel">Ø§Ù„ØªÙ‡Ù…Ø©</div>
            <div class="caseCharge" id="invCharge">â€¦</div>
          </div>
        </div>

        <!-- Ù…Ø­ØªÙˆÙ‰ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ± -->
        <div class="invGrid">
          <div class="invCard">
            <div class="invHead">ğŸ‘®â€â™‚ï¸ Ù…Ù„Ù Ø§Ù„Ù…Ø­Ù‚Ù‚ (Ù…Ø®ØªØµØ± Ø¨Ø¯ÙˆÙ† ØªÙØ³ÙŠØ±)</div>
            <div class="invText" id="invBrief">â€¦</div>
          </div>

          <div class="invCard">
            <div class="invHead">ğŸ•µï¸â€â™€ï¸ Ù…Ù„Ù Ø§Ù„Ù…ØªÙ‡Ù… (Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ ÙƒØ§Ù…Ù„ + Ø¯ÙˆØ§ÙØ¹)</div>
            <div class="invText" id="invFull">â€¦</div>

            <div class="invTruthBox" id="invTruthBox">
              <div class="invTruthHead">ğŸ”’ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© (Ù„Ù„Ù…ØªÙ‡Ù… ÙÙ‚Ø·)</div>
              <div class="invTruth" id="invTruth">â€¦</div>
            </div>
          </div>
        </div>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙƒÙ… (Ù„Ù„Ù…Ø­Ù‚Ù‚ ÙÙ‚Ø·) -->
        <div class="fishActions" id="invActions">
          <button class="actionBtn" id="invBtnGuilty">ğŸ”¨ Ù…Ø°Ù†Ø¨</button>
          <button class="actionBtn" id="invBtnInnocent">ğŸ•Šï¸ Ø¨Ø±ÙŠØ¡</button>
        </div>

        <div class="fishResult" id="invResult">â€¦</div>

        <div class="confirmLine" id="invLockLine">ğŸ”’ Ù„Ø§ Ø±Ø¬Ø¹Ø©: â€¦</div>
        <div class="statusLine" id="invStatus">â€¦</div>
      </div>

      <div class="hint">
        âœ… Ø§Ù„Ù…ØªÙ‡Ù… ÙŠØ¹Ø±Ù Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© â€” Ø§Ù„Ù…Ø­Ù‚Ù‚ Ù„Ø§ ÙŠØ¹Ø±Ù Ø´ÙŠØ¦Ù‹Ø§ Ø¹Ù†Ù‡Ø§<br/>
        ğŸ”’ Ø§Ù„Ø­ÙƒÙ… ÙÙˆØ±ÙŠ ÙˆÙ†Ù‡Ø§Ø¦ÙŠ â€” Ù…Ø§ ØªÙ‚Ø¯Ø±ÙˆÙ† ØªØ±Ø¬Ø¹ÙˆÙ† Ù„Ù‚Ø¶ÙŠØ© Ù‚Ø¯ÙŠÙ…Ø© Ø­ØªÙ‰ Ø¨Ø¹Ø¯ Ø£ÙŠØ§Ù…<br/>
        ğŸ” Ø§Ù„Ø¯ÙˆØ± ÙŠÙ†Ù‚Ù„Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙƒÙ„ Ù‚Ø¶ÙŠØ©
      </div>
    </div>
  </div>
</section>
<section class="page" id="pageOpt7">
<div class="contentBox">
<button class="backBtn backAny">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
<div class="promptCard">Ø§Ù„Ø®ÙŠØ§Ø± 7 (Ø¬Ø§Ù‡Ø² Ù„Ù„ØµÙ‚ Ù„Ø¹Ø¨ØªÙƒÙ… Ù‡Ù†Ø§)</div>
</div>
</section>

<section class="page" id="pageOpt8">
<div class="contentBox">
<button class="backBtn backAny">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
<div class="promptCard">Ø§Ù„Ø®ÙŠØ§Ø± 8 (Ø¬Ø§Ù‡Ø² Ù„Ù„ØµÙ‚ Ù„Ø¹Ø¨ØªÙƒÙ… Ù‡Ù†Ø§)</div>
</div>
</section>

<section class="page" id="pageOpt9">
<div class="contentBox">
<button class="backBtn backAny">ğŸ  Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
<div class="promptCard">Ø§Ù„Ø®ÙŠØ§Ø± 9 (Ø¬Ø§Ù‡Ø² Ù„Ù„ØµÙ‚ Ù„Ø¹Ø¨ØªÙƒÙ… Ù‡Ù†Ø§)</div>
</div>
</section>

</div>
</div>
</div>

<!-- MENU MODAL -->
<div class="modal" id="modal">
<div class="modalCard">
<div class="modalHead">
<h3>ğŸ’— Ø§Ø®ØªÙØ± Ù…Ù† Ø¹Ø§Ù„Ù…Ù†Ø§ (Live)</h3>
<button class="closeBtn" id="closeModal">âœ•</button>
</div>
<div class="grid">
<button class="opt" data-go="pageGame">1) Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button>
<button class="opt" data-go="pageOpt2">2) <small>(Ø¬Ø§Ù‡Ø²)</small></button>
<button class="opt" data-go="pageOpt3">3) Ø£Ù„ØºØ§Ø² Ø§Ù„Ø¨Ø­Ø± <small>(Live)</small></button>
<button class="opt" data-go="pageOpt4">4) Ø¨Ø²Ù„ Ù‚Ø³Ù…ÙŠÙ† <small>(Live)</small></button>
<button class="opt" data-go="pageOpt5">5) <small>(Ø¬Ø§Ù‡Ø²)</small></button>
<button class="opt" data-go="pageOpt6">6) <small>(Ø¬Ø§Ù‡Ø²)</small></button>
<button class="opt" data-go="pageOpt7">7) <small>(Ø¬Ø§Ù‡Ø²)</small></button>
<button class="opt" data-go="pageOpt8">8) <small>(Ø¬Ø§Ù‡Ø²)</small></button>
<button class="opt" data-go="pageOpt9">9) <small>(Ø¬Ø§Ù‡Ø²)</small></button>
</div>
</div>
</div>

<!-- ğŸ”¥ Firebase (Module) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, doc, setDoc, updateDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyBTr4NrjrEq3Lh23PIJ_Zz-KRr6yqgafyU",
authDomain: "lanasnas-8de50.firebaseapp.com",
projectId: "lanasnas-8de50",
storageBucket: "lanasnas-8de50.firebasestorage.app",
messagingSenderId: "847037285771",
appId: "1:847037285771:web:096d4a14a984de41955b8e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.fb = { auth, db, signInWithEmailAndPassword, onAuthStateChanged, signOut, doc, setDoc, updateDoc, onSnapshot, serverTimestamp };
</script>

<script>
/********************
* Hearts generator
********************/
const heartsEl = document.getElementById("hearts");
const HEARTS = ["â¤ï¸","ğŸ’—","ğŸ’","ğŸ’•","ğŸ’“","ğŸ’–","ğŸ’˜","ğŸ’","ğŸ’Ÿ","ğŸŒ¹"];
function rand(min,max){ return Math.random()*(max-min)+min; }
function spawnHearts(){
heartsEl.innerHTML = "";
const count = 26;
for(let i=0;i<count;i++){
const s = document.createElement("div");
s.className = "heart";
s.textContent = HEARTS[Math.floor(Math.random()*HEARTS.length)];
const left = rand(2,98);
const dur = rand(7,16);
const delay = rand(0,10);
const size = rand(16,28);
s.style.left = left+"vw";
s.style.animationDuration = dur+"s";
s.style.animationDelay = (-delay)+"s";
s.style.fontSize = size+"px";
s.style.opacity = rand(.55,.95);
heartsEl.appendChild(s);
}
}
spawnHearts();
setInterval(spawnHearts, 12000);

/********************
* Rain generator (Option 3 theme)
********************/
const rainEl = document.getElementById("rain");
function spawnRain(){
if(!rainEl) return;
rainEl.innerHTML = "";
const count = 70;
for(let i=0;i<count;i++){
const d = document.createElement("div");
d.className = "drop";
d.style.left = rand(0,100) + "vw";
d.style.animationDuration = rand(0.7, 1.6) + "s";
d.style.animationDelay = (-rand(0,2.5)) + "s";
d.style.height = rand(10, 22) + "px";
d.style.opacity = rand(0.25, 0.8);
rainEl.appendChild(d);
}
}
spawnRain();
setInterval(spawnRain, 9000);

/********************
* Emoji rain (ğŸŸâ¤ï¸â“) for Option 3
********************/
const seaEmojisEl = document.getElementById("seaEmojis");
const SEA_EMOJIS = ["ğŸŸ","â¤ï¸","â“","ğŸ’—","ğŸ ","ğŸ’•","â”","ğŸ’˜"];
function spawnSeaEmojis(){
if(!seaEmojisEl) return;
seaEmojisEl.innerHTML = "";
const count = 34;
for(let i=0;i<count;i++){
const e = document.createElement("div");
e.className = "seaEmoji";
e.textContent = SEA_EMOJIS[Math.floor(Math.random()*SEA_EMOJIS.length)];
e.style.left = rand(2,98) + "vw";
e.style.animationDuration = rand(5.5, 11) + "s";
e.style.animationDelay = (-rand(0,7)) + "s";
e.style.fontSize = rand(16, 30) + "px";
e.style.opacity = rand(.45,.95);
seaEmojisEl.appendChild(e);
}
}
spawnSeaEmojis();
setInterval(spawnSeaEmojis, 11000);

/********************
* Puzzle-piece rain (Option 4)
********************/
const puzzleRainEl = document.getElementById("puzzleRain");
function spawnPuzzleRain(){
if(!puzzleRainEl) return;
puzzleRainEl.innerHTML = "";
const count = 40;
for(let i=0;i<count;i++){
const d = document.createElement("div");
d.className = "puzDrop";
d.style.left = rand(0,100) + "vw";
d.style.animationDuration = rand(2.6, 6.2) + "s";
d.style.animationDelay = (-rand(0,3.0)) + "s";
const size = rand(12, 20);
d.style.width = size + "px";
d.style.height = size + "px";
d.style.opacity = rand(0.30, 0.80);
d.style.borderRadius = rand(5, 9) + "px";
puzzleRainEl.appendChild(d);
}
}
spawnPuzzleRain();
setInterval(spawnPuzzleRain, 11000);

/********************
* Wait for Firebase
********************/
function waitForFb(){
return new Promise((resolve)=>{
const t = setInterval(()=>{
if(window.fb && window.fb.auth && window.fb.db){
clearInterval(t);
resolve(true);
}
}, 50);
});
}

/********************
* Pages
********************/
const pages = Array.from(document.querySelectorAll(".page"));
const topbar = document.getElementById("topbar");

function showPageLocal(id){
pages.forEach(p=>p.classList.remove("active"));
const el = document.getElementById(id);
if(el) el.classList.add("active");

const isSea = (id === "pageOpt3");
document.body.classList.toggle("seaTheme", isSea);
if(isSea) spawnSeaEmojis();

const isPuz = (id === "pageOpt4");
document.body.classList.toggle("puzzleTheme", isPuz);
if(isPuz) spawnPuzzleRain();

// âœ… Helpful: Ù†Ø±Ø¬Ø¹ Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø£ÙˆÙ„ Ù…Ø§ ØªÙØªØ­ ØµÙØ­Ø©
try{
document.querySelector(".inner")?.scrollTo({ top: 0, behavior: "smooth" });
}catch(e){}
}

/********************
* Menu modal (UI only)
********************/
const modal = document.getElementById("modal");
const menuBtn = document.getElementById("menuBtn");
const closeModal = document.getElementById("closeModal");

function openModal(){ modal.classList.add("show"); }
function closeModalFn(){ modal.classList.remove("show"); }

menuBtn?.addEventListener("click", openModal);
closeModal?.addEventListener("click", closeModalFn);
modal?.addEventListener("click", (e)=>{ if(e.target===modal) closeModalFn(); });

/********************
* Packs â€” Ù„Ø¹Ø¨Ø© 1
********************/
const lana1_questions = [
"Ù…ØªÙ‰ Ø­Ø³Ù‘ÙŠØª Ø¥Ù†Ùƒ Ù…Ø±ØªØ§Ø­ Ù…Ø¹ÙŠ Ø¨Ø¯ÙˆÙ† Ù…Ø§ ØªÙ…Ø«Ù‘Ù„ØŸ",
"ÙˆØ´ Ø§Ù„Ø´ÙŠ Ø§Ù„Ù„ÙŠ ØªØ­Ø¨Ù‡ ÙÙŠÙ‘ ÙˆÙ…Ø§ ØªÙ‚ÙˆÙ„Ù‡ ÙƒØ«ÙŠØ±ØŸ",
"Ù…ØªÙ‰ ØªØ­Ø³ Ø¥Ù†ÙŠ Ø£Ù‚Ø±Ø¨ Ù„Ùƒ: Ø¨Ø§Ù„ÙƒÙ„Ø§Ù… ÙˆÙ„Ø§ Ø¨Ø§Ù„Ø³ÙƒÙˆØªØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± ØªØµØ±Ù Ø¨Ø³ÙŠØ· Ù…Ù†ÙŠ ÙŠØ£Ø«Ø± ÙÙŠÙƒØŸ",
"ÙˆØ´ Ø´Ø¹ÙˆØ±Ùƒ Ù„Ù…Ø§ Ø£Ø·ÙˆÙ‘Ù„ ÙˆÙ…Ø§ Ø£Ø±Ø¯ØŸ",
"ÙƒÙŠÙ ØªØ­Ø¨ Ø£ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ùƒ ÙˆÙ‚Øª Ø²Ø¹Ù„ÙƒØŸ",
"ÙˆØ´ Ø§Ù„Ø´ÙŠ Ø§Ù„Ù„ÙŠ ØªØªØ±Ø¯Ø¯ ØªÙ‚ÙˆÙ„Ù‡ Ù„ÙŠØŸ",
"Ù…ØªÙ‰ Ø­Ø³Ù‘ÙŠØª Ø¥Ù†ÙŠ ÙÙ‡Ù…ØªÙƒ ÙØ¹Ù„Ù‹Ø§ØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ÙŠØ·Ù…Ù†Ùƒ Ø¨Ø¹Ù„Ø§Ù‚ØªÙ†Ø§ØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ÙŠÙ‚Ù„Ù‚Ùƒ Ø¹Ù„ÙŠÙ†Ø§ØŸ",
"Ù„Ùˆ Ù†Ø®ØªÙ„ÙØŒ ÙˆØ´ ØªØªÙ…Ù†Ù‰ Ù…Ø§ ÙŠØµÙŠØ± Ø¨ÙŠÙ†Ø§ØŸ",
"ÙˆØ´ Ø§Ù„Ø´ÙŠ Ø§Ù„Ù„ÙŠ ØªØ­Ø¨ Ø£Ø­Ø§ÙØ¸ Ø¹Ù„ÙŠÙ‡ Ø¯Ø§ÙŠÙ…Ù‹Ø§ØŸ",
"Ù…ØªÙ‰ ØªØ­Ø³ Ø¥Ù†Ùƒ ØªØ­ØªØ§Ø¬Ù†ÙŠ Ø£ÙƒØ«Ø±ØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ØªØ­Ø¨ Ù†Ø³ÙˆÙŠÙ‡ Ø³ÙˆØ§ØŸ",
"ÙˆØ´ Ø´ÙŠ ØªØªÙ…Ù†Ù‰ Ø£Ù„Ø§Ø­Ø¸Ù‡ Ø¨Ø¯ÙˆÙ† Ù…Ø§ ØªØ·Ù„Ø¨ØŸ",
"ÙƒÙŠÙ ØªØ­Ø¨ Ø£Ø¹Ø¨Ù‘Ø± Ù„Ùƒ Ø¹Ù† Ø­Ø¨ÙŠØŸ",
"ÙˆØ´ Ù…ÙˆÙ‚Ù Ø®Ù„Ø§Ùƒ ØªØªØ¹Ù„Ù‘Ù‚ ÙÙŠÙ‘ Ø£ÙƒØ«Ø±ØŸ",
"ÙˆØ´ Ø´Ø¹ÙˆØ±Ùƒ Ù„Ù…Ø§ Ø£ÙƒÙˆÙ† Ù…Ø´ØºÙˆÙ„ØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± ÙƒÙ„Ù…Ø© ØªØ£Ø«Ø± ÙÙŠÙƒ Ù…Ù†ÙŠØŸ",
"ÙˆØ´ Ø´ÙŠ Ø¨ÙŠÙ†Ø§ ØªØ­Ø¨ ÙŠÙƒÙˆÙ† Ø®Ø§ØµØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ÙŠØ®Ù„ÙŠÙƒ ØªØ­Ø³ Ø¨Ø§Ù„Ø£Ù…Ø§Ù† Ù…Ø¹ÙŠØŸ",
"ÙˆØ´ ØªØ®Ø§Ù Ù†Ø®Ø³Ø±Ù‡ Ù„Ùˆ Ø£Ù‡Ù…Ù„Ù†Ø§Ù‡ØŸ",
"ÙˆØ´ ÙˆØ¯Ùƒ Ù†Ø·ÙˆÙ‘Ø±Ù‡ ÙÙŠ ØªÙˆØ§ØµÙ„Ù†Ø§ØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ÙŠÙˆØ¬Ø¹Ùƒ Ù„Ùˆ ØµØ§Ø± Ø¨ÙŠÙ†Ø§ØŸ",
"Ù…ØªÙ‰ Ø­Ø³Ù‘ÙŠØª Ø¥Ù†Ùƒ ØªØ­Ø¨Ù†ÙŠØŸ",
"ÙˆØ´ ØªØªÙ…Ù†Ù‰ Ø£Ø³ÙˆÙŠÙ‡ Ù„Ù…Ø§ ØªÙƒÙˆÙ† Ù…ØªØ¶Ø§ÙŠÙ‚ØŸ",
"ÙˆØ´ ØªØµØ±Ù Ù…Ù†ÙŠ ÙŠÙØ±Ù‚ Ù…Ø¹Ùƒ Ø£ÙƒØ«Ø± Ù…Ù…Ø§ Ø£ØªÙˆÙ‚Ø¹ØŸ",
"ÙˆØ´ Ø´ÙŠ ØªØ­Ø¨Ù†ÙŠ Ø£Ø³ØªÙ…Ø± Ø£Ø³ÙˆÙŠÙ‡ØŸ",
"ÙˆØ´ Ø´ÙŠ ØªØ­Ø¨Ù†ÙŠ Ø£ÙˆÙ‚Ù‘Ù Ø£Ø³ÙˆÙŠÙ‡ØŸ",
"ÙˆØ´ ØªØ­Ø³ Ø¥Ù†ÙŠ Ø£Ø¶ÙŠÙÙ‡ Ù„Ø­ÙŠØ§ØªÙƒØŸ",
"Ù„Ùˆ ÙˆØµÙØª Ø¹Ù„Ø§Ù‚ØªÙ†Ø§ Ø¨ÙƒÙ„Ù…Ø©ØŒ ÙˆØ´ ØªÙƒÙˆÙ†ØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ÙŠØ®Ù„ÙŠÙƒ ØªØ´ØªØ§Ù‚ Ù„ÙŠØŸ",
"ÙˆØ´ Ù„Ø­Ø¸Ø© Ø¨ÙŠÙ†Ø§ Ù…Ø§ ØªÙ†Ø³Ø§Ù‡Ø§ØŸ",
"ÙˆØ´ ØªØ­Ø¨ ÙÙŠ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù‡ØªÙ…Ø§Ù…ÙŠØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ÙŠØ·Ù…Ù†Ùƒ ÙÙŠ ÙˆØ¬ÙˆØ¯ÙŠØŸ",
"ÙˆØ´ ÙˆØ¯Ùƒ Ø£Ø³Ù…Ø¹Ù‡ Ù…Ù†Ùƒ Ø£ÙƒØ«Ø±ØŸ",
"ÙˆØ´ ØªØ­Ø³ Ø¥Ù†ÙŠ Ø£ÙÙ‡Ù…Ù‡ Ø¹Ù†ÙƒØŸ",
"ÙˆØ´ ØªØ­Ø³ Ø¥Ù†ÙŠ Ù…Ø§ Ø£ÙÙ‡Ù…Ù‡ Ø¹Ù†ÙƒØŸ",
"ÙˆØ´ ÙˆØ¹Ø¯ ØªØ­Ø¨ Ù†Ù„ØªØ²Ù… ÙÙŠÙ‡ Ø³ÙˆØ§ØŸ",
"ÙˆØ´ Ø´Ø¹ÙˆØ±Ùƒ Ù„Ù…Ø§ ØªØªØ®ÙŠÙ„ Ù…Ø³ØªÙ‚Ø¨Ù„Ù†Ø§ØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ØªØ­Ø¨Ù‡ ÙÙŠ Ù‚Ø±Ø¨Ù†Ø§ØŸ",
"ÙˆØ´ Ø´ÙŠ ØªØªÙ…Ù†Ù‰ Ù†Ø¹ÙŠØ´Ù‡ Ø³ÙˆØ§ØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ÙŠØ®Ù„ÙŠÙƒ ØªØ­Ø³ Ø¥Ù†Ùƒ Ù…Ù‡Ù… Ø¹Ù†Ø¯ÙŠØŸ",
"ÙˆØ´ ØªØ­Ø¨ ØªØ³Ù…Ø¹Ù‡ Ù…Ù†ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…ØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ÙŠØ®Ù„ÙŠÙƒ ØªØ­Ø³ Ø¨Ø§Ù„Ø­Ø¨ØŸ"
];

const lana1_challenges = [
"Ù‚ÙˆÙ„ Ø¨ØµÙˆØªÙƒ: Ø´Ø¹ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù† Ø¨ØµØ¯Ù‚.",
"Ù‚ÙˆÙ„: 3 Ø£Ø´ÙŠØ§Ø¡ ØªØ­Ø³Ù‡Ø§ Ø¨ÙŠÙ†Ø§ ÙˆÙ…Ø§ ØªØ­Ø¨ ØªØ¶ÙŠØ¹.",
"Ù‚ÙˆÙ„: Ø¬Ù…Ù„Ø© ØªØ­Ø¨ ØªØ³Ù…Ø¹Ù‡Ø§ Ù…Ù†ÙŠ.",
"Ù‚ÙˆÙ„ Ø¨ØµÙˆØªÙƒ: Ù„Ø­Ø¸Ø© Ø­Ø³Ù‘ÙŠØª ÙÙŠÙ‡Ø§ Ø¥Ù†Ùƒ Ù‚Ø±ÙŠØ¨ Ù…Ù†ÙŠ.",
"Ù‚ÙˆÙ„: Ø´ÙŠ ÙŠØ·Ù…Ù†Ùƒ Ø¨Ø¹Ù„Ø§Ù‚ØªÙ†Ø§.",
"ØµÙˆÙ‘Ø±: Ø´ÙŠØ¡ Ø­ÙˆÙ„Ùƒ ØªØ­Ø³Ù‘Ù‡ ÙŠØ¹Ø¨Ù‘Ø± Ø¹Ù† Ù‡Ø¯ÙˆØ¡.",
"Ù‚ÙˆÙ„: Ø´ÙŠ ÙˆØ¯Ùƒ Ø£Ø³ØªÙ…Ø± Ø£Ø³ÙˆÙŠÙ‡.",
"Ù‚ÙˆÙ„ Ø¨ØµÙˆØªÙƒ: ÙƒÙŠÙ ØªØ­Ø¨ Ø£ÙˆØ§Ø³ÙŠÙƒ.",
"ØµÙˆÙ‘Ø±: Ø´ÙŠØ¡ ØªØ­Ø¨Ù‡ ÙÙŠ Ù…ÙƒØ§Ù†Ùƒ Ø§Ù„Ø¢Ù†.",
"Ù‚ÙˆÙ„: Ø´ÙŠ ØªØ®Ø§Ù Ù†Ø®Ø³Ø±Ù‡ Ø¨ÙŠÙ†Ø§.",
"Ù‚ÙˆÙ„ Ø¨ØµÙˆØªÙƒ: Ù„ÙŠÙ‡ ÙˆØ¬ÙˆØ¯ÙŠ Ù…Ù‡Ù… Ù„Ùƒ.",
"ØµÙˆÙ‘Ø±: Ù„ÙˆÙ† ØªØ­Ø³Ù‘Ù‡ ÙŠÙ…Ø«Ù‘Ù„ Ø´Ø¹ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†.",
"Ù‚ÙˆÙ„: Ø´ÙŠ ØªØ­Ø¨ Ù†Ø³ÙˆÙŠÙ‡ Ø³ÙˆØ§ ÙƒØ«ÙŠØ±.",
"ØµÙˆÙ‘Ø±: Ø´ÙŠØ¡ Ø¨Ø³ÙŠØ· ÙŠÙØ±Ù‘Ø­Ùƒ.",
"Ù‚ÙˆÙ„ Ø¨ØµÙˆØªÙƒ: Ø£Ø¬Ù…Ù„ Ù„Ø­Ø¸Ø© Ø­Ø³Ù‘ÙŠØª ÙÙŠÙ‡Ø§ Ø¨Ø§Ù„Ø­Ø¨.",
"Ù‚ÙˆÙ„: Ø´ÙŠ ÙˆØ¯Ùƒ Ø£Ù‚ÙˆÙ„Ù‡ Ù„Ùƒ Ø£ÙƒØ«Ø±.",
"ØµÙˆÙ‘Ø±: Ø´ÙŠØ¡ ÙŠØ°ÙƒÙ‘Ø±Ùƒ Ø¨Ø§Ù„Ø±Ø§Ø­Ø©.",
"Ù‚ÙˆÙ„ Ø¨ØµÙˆØªÙƒ: Ø´ÙŠ ØªØ­Ø¨Ù†ÙŠ Ø£Ù‚Ø¯Ù‘Ø±Ù‡ ÙÙŠÙƒ.",
"ØµÙˆÙ‘Ø±: Ø´ÙŠØ¡ ØªØ­Ø³Ù‘Ù‡ Ø¯Ø§ÙÙŠ.",
"Ù‚ÙˆÙ„: Ø´ÙŠ ÙŠØ±ÙŠØ­Ùƒ Ù„Ù…Ø§ ØªØ³Ù…Ø¹Ù‡.",
"Ù‚ÙˆÙ„ Ø¨ØµÙˆØªÙƒ: ÙˆØ´ ØªØ­Ø³ Ù„Ù…Ø§ Ø£ÙƒÙˆÙ† Ø¬Ù†Ø¨Ùƒ.",
"ØµÙˆÙ‘Ø±: Ø´ÙŠØ¡ ØªØ­Ø¨ ÙˆØ¬ÙˆØ¯Ù‡ Ø¨Ø­ÙŠØ§ØªÙƒ.",
"Ù‚ÙˆÙ„: Ø´ÙŠ ØªØ­Ø¨Ù†ÙŠ Ø£Ù„Ø§Ø­Ø¸Ù‡.",
"ØµÙˆÙ‘Ø±: Ù„Ù‚Ø·Ø© ØªØ¹Ø¬Ø¨Ùƒ Ø§Ù„Ø¢Ù†.",
"Ù‚ÙˆÙ„ Ø¨ØµÙˆØªÙƒ: ÙƒÙ„Ù…Ø© ØªØ­Ø³Ù‡Ø§ Ø¨ÙŠÙ†Ø§.",
"Ù‚ÙˆÙ„: Ø´ÙŠ ØªØªÙ…Ù†Ù‰ Ù†Ø¹ÙŠØ´Ù‡ Ø³ÙˆØ§.",
"ØµÙˆÙ‘Ø±: Ø´ÙŠØ¡ ÙŠØ®Ù„ÙŠÙƒ ØªØ¨ØªØ³Ù….",
"Ù‚ÙˆÙ„ Ø¨ØµÙˆØªÙƒ: ÙƒÙŠÙ ØªØ´ÙˆÙÙ†Ø§.",
"ØµÙˆÙ‘Ø±: Ø´ÙŠØ¡ ÙŠØ¹ÙƒØ³ Ù…Ø²Ø§Ø¬Ùƒ.",
"Ù‚ÙˆÙ„: Ø´ÙŠ ÙŠØ®Ù„ÙŠÙƒ ØªØ­Ø³ Ø¨Ø§Ù„Ø­Ø¨.",
"Ù‚ÙˆÙ„ Ø¨ØµÙˆØªÙƒ: ÙˆØ¹Ø¯ Ø¨Ø³ÙŠØ·.",
"ØµÙˆÙ‘Ø±: Ø´ÙŠØ¡ ÙˆØ¯Ùƒ ØªØ´Ø§Ø±ÙƒÙ†ÙŠ Ø¥ÙŠØ§Ù‡.",
"Ù‚ÙˆÙ„: Ø´ÙŠ ØªØ­Ø¨ ØªØ³Ù…Ø¹Ù‡ Ù…Ù†ÙŠ.",
"ØµÙˆÙ‘Ø±: Ø´ÙŠØ¡ ØªØ­Ø³Ù‘Ù‡ Ø®Ø§Øµ.",
"Ù‚ÙˆÙ„ Ø¨ØµÙˆØªÙƒ: Ø¬Ù…Ù„Ø© Ù…Ù† Ù‚Ù„Ø¨Ùƒ.",
"Ù‚ÙˆÙ„: Ø´ÙŠ ØªØ­Ø¨Ù†ÙŠ Ø£Ø­Ø§ÙØ¸ Ø¹Ù„ÙŠÙ‡.",
"ØµÙˆÙ‘Ø±: Ø´ÙŠØ¡ ØªØ­Ø¨ Ø´ÙƒÙ„Ù‡.",
"Ù‚ÙˆÙ„ Ø¨ØµÙˆØªÙƒ: (Ø£Ù†Ø§ Ù…Ø¹Ùƒ Ù„Ø£Ù†â€¦).",
"ØµÙˆÙ‘Ø±: Ø´ÙŠØ¡ ÙŠØ¹Ø¨Ù‘Ø± Ø¹Ù†Ùƒ Ø§Ù„ÙŠÙˆÙ….",
"Ù‚ÙˆÙ„: Ø´ÙŠ ÙŠØ·Ù…Ù†Ùƒ ÙÙŠÙ‘."
];

const lana2_questions = [
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ÙŠØ·Ù…Ù†Ùƒ ÙÙŠ ÙˆØ¬ÙˆØ¯ÙŠØŸ",
"Ù…ØªÙ‰ ØªØ­Ø³ Ø¥Ù†Ùƒ Ø¹Ù„Ù‰ Ø·Ø¨ÙŠØ¹ØªÙƒ Ù…Ø¹ÙŠØŸ",
"ÙˆØ´ Ø§Ù„Ø´ÙŠ Ø§Ù„Ù„ÙŠ ØªØ­Ø¨ Ù†Ø«Ø¨Ù‘ØªÙ‡ Ø¨ÙŠÙ†Ø§ ÙˆÙ…Ø§ ÙŠØªØºÙŠÙ‘Ø±ØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ØªØ­ØªØ§Ø¬Ù‡ Ù…Ù†ÙŠ Ù‡Ø§Ù„ÙØªØ±Ø©ØŸ",
"ÙƒÙŠÙ ØªØ­Ø¨ Ø£ÙƒÙˆÙ† Ø¬Ù†Ø¨Ùƒ ÙˆÙ‚Øª Ø§Ù„Ø¶ØºØ·ØŸ",
"ÙˆØ´ ÙŠØ®Ù„ÙŠÙƒ ØªØ­Ø³ Ø¥Ù†Ùƒ Ù…Ùˆ Ù„Ø­Ø§Ù„ÙƒØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± ØªØµØ±Ù‘Ù Ù…Ù†ÙŠ ÙŠØ¹Ø·ÙŠÙƒ Ø£Ù…Ø§Ù†ØŸ",
"Ù…ØªÙ‰ ØªØ­Ø³ Ø¥Ù†Ù†Ø§ ÙØ±ÙŠÙ‚ ÙˆØ§Ø­Ø¯ØŸ",
"ÙˆØ´ Ø§Ù„Ø´ÙŠ Ø§Ù„Ù„ÙŠ ØªØ­Ø¨ Ø£Ø³ØªÙ…Ø± Ø£Ø³ÙˆÙŠÙ‡ Ù…Ù‡Ù…Ø§ ØµØ§Ø±ØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ÙŠØ®Ù„ÙŠÙƒ ØªØ«Ù‚ØŸ",
"ÙƒÙŠÙ ØªØ­Ø¨ Ù†Ø­Ù„ Ø®Ù„Ø§ÙØ§ØªÙ†Ø§ØŸ",
"ÙˆØ´ Ø§Ù„Ø´ÙŠ Ø§Ù„Ù„ÙŠ ÙŠÙˆØ¬Ø¹Ùƒ Ù„Ùˆ Ø­Ø³Ù‘ÙŠØª Ø¥Ù†ÙŠ ØªØ¬Ø§Ù‡Ù„ØªÙ‡ØŸ",
"ÙˆØ´ Ø£Ø³ÙˆØ£ Ø´Ø¹ÙˆØ± ØªØ­Ø¨ Ù†ØªØ¬Ù†Ø¨Ù‡ Ø¨ÙŠÙ†Ø§ØŸ",
"ÙˆØ´ Ø§Ù„ØªØµØ±Ù‘Ù Ø§Ù„Ù„ÙŠ ÙŠØ®Ù„ÙŠÙƒ ØªØ­Ø³ Ø¥Ù†ÙŠ Ù…ÙˆØ¬ÙˆØ¯ ÙØ¹Ù„Ù‹Ø§ØŸ",
"ÙˆØ´ Ø§Ù„Ø´ÙŠ Ø§Ù„Ù„ÙŠ ØªØ­Ø¨Ù†ÙŠ Ø£Ù†ØªØ¨Ù‡ Ù„Ù‡ Ø£ÙƒØ«Ø±ØŸ",
"ÙˆØ´ ÙŠØ®Ù„ÙŠÙƒ ØªØ­Ø³ Ø¨Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø±ØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ØªØ®Ø§Ù ÙŠØ£Ø«Ø± Ø¹Ù„ÙŠÙ†Ø§ Ù„Ùˆ Ù…Ø§ Ø§Ù†ØªØ¨Ù‡Ù†Ø§ Ù„Ù‡ØŸ",
"ÙƒÙŠÙ ØªØ­Ø¨ Ø£Ø±Ø¬Ù‘Ø¹Ùƒ Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø£Ù…Ø§Ù† Ù„Ùˆ ØªÙˆØªØ±ØªØŸ",
"ÙˆØ´ Ø£Ø³Ù„ÙˆØ¨Ùƒ ÙˆÙ‚Øª Ø§Ù„Ø²Ø¹Ù„ ÙˆØªØ­Ø¨Ù†ÙŠ Ø£ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡ ÙƒÙŠÙØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ÙŠØ±ÙŠØ­Ùƒ Ø¨Ø§Ù„ÙƒÙ„Ø§Ù…ØŸ",
"ÙˆØ´ Ø§Ù„Ø´ÙŠ Ø§Ù„Ù„ÙŠ ØªØ­Ø¨ ÙŠÙƒÙˆÙ† ÙˆØ§Ø¶Ø­ Ø¨ÙŠÙ†Ø§ Ø¯Ø§ÙŠÙ…Ù‹Ø§ØŸ",
"ÙˆØ´ ØªØ­Ø³ Ø¥Ù†Ù†Ø§ Ø³ÙˆÙŠÙ†Ø§Ù‡ ØµØ­ØŸ",
"ÙˆØ´ ÙˆØ¯Ùƒ Ù†Ø·ÙˆÙ‘Ø±Ù‡ Ø¨Ø¯ÙˆÙ† Ø¶ØºØ·ØŸ",
"ÙˆØ´ ÙŠØ®Ù„ÙŠÙƒ ØªØ­Ø³ Ø¥Ù†Ùƒ Ù…Ø³Ù…ÙˆØ¹ØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ØªØ­Ø¨ Ù†Ø´Ø§Ø±ÙƒÙ‡ Ù…Ø¹ Ø¨Ø¹Ø¶ØŸ",
"ÙˆØ´ Ø§Ù„Ø´ÙŠ Ø§Ù„Ù„ÙŠ ÙŠØ®Ù„ÙŠÙƒ ØªØ­Ø³ Ø¥Ù†ÙŠ Ù…Ø¹Ùƒ Ø­ØªÙ‰ ÙˆØ£Ù†Ø§ Ø¨Ø¹ÙŠØ¯ØŸ",
"ÙˆØ´ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„ØµØºÙŠØ±Ø© Ø§Ù„Ù„ÙŠ ØªÙØ±Ù‚ Ù…Ø¹Ùƒ ÙƒØ«ÙŠØ±ØŸ",
"ÙˆØ´ ÙŠØ®Ù„ÙŠÙƒ ØªØ·Ù…Ø¦Ù† Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø¨ÙŠÙ†Ø§ØŸ",
"ÙˆØ´ Ø§Ù„Ø´ÙŠ Ø§Ù„Ù„ÙŠ ÙˆØ¯Ùƒ Ù†ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡ Ø¨ÙˆØ¶ÙˆØ­ØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ØªØ­Ø¨ ÙÙŠ Ø·Ø±ÙŠÙ‚Ø© ØªÙˆØ§ØµÙ„Ù†Ø§ØŸ",
"ÙˆØ´ ÙŠØ®Ù„ÙŠÙƒ ØªØ­Ø³ Ø¨Ø§Ù„Ø±Ø§Ø­Ø© ÙˆÙ‚Øª Ø§Ù„ØµÙ…ØªØŸ",
"ÙˆØ´ Ø§Ù„Ø´ÙŠ Ø§Ù„Ù„ÙŠ ÙˆØ¯Ùƒ Ø£Ø­Ù…ÙŠÙ‡ Ù„ÙƒØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ÙŠØ«Ø¨ØªÙƒ ÙˆÙ‚Øª Ø§Ù„Ù‚Ù„Ù‚ØŸ",
"ÙˆØ´ ØªØ­Ø¨ ÙŠÙƒÙˆÙ† Ø±Ø¯Ù‘ÙŠ Ù„Ùˆ ÙƒÙ†Øª Ù…Ø­ØªØ§Ø¬ØŸ",
"ÙˆØ´ Ø§Ù„Ø´ÙŠ Ø§Ù„Ù„ÙŠ ÙŠØ®Ù„ÙŠÙƒ ØªØ­Ø³ Ø¥Ù†Ùƒ Ù…Ù‡Ù…ØŸ",
"ÙˆØ´ Ø§Ù„Ø´ÙŠ Ø§Ù„Ù„ÙŠ ØªØ­Ø¨ Ù†Ø±Ø§Ø¬Ø¹Ù‡ Ø¨ÙŠÙ† ÙØªØ±Ø© ÙˆÙØªØ±Ø©ØŸ",
"ÙˆØ´ ÙŠØ®Ù„ÙŠÙƒ ØªØ­Ø³ Ø¥Ù†Ù†Ø§ Ø«Ø§Ø¨ØªÙŠÙ†ØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ÙˆØ¯Ùƒ Ø£ÙƒÙˆÙ†Ù‡ Ù„ÙƒØŸ",
"ÙˆØ´ Ø§Ù„Ø´ÙŠ Ø§Ù„Ù„ÙŠ ØªØ­Ø¨ Ù†ÙƒÙ…Ù‘Ù„Ù‡ Ø³ÙˆØ§ØŸ",
"ÙˆØ´ Ø´Ø¹ÙˆØ±Ùƒ Ù„Ù…Ø§ ØªØ­Ø³ Ø¥Ù†Ù†Ø§ Ù…ØªÙØ§Ù‡Ù…ÙŠÙ†ØŸ",
"ÙˆØ´ ÙŠØ®Ù„ÙŠÙƒ ØªØ­Ø³ Ø¨Ø§Ù„Ø·Ù…Ø£Ù†ÙŠÙ†Ø© Ø§Ù„Ø¢Ù†ØŸ",
"ÙˆØ´ Ø§Ù„Ø´ÙŠ Ø§Ù„Ù„ÙŠ ØªØ­Ø¨ Ø£Ø°ÙƒÙ‘Ø±Ùƒ ÙÙŠÙ‡ Ø¯Ø§ÙŠÙ…Ù‹Ø§ØŸ",
"ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠ ÙŠØ®ÙÙ Ø¹Ù†ÙƒØŸ",
"ÙˆØ´ ØªØ­Ø¨ Ù†ÙƒÙˆÙ† Ø¹Ù„ÙŠÙ‡ Ø¨Ø¹Ø¯ ÙØªØ±Ø©ØŸ",
"ÙˆØ´ Ø¥Ø­Ø³Ø§Ø³Ùƒ ØªØ¬Ø§Ù‡Ù†Ø§ Ø§Ù„ÙŠÙˆÙ…ØŸ"
];

const lana2_challenges = [
"Ø§Ø±Ø³Ù„ ÙÙˆÙŠØ³ Ù‚ØµÙŠØ± ØªØ·Ù…Ù‘Ù† ÙÙŠÙ‡ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ.",
"ØµÙˆÙ‘Ø± Ø´ÙŠØ¡ Ù‚Ø¯Ø§Ù…Ùƒ ØªØ­Ø³Ù‘Ù‡ ÙŠØ¹Ø¨Ù‘Ø± Ø¹Ù† Ø§Ù„Ø£Ù…Ø§Ù†.",
"Ø§Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© ØªÙ‚ÙˆÙ„ ÙÙŠÙ‡Ø§ Ø´ÙŠ ÙˆØ§Ø­Ø¯ ÙŠØ±ÙŠØ­Ùƒ.",
"ØµÙˆÙ‘Ø± Ù…ÙƒØ§Ù†Ùƒ Ø§Ù„Ø¢Ù† Ù„Ùˆ ÙƒØ§Ù† Ù‡Ø§Ø¯Ø¦.",
"Ø§Ø±Ø³Ù„ ÙƒÙ„Ù…Ø© ØªØ·Ù…Ù‘Ù† Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ.",
"ÙÙˆÙŠØ³: Ø§Ø­ÙƒÙŠ Ø¹Ù† Ø´ÙŠØ¡ Ø±ÙŠÙ‘Ø­Ùƒ Ø§Ù„ÙŠÙˆÙ….",
"ØµÙˆÙ‘Ø± Ø´ÙŠØ¡ ØªØ­Ø¨ ÙˆØ¬ÙˆØ¯Ù‡ Ø­ÙˆÙ„Ùƒ.",
"Ø§Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ø´ÙƒØ± Ù‚ØµÙŠØ±Ø©.",
"ØµÙˆÙ‘Ø± Ù„ÙˆÙ† ØªØ­Ø³Ù‘Ù‡ ÙŠÙ…Ø«Ù‘Ù„ Ù…Ø²Ø§Ø¬Ùƒ.",
"ÙÙˆÙŠØ³: Ø§Ø­ÙƒÙŠ Ø¹Ù† Ø´Ø¹ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†.",
"Ø§Ø±Ø³Ù„ Ø¬Ù…Ù„Ø© ØªØ­Ø¨ ØªØ³Ù…Ø¹Ù‡Ø§ Ù…Ù† Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ.",
"ØµÙˆÙ‘Ø± Ø´ÙŠØ¡ Ø«Ø§Ø¨Øª ÙÙŠ ÙŠÙˆÙ…Ùƒ.",
"ÙÙˆÙŠØ³: Ù‚ÙˆÙ„ Ø´ÙŠ ÙŠØ®Ù„ÙŠÙƒ ØªØ­Ø³ Ø¨Ø§Ù„Ø£Ù…Ø§Ù†.",
"ØµÙˆÙ‘Ø± Ù„Ù‚Ø·Ø© Ø¯Ø§ÙØ¦Ø© (Ø¶ÙˆØ¡ØŒ Ù‚Ù‡ÙˆØ©ØŒ Ù…ÙƒØ§Ù†).",
"Ø§Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ø¯Ø¹Ù… Ø¨Ø³ÙŠØ·Ø©.",
"ÙÙˆÙŠØ³: Ø§Ø­ÙƒÙŠ Ù…ØªÙ‰ ØªØ­Ø³ Ø¥Ù†ÙƒÙ… ÙØ±ÙŠÙ‚.",
"ØµÙˆÙ‘Ø± Ø´ÙŠØ¡ ÙŠØ¹Ø¨Ù‘Ø± Ø¹Ù† Ø§Ù„Ù‡Ø¯ÙˆØ¡.",
"Ø§Ø±Ø³Ù„ Ø¬Ù…Ù„Ø© ØªØ·Ù…Ù‘Ù† Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ.",
"ØµÙˆÙ‘Ø± Ø´ÙŠØ¡ ØªØ­Ø¨ Ø´ÙƒÙ„Ù‡.",
"ÙÙˆÙŠØ³: Ø§Ø­ÙƒÙŠ Ø´ÙŠ ÙŠØ®ÙÙ ØªÙˆØªØ±Ùƒ.",
"Ø§Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© ØªÙ‚ÙˆÙ„ ÙÙŠÙ‡Ø§ Ø¥Ù†Ùƒ Ù…ÙˆØ¬ÙˆØ¯.",
"ØµÙˆÙ‘Ø± Ø´ÙŠØ¡ ÙŠØ¹Ø¨Ù‘Ø± Ø¹Ù† Ø§Ù„Ù‚Ø±Ø¨.",
"ÙÙˆÙŠØ³: Ø§Ø­ÙƒÙŠ Ø¹Ù† Ø´ÙŠ ØªØ­Ø¨ Ù†Ø­Ø§ÙØ¸ Ø¹Ù„ÙŠÙ‡.",
"ØµÙˆÙ‘Ø± Ø´ÙŠØ¡ Ø¨Ø³ÙŠØ· ÙŠÙØ±Ø­Ùƒ.",
"Ø§Ø±Ø³Ù„ ÙƒÙ„Ù…Ø© ØªÙ‚Ø¯ÙŠØ±.",
"ÙÙˆÙŠØ³: Ù‚ÙˆÙ„ ÙˆØ¹Ø¯ ØµØºÙŠØ±.",
"ØµÙˆÙ‘Ø± Ø´ÙŠØ¡ ØªØ­Ø¨ ÙˆØ¬ÙˆØ¯Ù‡ Ø¨Ø­ÙŠØ§ØªÙƒ.",
"Ø§Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ù‚ØµÙŠØ±Ø© Ø¨Ø¯ÙˆÙ† Ø³Ø¨Ø¨.",
"ØµÙˆÙ‘Ø± Ø´ÙŠØ¡ ØªØ­Ø³Ù‘Ù‡ Ø¢Ù…Ù†.",
"ÙÙˆÙŠØ³: Ø§Ø­ÙƒÙŠ Ø¹Ù† Ø´ÙŠ ØªØ­Ø¨ Ù†ÙƒÙ…Ù‘Ù„Ù‡ Ø³ÙˆØ§.",
"Ø§Ø±Ø³Ù„ Ø¬Ù…Ù„Ø© ØªØ±ÙŠØ­ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ.",
"ØµÙˆÙ‘Ø± Ø´ÙŠØ¡ ÙŠØ¹ÙƒØ³ Ø´Ø¹ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†.",
"ÙÙˆÙŠØ³: Ø§Ø­ÙƒÙŠ Ø¹Ù† Ø´ÙŠ Ø®Ù„Ø§Ùƒ ØªØ·Ù…Ø¦Ù†.",
"ØµÙˆÙ‘Ø± Ø´ÙŠØ¡ ØªØ­Ø¨Ù‡ Ø§Ù„ÙŠÙˆÙ….",
"Ø§Ø±Ø³Ù„ ÙƒÙ„Ù…Ø© ØªØ­Ø³Ù‡Ø§ Ø¨ÙŠÙ†ÙƒÙ….",
"ÙÙˆÙŠØ³: Ø§Ø­ÙƒÙŠ Ø¹Ù† Ø´ÙŠ ÙŠØ®Ù„ÙŠÙƒ ØªØ«Ù‚.",
"ØµÙˆÙ‘Ø± Ø´ÙŠØ¡ ÙŠØ¹Ø¨Ù‘Ø± Ø¹Ù† Ø§Ù„Ø«Ø¨Ø§Øª.",
"Ø§Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© ØªÙ‚ÙˆÙ„ ÙÙŠÙ‡Ø§ (Ø£Ù†Ø§ Ù…Ø¹Ùƒ).",
"ØµÙˆÙ‘Ø± Ø´ÙŠØ¡ Ø¨Ø³ÙŠØ· ØªØ­Ø¨Ù‡.",
"ÙÙˆÙŠØ³: Ø§Ø­ÙƒÙŠ Ø¥Ø­Ø³Ø§Ø³Ùƒ ØªØ¬Ø§Ù‡ÙƒÙ…."
];

const lana3_questions = [
"Ø£Ø­Ø³ Ø¥Ù† Ø£ÙƒØ«Ø± ÙˆÙ‚Øª Ù†ÙƒÙˆÙ† ÙÙŠÙ‡ Ø¹Ù„Ù‰ Ø·Ø¨ÙŠØ¹ØªÙ†Ø§ Ù‡Ùˆ Ù„Ù…Ø§ Ù…Ø§ Ù†Ø®Ø·Ø·.",
"ÙÙŠÙ‡ Ø£Ø´ÙŠØ§Ø¡ Ø¨Ø³ÙŠØ·Ø© Ø¨ÙŠÙ†Ø§ ØµØ§Ø±Øª Ø·Ø¨ÙŠØ¹ÙŠØ© Ù…Ø±Ø©.",
"Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ Ø§Ù„ØµÙ…Øª Ø¨ÙŠÙ†Ù†Ø§ Ù…Ø±ÙŠØ­ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„ÙƒÙ„Ø§Ù….",
"ÙÙŠÙ‡ ØªØµØ±ÙØ§Øª Ù†Ø³ÙˆÙŠÙ‡Ø§ ÙˆÙ…Ø§ Ù†Ù†ØªØ¨Ù‡ Ù„Ù‡Ø§ Ù„ÙƒÙ†Ù‡Ø§ ØªØ¶Ø­Ùƒ.",
"Ø£Ø±ØªØ§Ø­ Ù„Ù…Ø§ ÙŠÙƒÙˆÙ† Ø§Ù„Ø¬Ùˆ Ø®ÙÙŠÙ Ø¨Ø¯ÙˆÙ† ØªÙˆÙ‚Ø¹Ø§Øª.",
"Ø£Ø­Ø¨ ÙÙƒØ±Ø© Ø¥Ù†Ù†Ø§ Ù†Ù‚Ø¯Ø± Ù†ÙƒÙˆÙ† Ø¹ÙÙˆÙŠÙŠÙ†.",
"ÙÙŠÙ‡ Ø£Ø´ÙŠØ§Ø¡ Ø¨ÙŠÙ†Ø§ Ù…Ø§ ØªØ­ØªØ§Ø¬ ØªÙØ³ÙŠØ±.",
"Ø§Ù„Ø±Ø§Ø­Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù„Ù…Ø§ Ù…Ø§ Ø£ÙÙƒØ± ÙˆØ´ Ø£Ù‚ÙˆÙ„.",
"Ø£Ø¶Ø­Ùƒ Ù„Ù…Ø§ Ø£ÙØªÙƒØ± Ù…ÙˆØ§Ù‚Ù Ø¨Ø³ÙŠØ·Ø© ØµØ§Ø±Øª Ø¨ÙŠÙ†Ø§.",
"ÙÙŠÙ‡ Ø£ÙˆÙ‚Ø§Øª Ø£Ø­Ø³ Ø¥Ù†Ù†Ø§ Ù†ÙÙ‡Ù… Ø¨Ø¹Ø¶ Ø¨Ø¯ÙˆÙ† ÙƒÙ„Ø§Ù….",
"Ø§Ù„Ø¹ÙÙˆÙŠØ© Ø¨ÙŠÙ† Ø´Ø®ØµÙŠÙ† Ù†Ø¹Ù…Ø©.",
"ÙÙŠÙ‡ Ø¹Ø§Ø¯Ø§Øª ØµØºÙŠØ±Ø© ØªØµÙ†Ø¹ Ø§Ù„Ø±Ø§Ø­Ø©.",
"Ø£Ø­Ø¨ Ù„Ù…Ø§ ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ø²Ø§Ø¬ Ø¨Ø³ÙŠØ·.",
"Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ Ø§Ù„Ø³Ø®Ø§ÙØ© ØªÙ‚Ø±Ù‘Ø¨ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ø¬Ø¯ÙŠØ©.",
"Ø§Ù„Ø±Ø§Ø­Ø© ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµØºÙŠØ±Ø©.",
"Ø£Ø­Ø³ Ø¥Ù† Ø§Ù„Ø¶Ø­Ùƒ Ø¨Ø¯ÙˆÙ† Ø³Ø¨Ø¨ Ø¹Ù„Ø§Ù…Ø© Ø£Ù…Ø§Ù†.",
"ÙÙŠÙ‡ Ø£Ø´ÙŠØ§Ø¡ Ù†Ø³ÙˆÙŠÙ‡Ø§ ÙˆØªÙƒÙˆÙ† Ø¹Ø§Ø¯ÙŠØ© Ù„Ù†Ø§ ÙˆØºØ±ÙŠØ¨Ø© Ù„ØºÙŠØ±Ù†Ø§.",
"Ø§Ù„Ø·Ø¨ÙŠØ¹Ø© ØªØ·Ù„Ø¹ Ù„Ù…Ø§ Ù†ÙƒÙˆÙ† Ù…Ø±ØªØ§Ø­ÙŠÙ†.",
"Ø£Ø­Ø¨ Ø§Ù„Ù„Ø­Ø¸Ø§Øª Ø§Ù„Ù„ÙŠ Ù…Ø§ ØªÙƒÙˆÙ† Ù…Ø«Ø§Ù„ÙŠØ©.",
"Ø§Ù„Ø¨Ø³Ø§Ø·Ø© ØªØ®Ù„ÙŠ Ø§Ù„Ø¬Ùˆ Ø¯Ø§ÙÙŠ.",
"Ø£Ø±ØªØ§Ø­ Ù„Ù…Ø§ Ù†ÙƒÙˆÙ† Ø¹Ù„Ù‰ Ø³Ø¬ÙŠØªÙ†Ø§.",
"ÙÙŠÙ‡ Ø£Ø´ÙŠØ§Ø¡ Ø¨ÙŠÙ†Ø§ Ù…Ø§ ØªØ­ØªØ§Ø¬ ØªØ±ØªÙŠØ¨.",
"Ø£Ø­Ø¨ Ø§Ù„Ù…Ø²Ø§Ø¬ Ø§Ù„Ù„ÙŠ ÙŠØ¬ÙŠ Ø¨Ø¯ÙˆÙ† Ù…Ù‚Ø¯Ù…Ø§Øª.",
"Ø§Ù„Ø¶Ø­Ùƒ ÙŠØ®ÙÙ Ø£ÙŠ ØªÙˆØªØ±.",
"Ø§Ù„Ø¹ÙÙˆÙŠØ© ØªØ­Ø±Ø±.",
"ÙÙŠÙ‡ Ù„Ø­Ø¸Ø§Øª ØªÙƒÙˆÙ† Ø®ÙÙŠÙØ© Ø¨Ø³ Ø¹Ù…ÙŠÙ‚Ø©.",
"Ø£Ø­Ø¨ Ù„Ù…Ø§ Ù†ÙƒÙˆÙ† ØµØ§Ø¯Ù‚ÙŠÙ† Ø¨Ø¯ÙˆÙ† ØªÙÙƒÙŠØ±.",
"Ø£Ø­Ø³ Ø¥Ù† Ø§Ù„Ø±Ø§Ø­Ø© ØªØ²ÙŠØ¯ Ù„Ù…Ø§ Ù†Ø¶Ø­Ùƒ Ø¹Ù„Ù‰ Ù†ÙØ³Ù†Ø§.",
"ÙÙŠÙ‡ Ù…ÙˆØ§Ù‚Ù Ø¨Ø³ÙŠØ·Ø© ØªØ¨Ù‚Ù‰ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©.",
"Ø£Ø­Ø¨ Ù„Ù…Ø§ Ù…Ø§ Ù†Ø­ØªØ§Ø¬ Ù†Ø«Ø¨Øª Ø´ÙŠ.",
"Ø§Ù„Ø±Ø§Ø­Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© ØªÙƒÙˆÙ† Ø¨Ø¯ÙˆÙ† Ù…Ø¬Ù‡ÙˆØ¯.",
"Ø£Ø­Ø¨ Ù„Ù…Ø§ ÙŠÙƒÙˆÙ† Ø§Ù„Ø¬Ùˆ Ø·Ø¨ÙŠØ¹ÙŠ.",
"ÙÙŠÙ‡ Ø£Ø´ÙŠØ§Ø¡ Ø¨ÙŠÙ†Ø§ ØµØ§Ø±Øª Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„ÙŠÙˆÙ….",
"Ø§Ù„Ø¶Ø­Ùƒ Ø§Ù„Ù…Ø´ØªØ±Ùƒ ÙŠÙ‚Ø±Ø¨.",
"Ø§Ù„Ø¹ÙÙˆÙŠØ© ØªØ®Ù„ÙŠ Ø§Ù„ÙˆÙ‚Øª ÙŠÙ…Ø´ÙŠ Ø£Ø³Ø±Ø¹.",
"Ø£Ø±ØªØ§Ø­ Ù„Ù…Ø§ Ù…Ø§ Ù†ÙƒÙˆÙ† Ø±Ø³Ù…ÙŠÙŠÙ†.",
"ÙÙŠÙ‡ Ø£ÙˆÙ‚Ø§Øª Ø£Ø­Ø³ Ø¥Ù†Ù†Ø§ Ù…ØªÙØ§Ù‡Ù…ÙŠÙ† Ø¨Ø¯ÙˆÙ† Ø´Ø±Ø­.",
"Ø§Ù„Ø¨Ø³Ø§Ø·Ø© ØªØ²ÙŠØ¯ Ø§Ù„Ù‚Ø±Ø¨.",
"Ø£Ø­Ø¨ Ø§Ù„Ø¬Ùˆ Ø§Ù„Ù„ÙŠ Ù…Ø§ ÙÙŠÙ‡ Ø£Ø­ÙƒØ§Ù….",
"Ø§Ù„Ø±Ø§Ø­Ø© Ø¥Ø­Ø³Ø§Ø³ØŒ Ù…Ùˆ ØªØµØ±Ù."
];

const lana3_challenges = [
"Ø§Ù†Ø¨Ø­ Ø®Ù…Ø³ Ù…Ø±Ø§Øª ÙˆØ§Ù„Ù‡Ø«.",
"Ù‚Ù„Ù‘Ø¯ ØµÙˆØª Ø¨Ù‚Ø±Ø©.",
"Ù‚Ù„Ù‘Ø¯ ØµÙˆØª Ø«Ø¹Ø¨Ø§Ù†.",
"Ù‚Ù„Ù‘Ø¯ ØµÙˆØª Ø¹Ø¬ÙˆØ².",
"Ù‚Ù„Ù‘Ø¯ ØµÙˆØª Ù…Ø¹Ø²Ø©.",
"Ù‚Ù„Ù‘Ø¯ ØµÙˆØª Ø·ÙÙ„ (Ù†ÙˆÙ†Ùˆ).",
"Ù‚Ù„Ù‘Ø¯ ØµÙˆØª Ø³Ø¨ÙˆÙ†Ø¬ Ø¨ÙˆØ¨.",
"Ù‚Ù„Ù‘Ø¯ ØµÙˆØª Ø£Ø³Ø¯.",
"Ù‚Ù„Ù‘Ø¯ ØµÙˆØª Ø«ÙˆØ±.",
"Ù‚Ù„Ù‘Ø¯ ØµÙˆØª Ø®Ù†Ø²ÙŠØ±.",
"Ø³ÙˆÙ‘ Ø£ÙƒØ«Ø± Ø­Ø±ÙƒØ© Ù…Ù‚Ø²Ø²Ø© (ØªÙ…Ø«ÙŠÙ„ ÙÙ‚Ø·) ØªÙƒØ³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ©.",
"Ø§Ø±Ù‚Øµ Ø±Ù‚ØµØ© ØºØ¨ÙŠØ© Ù„Ù…Ø¯Ø© 10 Ø«ÙˆØ§Ù†ÙŠ.",
"ØµÙˆÙ‘Ø± Ù„Ø³Ø§Ù†Ùƒ.",
"ØµÙˆÙ‘Ø± ÙˆØ¬Ù‡Ùƒ Ø¨Ø£ØºØ±Ø¨ ØªØ¹Ø¨ÙŠØ±.",
"ØµÙˆÙ‘Ø± Ù„Ù‚Ø·Ø© ÙˆØ§Ù†Øª ØªØ³ÙˆÙŠ Ø­Ø±ÙƒØ© ØºØ¨ÙŠØ©.",
"Ù…Ø«Ù‘Ù„ Ø­Ø±ÙƒØ© Ù…Ù‚Ø²Ø²Ø© Ø¨Ø¯ÙˆÙ† Ù„Ù…Ø³.",
"Ù‚Ù„ Ø¬Ù…Ù„Ø© ÙˆØ§Ù†Øª ØªØºÙŠÙ‘Ø± ØµÙˆØªÙƒ 3 Ù…Ø±Ø§Øª.",
"Ù…Ø«Ù‘Ù„ Ø£Ù†Ùƒ Ù…Ø³ØªØ¹Ø¬Ù„ Ø¬Ø¯Ù‹Ø§ Ø¨Ø¯ÙˆÙ† ÙƒÙ„Ø§Ù…."
];

const lana4_questions = ["ØªØ­Ø¨Ù†ÙŠ."];
const lana4_challenges = ["ØªØ­Ø¨Ù†ÙŠ."];

const PACKS = {
lana1: { questions: lana1_questions, challenges: lana1_challenges },
lana2: { questions: lana2_questions, challenges: lana2_challenges },
lana3: { questions: lana3_questions, challenges: lana3_challenges },
lana4: { questions: lana4_questions, challenges: lana4_challenges }
};

function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

/********************
* Auth mapping (username -> email)
********************/
const USER_MAP = {
anas: "anas@love.local",
lana: "lana@love.local"
};

const loginUser = document.getElementById("loginUser");
const loginPass = document.getElementById("loginPass");
const loginBtn = document.getElementById("loginBtn");
const loginMsg = document.getElementById("loginMsg");

const whoPill = document.getElementById("whoPill");
const modeSelect = document.getElementById("modeSelect");
const promptCard = document.getElementById("promptCard");
const syncLine = document.getElementById("syncLine");

const ROOM_ID = "our-world";
const roomRef = ()=> window.fb.doc(window.fb.db, "rooms", ROOM_ID);

let currentName = null;
let CURRENT_MODE = "lana1";

function setMsg(text, type=""){
loginMsg.className = "msg " + (type||"");
loginMsg.textContent = text || "";
}

function normalizeToEmail(v){
const raw = (v||"").trim().toLowerCase();
if(!raw) return "";
if(raw.includes("@")) return raw;
if(USER_MAP[raw]) return USER_MAP[raw];
return raw;
}

/********************
* Ensure Room
********************/
async function ensureRoom() {
try {
await window.fb.setDoc(
roomRef(),
{
roomId: ROOM_ID,
currentPage: "pageHome",
currentMode: CURRENT_MODE,
promptText: "Ø§Ø¨Ø¯Ø£ âœ¨ Ø§Ø®ØªØ± (Ø³Ø¤Ø§Ù„ / ØªØ­Ø¯ÙŠ)",
promptType: "init",
lastBy: "system",
updatedAt: window.fb.serverTimestamp(),

opt2: {
q: "",
anas: "",
lana: "",
readyAnas: false,
readyLana: false,
updatedBy: "system",
},

opt3: {
stage: 1,
selected: -1,
solved: false,
lastText: "Ø§Ø®ØªØ§Ø±ÙˆØ§ Ø¬ÙˆØ§Ø¨ Ù…Ù† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ğŸ‘† (Live)",
loveText: "",
showLove: false,
punishText: "",
confirmAnas: false,
confirmLana: false,

evaluatedStage: 0,
autoNext: false,
autoNextDone: false,
updatedBy: "system",
},

opt4puz: {
section: "challenge",
stage: 1,
grid: 3,
img: "",
shuffle: [],
placed: {},
sel: -1,
solved: false,
roles: { viewer: "ANAS", assembler: "LANA" },

nextReadyAnas: false,
nextReadyLana: false,
gateStage: 1,
gateDone: false,
cheer: "",

updatedBy: "system",
},

opt5kitchen: {
  // âœ… Desserts only
  section: "sweet",

  // recipe
  recipeId: "",
  recipeName: "",
  recipeType: "", // "cake" | "donut"

  pickAnas: "",
  pickLana: "",
  confirmRecipeAnas: false,
  confirmRecipeLana: false,
  recipeLocked: false,

  // âœ… phases: 0=pick, 1=build (cake only), 2=decorate, 3=serve
  phase: 0,

  // gate ready for next (both)
  readyNextAnas: false,
  readyNextLana: false,

  // âœ… cake build state (Live)
  build: {
    plate: "pink",     // pink | red | black | white | purple
    layers: [],        // each: { color:"red|black|pink|white|brown", height: 18 }
    filling: ""        // "vanilla|choco|strawberry|none"
  },

  // decoration (same idea as before)
  decoItems: [],
  madeByUs: false,

  album: [],
  updatedBy: "system",
},
	opt6invest: {
  stage: 1,                 // 1..100
  maxDone: 0,               // Ø£ÙƒØ¨Ø± Ù‚Ø¶ÙŠØ© Ø§Ù†Ø­ÙƒÙ…Øª (Ù‚ÙÙ„ Ø§Ù„Ø±Ø¬ÙˆØ¹)
  decided: false,           // Ù‡Ù„ ØªÙ… Ø§Ù„Ø­ÙƒÙ… ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø¶ÙŠØ©ØŸ
  decidedBy: "",            // Ù…Ù† Ø­ÙƒÙ…
  verdict: "",              // "guilty" | "innocent"
  win: null,                // true/false Ù„Ù„Ù…Ø­Ù‚Ù‚
  reveal: "",               // Ù†Øµ ÙƒØ´Ù Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©
  judgeLine: "ğŸŸâš–ï¸ Ø¬Ø§Ù‡Ø²ÙŠÙ†â€¦ Ø§ÙØªØ­ÙˆØ§ Ù…Ù„ÙØ§ØªÙƒÙ… ÙˆØ§Ø¨Ø¯Ø£ÙˆØ§ Ø§Ù„ØªØ­Ù‚ÙŠÙ‚.",
  updatedBy: "system",
},
},
{ merge: true }
);
} catch (e) {}
}



async function doLogin(){
const email = normalizeToEmail(loginUser.value);
const pass = (loginPass.value||"").trim();
if(!email || !pass){
setMsg("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", "bad");
return;
}
setMsg("â€¦ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„");
try{
const cred = await window.fb.signInWithEmailAndPassword(window.fb.auth, email, pass);
const em = (cred.user.email||"").toLowerCase();
currentName = em.startsWith("lana") ? "LANA" : "ANAS";
setMsg("ØªÙ… âœ…", "ok");
}catch(err){
setMsg("Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­", "bad");
}
}

loginBtn.addEventListener("click", doLogin);
loginPass.addEventListener("keydown", (e)=>{ if(e.key==="Enter") doLogin(); });
loginUser.addEventListener("keydown", (e)=>{ if(e.key==="Enter") doLogin(); });

/********************
* Live sync helpers
********************/
let unsubRoom = null;

async function pushRoomUpdate(payload){
try{
await window.fb.updateDoc(roomRef(),{
...payload,
lastBy: currentName || "unknown",
updatedAt: window.fb.serverTimestamp()
});
}catch(e){}
}

function pushPage(pageId){
pushRoomUpdate({ currentPage: pageId });
}

async function pushPrompt(type){
const pack = PACKS[CURRENT_MODE] || PACKS.lana1;
const list = (type==="q") ? pack.questions : pack.challenges;
const icon = (type==="q") ? "ğŸ’—" : "ğŸ”¥";
const text = `${icon} ${pick(list)}`;
await pushRoomUpdate({
currentMode: CURRENT_MODE,
promptText: text,
promptType: type
});
}

/********************
* Option 2
********************/
const amkQuestion = document.getElementById("amkQuestion");
const amkMe = document.getElementById("amkMe");
const amkOther = document.getElementById("amkOther");
const amkSave = document.getElementById("amkSave");
const amkNew = document.getElementById("amkNew");
const amkStatus = document.getElementById("amkStatus");
const amkMeAs = document.getElementById("amkMeAs");
const amkOtherAs = document.getElementById("amkOtherAs");
const amkHintMe = document.getElementById("amkHintMe");
const amkHintOther = document.getElementById("amkHintOther");

const AMK_QUESTIONS = [
"Ù„Ùˆ ÙƒÙ†Øª Ù…ÙƒØ§Ù†ÙŠ Ø§Ù„Ø¢Ù†â€¦ ÙˆØ´ Ø£ÙƒØ«Ø± Ø´ÙŠØ¡ ØªØ­ØªØ§Ø¬Ù‡ Ù…Ù†ÙŠ Ø§Ù„ÙŠÙˆÙ…ØŸ",
"Ø£Ù†Ø§ Ù…ÙƒØ§Ù†Ùƒâ€¦ ÙˆØ´ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ù„ÙŠ ÙŠØ·Ù…Ù†Ùƒ ÙÙˆØ±Ù‹Ø§ØŸ",
"Ø£Ù†Ø§ Ù…ÙƒØ§Ù†Ùƒâ€¦ ÙˆØ´ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ù„ÙŠ ÙŠÙˆØ¬Ø¹Ùƒ ÙˆÙ…Ø§ ØªÙ‚ÙˆÙ„Ù‡ØŸ",
"Ø£Ù†Ø§ Ù…ÙƒØ§Ù†Ùƒâ€¦ ÙˆØ´ ØªØªÙˆÙ‚Ø¹ Ø¥Ù†ÙŠ Ø£ÙÙƒØ± ÙÙŠÙ‡ Ø§Ù„Ø­ÙŠÙ†ØŸ",
"Ø£Ù†Ø§ Ù…ÙƒØ§Ù†Ùƒâ€¦ ÙˆØ´ Ø£Ù…Ù†ÙŠØ© Ø¨Ø³ÙŠØ·Ø© ØªØ¨ØºØ§Ù†ÙŠ Ø£Ø­Ù‚Ù‚Ù‡Ø§ Ù„ÙƒØŸ"
];
function pickAmkQ(){
return AMK_QUESTIONS[Math.floor(Math.random()*AMK_QUESTIONS.length)];
}

function myKey(){ return (currentName === "ANAS") ? "anas" : "lana"; }
function otherKey(){ return (currentName === "ANAS") ? "lana" : "anas"; }
function myReadyKey(){ return (currentName === "ANAS") ? "readyAnas" : "readyLana"; }
function otherReadyKey(){ return (currentName === "ANAS") ? "readyLana" : "readyAnas"; }

function safeSetTextareaValue(el, nextValue){
if(!el) return;
if(document.activeElement === el) return;
const v = (typeof nextValue === "string") ? nextValue : "";
if(el.value !== v) el.value = v;
}

amkSave?.addEventListener("click", async ()=>{
const txt = (amkMe?.value || "").trim();
if(!txt){
if(amkStatus) amkStatus.textContent = "Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø£ÙˆÙ„Ø§Ù‹ âœï¸";
return;
}
if(amkStatus) amkStatus.textContent = "â€¦ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸";

if(currentName === "ANAS"){
await pushRoomUpdate({
"opt2.anas": txt,
"opt2.readyAnas": true,
"opt2.updatedBy": currentName || "unknown"
});
}else{
await pushRoomUpdate({
"opt2.lana": txt,
"opt2.readyLana": true,
"opt2.updatedBy": currentName || "unknown"
});
}

if(amkStatus) amkStatus.textContent = "ØªÙ… Ø­ÙØ¸ Ø¥Ø¬Ø§Ø¨ØªÙƒ âœ…";
});

amkNew?.addEventListener("click", async ()=>{
await pushRoomUpdate({
"opt2.q": pickAmkQ(),
"opt2.anas": "",
"opt2.lana": "",
"opt2.readyAnas": false,
"opt2.readyLana": false,
"opt2.updatedBy": currentName || "unknown"
});
if(amkStatus) amkStatus.textContent = "Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ ğŸŒ¹";
});

/********************
* OPTION 3: DATA
********************/
const FISH_PUNISH = [
"ØµÙˆÙ‘Ø± 3 Ø«ÙˆØ§Ù†ÙŠ ÙˆØ£Ù†Øª ØªØ³ÙˆÙŠ Ø£ØºØ±Ø¨ ØªØ¹Ø¨ÙŠØ± ÙˆØ¬Ù‡ ğŸ˜µâ€ğŸ’«",
"ÙÙˆÙŠØ³ 5 Ø«ÙˆØ§Ù†ÙŠ ØªÙ‚ÙˆÙ„: (Ø£Ù†Ø§ Ø£Ø­Ø¨Ùƒ) Ø¨ØµÙˆØª ØªÙ…Ø«ÙŠÙ„ÙŠ ğŸ¤­",
"ØµÙˆÙ‘Ø± ÙŠØ¯Ùƒ ØªØ³ÙˆÙŠ Ù‚Ù„Ø¨ Ø¨Ø³Ø±Ø¹Ø© â¤ï¸",
"ØµÙˆÙ‘Ø± Ø´ÙŠØ¡ Ù‚Ø±ÙŠØ¨ Ù…Ù†Ùƒ ÙˆÙ‚Ù„: (Ù‡Ø°Ø§ ÙŠØ°ÙƒØ±Ù†ÙŠ ÙÙŠÙƒ) ğŸ¥¹",
"ÙÙˆÙŠØ³: Ù‚Ù„ ÙƒÙ„Ù…Ø© (Ø¨Ø®Ø®Ø®) ÙƒØ£Ù†Ùƒ Ø·ÙÙ„ ğŸ˜­",
"ØµÙˆÙ‘Ø± Ù†ÙØ³Ùƒ ØªØ³ÙˆÙŠ Ø³Ù„Ø§Ù… Ø¹Ø³ÙƒØ±ÙŠ 2 Ø«Ø§Ù†ÙŠØ© ğŸ«¡",
"ÙÙˆÙŠØ³: Ù‚Ù„Ø¯ ØµÙˆØª Ø±ÙˆØ¨ÙˆØª 5 Ø«ÙˆØ§Ù†ÙŠ ğŸ¤–",
"ØµÙˆÙ‘Ø± Ø¶Ø­ÙƒØªÙƒ Ø¨Ø¯ÙˆÙ† Ø³Ø¨Ø¨ 3 Ø«ÙˆØ§Ù†ÙŠ ğŸ˜„",
"ØµÙˆÙ‘Ø± Ø­Ø±ÙƒØ© Ø±Ù‚Øµ ØºØ¨ÙŠØ© 2 Ø«Ø§Ù†ÙŠØ© ğŸ’ƒ",
"ØµÙˆÙ‘Ø± Ø£Ù‚Ø±Ø¨ Ø´ÙŠ Ù„ÙˆÙ†Ù‡ Ø£Ø­Ù…Ø± ğŸ”´"
];

const FISH_LOVE = [
"Ø£Ù†Ø³ ÙˆÙ„Ø§Ù†Ø§â€¦ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© Ù†Ø¹Ø¯Ù‘ÙŠÙ‡Ø§ Ø³ÙˆØ§ ØªØ«Ø¨Øª Ø¥Ù†Ù†Ø§ ÙØ±ÙŠÙ‚ ÙˆØ§Ø­Ø¯ â¤ï¸",
"Ø§Ù„Ù‚Ø±Ø¨ Ù…Ùˆ Ù…ÙƒØ§Ù†â€¦ Ø§Ù„Ù‚Ø±Ø¨ Ø§Ø®ØªÙŠØ§Ø± ğŸ’—",
"Ù…Ø§ ÙŠÙ‡Ù… ØµØ¹ÙˆØ¨Ø© Ø§Ù„Ù„ØºØ²â€¦ Ø§Ù„Ù…Ù‡Ù… Ø¥Ù†Ù†Ø§ Ù†Ø­Ù„Ù‘Ù‡ Ø³ÙˆØ§ ğŸ«¶",
"ÙƒÙ„ 4 Ù…Ø±Ø§Ø­Ù„ = Ø°ÙƒØ±Ù‰ ØµØºÙŠØ±Ø© ØªØªØ±Ø³Ø® Ø¨ÙŠÙ†ÙƒÙ… ğŸŒ¹",
"Ø£Ù†ØªÙ… Ø£Ù‚ÙˆÙ‰ Ù…Ù† Ø£ÙŠ Ø¸Ø±Ùâ€¦ Ù„Ø£Ù†ÙƒÙ… Ù…Ø¹ Ø¨Ø¹Ø¶ ğŸ¤",
"Ù‡Ø°Ø§ Ø¹Ø§Ù„Ù…ÙƒÙ…â€¦ ÙˆØ§Ù„Ù„ÙŠ Ø¨ÙŠÙ†ÙƒÙ… Ø£ØºÙ„Ù‰ Ù…Ù† Ø£ÙŠ Ù„ØºØ² ğŸ’—",
"Ù‚Ù„Ø¨ÙŠÙ†â€¦ Ø¨Ø³ Ù†ÙØ³ Ø§Ù„Ù†Ø¨Ø¶ â¤ï¸",
"Ø­ØªÙ‰ Ø§Ù„ØºÙ„Ø·â€¦ ÙŠØµÙŠØ± Ù„Ø·ÙŠÙ Ø¥Ø°Ø§ Ø£Ù†ØªÙ… Ø³ÙˆØ§ ğŸ¤­",
"ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©â€¦ Ø®Ø·ÙˆØ© Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø£Ø¬Ù…Ù„ ğŸ¤",
"Ø£Ù‚ÙˆÙ‰ Ø´ÙŠØŸ Ø¥Ù†ÙƒÙ… Ù…Ø§ ØªØªØ±ÙƒÙˆÙ† Ø¨Ø¹Ø¶ ğŸ’"
];

const FISH_LEVELS = [
["Ø´ÙŠØ¡ ÙƒÙ„Ù…Ø§ Ø£Ø®Ø°Øª Ù…Ù†Ù‡ ÙƒØ¨Ø±ØŒ Ù…Ø§ Ù‡ÙˆØŸ", ["Ø§Ù„Ø­ÙØ±Ø©","Ø§Ù„Ø´Ù…Ø¹Ø©","Ø§Ù„ÙˆÙ‚Øª","Ø§Ù„Ø¸Ù„"], 0],
["Ø´ÙŠØ¡ Ù„Ø§ ÙŠÙÙƒØ³Ø± Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ù†Ø·Ù‚Øª Ø§Ø³Ù…Ù‡ØŒ Ù…Ø§ Ù‡ÙˆØŸ", ["Ø§Ù„ØµÙ…Øª","Ø§Ù„Ø²Ø¬Ø§Ø¬","Ø§Ù„Ø³Ø±","Ø§Ù„Ù‡ÙˆØ§Ø¡"], 0],
["Ø¨ÙŠØª Ø¨Ù„Ø§ Ø£Ø¨ÙˆØ§Ø¨ ÙˆÙ„Ø§ Ù†ÙˆØ§ÙØ°ØŒ Ù…Ø§ Ù‡ÙˆØŸ", ["ØµÙ†Ø¯ÙˆÙ‚","Ø¨ÙŠØ¶Ø©","Ù‚Ù„Ø¨","ÙƒÙ‡Ù"], 1],
["Ù„Ù‡ Ø£Ø³Ù†Ø§Ù† ÙˆÙ„Ø§ ÙŠØ¹Ø¶ØŒ Ù…Ø§ Ù‡ÙˆØŸ", ["Ø§Ù„Ù…Ø´Ø·","Ø§Ù„ÙƒÙ„Ø¨","Ø§Ù„Ù…Ù†Ø´Ø§Ø±","Ø§Ù„Ø°Ø¦Ø¨"], 0],
["ÙŠØ±Ø§Ùƒ ÙˆÙ„Ø§ ØªØ±Ø§Ù‡ØŒ Ù…Ø§ Ù‡ÙˆØŸ", ["Ø§Ù„Ù…Ø±Ø¢Ø©","Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§","Ø§Ù„Ø¸Ù„","Ø§Ù„Ù‡ÙˆØ§Ø¡"], 1],

["Ù…Ø§ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠÙ…Ø´ÙŠ Ø¨Ù„Ø§ Ø±Ø¬Ù„ÙŠÙ†ØŸ", ["Ø§Ù„Ø¸Ù„","Ø§Ù„Ù…Ø·Ø±","Ø§Ù„Ù†Ù‡Ø±","Ø§Ù„ÙˆÙ‚Øª"], 2],
["Ù…Ø§ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ Ø¥Ø°Ø§ Ø²Ø§Ø¯ Ù†Ù‚ØµØŸ", ["Ø§Ù„Ø¹Ù…Ø±","Ø§Ù„Ù…Ø§Ù„","Ø§Ù„Ø¶ÙˆØ¡","Ø§Ù„Ù…Ø§Ø¡"], 0],
["ÙƒÙ… Ø´Ù‡Ø± ÙÙŠ Ø§Ù„Ø³Ù†Ø© ÙÙŠÙ‡ 28 ÙŠÙˆÙ…ØŸ", ["1","2","12","ÙŠØ¹ØªÙ…Ø¯"], 2],
["Ø´ÙŠØ¡ ÙŠÙƒØªØ¨ ÙˆÙ„Ø§ ÙŠÙ‚Ø±Ø£ØŒ Ù…Ø§ Ù‡ÙˆØŸ", ["Ø§Ù„Ù‚Ù„Ù…","Ø§Ù„ÙƒØªØ§Ø¨","Ø§Ù„Ø­Ø¨Ø±","Ø§Ù„Ù…Ø³Ø·Ø±Ø©"], 0],
["Ù„Ù‡ ÙˆØ¬Ù‡ ÙˆÙŠØ¯Ø§Ù† ÙˆÙ„ÙŠØ³ Ø¥Ù†Ø³Ø§Ù†Ù‹Ø§ØŒ Ù…Ø§ Ù‡ÙˆØŸ", ["Ø³Ø§Ø¹Ø©","ÙƒØ±Ø³ÙŠ","Ù…ÙŠØ²Ø§Ù†","Ø¨Ø§Ø¨"], 0],

["Ø´ÙŠØ¡ Ø¥Ø°Ø§ ÙØªØ­ØªÙ‡ Ù„Ø§ ÙŠØºÙ„Ù‚ØŒ Ù…Ø§ Ù‡ÙˆØŸ", ["Ø§Ù„Ø¨Ø§Ø¨","Ø§Ù„ÙƒØªØ§Ø¨","Ø§Ù„ÙÙ…","Ø§Ù„Ù†Ø§ÙØ°Ø©"], 2],
["Ø´ÙŠØ¡ ÙŠÙˆÙ„Ø¯ ÙƒØ¨ÙŠØ±Ù‹Ø§ ÙˆÙŠÙ…ÙˆØª ØµØºÙŠØ±Ù‹Ø§ØŒ Ù…Ø§ Ù‡ÙˆØŸ", ["Ø§Ù„Ø´Ù…Ø¹Ø©","Ø§Ù„Ù‚Ù…Ø±","Ø§Ù„Ø¸Ù„","Ø§Ù„Ø·ÙÙ„"], 0],
["Ù…Ø§ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠØ³Ù…Ø¹ Ø¨Ù„Ø§ Ø£Ø°Ù† ÙˆÙŠØªÙƒÙ„Ù… Ø¨Ù„Ø§ Ù„Ø³Ø§Ù†ØŸ", ["Ø§Ù„ØµØ¯Ù‰","Ø§Ù„Ù‡Ø§ØªÙ","Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ","Ø§Ù„Ø±Ø³Ø§Ù„Ø©"], 0],
["Ø´ÙŠØ¡ ÙŠÙ…Ù„Ùƒ Ù…ÙØ§ØªÙŠØ­ ÙˆÙ„Ø§ ÙŠÙØªØ­ Ø£Ø¨ÙˆØ§Ø¨Ù‹Ø§ØŒ Ù…Ø§ Ù‡ÙˆØŸ", ["Ø§Ù„Ø¨ÙŠØ§Ù†Ùˆ","Ø§Ù„Ù‚ÙÙ„","Ø§Ù„Ø³ÙŠØ§Ø±Ø©","Ø§Ù„Ù…ÙØªØ§Ø­"], 0],
["Ø´ÙŠØ¡ Ù…ØµÙ†ÙˆØ¹ Ù…Ù† Ù…Ø§Ø¡ ÙˆØ¥Ø°Ø§ ÙˆØ¶Ø¹ØªÙ‡ ÙÙŠ Ø§Ù„Ù…Ø§Ø¡ Ù…Ø§ØªØŒ Ù…Ø§ Ù‡ÙˆØŸ", ["Ø§Ù„Ø«Ù„Ø¬","Ø§Ù„Ù…Ù„Ø­","Ø§Ù„Ø²Ø¨Ø¯","Ø§Ù„Ø¨Ø®Ø§Ø±"], 0],

["Ù…Ø§ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠØ²Ø¯Ø§Ø¯ ÙƒÙ„Ù…Ø§ Ø´Ø§Ø±ÙƒØªÙ‡ØŸ", ["Ø§Ù„Ù…Ø§Ù„","Ø§Ù„Ø¹Ù„Ù…","Ø§Ù„Ù†Ø§Ø±","Ø§Ù„Ø­Ø²Ù†"], 1],
["Ø´ÙŠØ¡ ÙŠÙ‚ÙŠØ³ ÙˆÙ„Ø§ ÙŠÙÙˆØ²Ù†ØŒ Ù…Ø§ Ù‡ÙˆØŸ", ["Ø§Ù„Ø³Ø§Ø¹Ø©","Ø§Ù„Ø­Ø±Ø§Ø±Ø©","Ø§Ù„Ø·ÙˆÙ„","Ø§Ù„Ù…Ù„Ø­"], 0],
["Ø´ÙŠØ¡ Ù„Ù‡ Ø±Ù‚Ø¨Ø© Ø¨Ù„Ø§ Ø±Ø£Ø³ØŒ Ù…Ø§ Ù‡ÙˆØŸ", ["Ø²Ø¬Ø§Ø¬Ø©","Ù‚Ù…ÙŠØµ","Ø·Ø§ÙˆÙ„Ø©","Ø²Ø±Ø§ÙØ©"], 0],
["Ù…Ø§ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ Ø¥Ø°Ø§ Ù„Ù…Ø³ØªÙ‡ ØµØ§Ø­ØŸ", ["Ø¬Ø±Ø³","Ø­Ø¯ÙŠØ¯","Ø¨Ø§Ø¨","Ø¸Ù„"], 0],
["Ø´ÙŠØ¡ ÙŠØ®ØªÙÙŠ Ø¥Ø°Ø§ Ù‚Ù„Øª Ø§Ø³Ù…Ù‡ØŒ Ù…Ø§ Ù‡ÙˆØŸ", ["Ø§Ù„ØµÙ…Øª","Ø§Ù„Ø¸Ù„","Ø§Ù„Ù†ÙˆØ±","Ø§Ù„Ù‡ÙˆØ§Ø¡"], 0]
];

while(FISH_LEVELS.length < 150){
const n = FISH_LEVELS.length + 1;
FISH_LEVELS.push([
`Ù„ØºØ² ${n}: Ø´ÙŠØ¡ ÙŠÙØ±Ù‰ ÙˆÙ„Ø§ ÙŠÙÙ„Ù…Ø³ØŒ Ù…Ø§ Ù‡ÙˆØŸ`,
["Ø§Ù„Ù‡ÙˆØ§Ø¡","Ø§Ù„Ø¸Ù„","Ø§Ù„ØµÙˆØª","Ø§Ù„ÙˆÙ‚Øª"],
1
]);
}
if(FISH_LEVELS.length > 150) FISH_LEVELS.length = 150;

function fishStageToIdx(stage){
const s = Math.max(1, Math.min(150, parseInt(stage||1,10)));
return s - 1;
}
function fishGetLevel(stage){
return FISH_LEVELS[fishStageToIdx(stage)];
}
function fishLoveTextForStage(stage){
if(stage % 4 !== 0) return "";
const idx = Math.floor(stage/4) - 1;
return FISH_LOVE[idx % FISH_LOVE.length];
}
function fishPickPunish(){
return FISH_PUNISH[Math.floor(Math.random()*FISH_PUNISH.length)];
}

/********************
* Option 3 DOM
********************/
const fishStageBadge = document.getElementById("fishStageBadge");
const fishQ = document.getElementById("fishQ");
const fishC0 = document.getElementById("fishC0");
const fishC1 = document.getElementById("fishC1");
const fishC2 = document.getElementById("fishC2");
const fishC3 = document.getElementById("fishC3");
const fishResult = document.getElementById("fishResult");
const fishLove = document.getElementById("fishLove");
const fishPunishBtn = document.getElementById("fishPunishBtn");
const fishConfirmBtn = document.getElementById("fishConfirmBtn");
const fishNextBtn = document.getElementById("fishNextBtn");
const fishStatus = document.getElementById("fishStatus");
const fishConfirmLine = document.getElementById("fishConfirmLine");

function setChoicesEnabled(enabled){
[fishC0,fishC1,fishC2,fishC3].forEach(btn=>{
if(!btn) return;
btn.classList.toggle("disabled", !enabled);
});
}

function applyFishUI(opt3){
const stage = Math.max(1, Math.min(150, parseInt(opt3?.stage||1,10)));
const lvl = fishGetLevel(stage);
const q = lvl?.[0] || "â€¦";
const choices = lvl?.[1] || ["â€¦","â€¦","â€¦","â€¦"];

if(fishStageBadge) fishStageBadge.textContent = `Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${stage} / 150`;
if(fishQ) fishQ.textContent = `â“ ${q}`;

if(fishC0) fishC0.textContent = choices[0] ?? "â€”";
if(fishC1) fishC1.textContent = choices[1] ?? "â€”";
if(fishC2) fishC2.textContent = choices[2] ?? "â€”";
if(fishC3) fishC3.textContent = choices[3] ?? "â€”";

if(fishResult) fishResult.textContent = (opt3?.lastText ?? "Ø§Ø®ØªØ§Ø±ÙˆØ§ Ø¬ÙˆØ§Ø¨ Ù…Ù† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ğŸ‘† (Live)");

const loveText = opt3?.loveText || "";
const showLove = !!opt3?.showLove && !!loveText;
if(fishLove){
fishLove.textContent = loveText || "";
fishLove.classList.toggle("show", showLove);
}

const cA = !!opt3?.confirmAnas;
const cL = !!opt3?.confirmLana;
if(fishConfirmLine){
fishConfirmLine.textContent =
`ØªØ£ÙƒÙŠØ¯ Ø£Ù†Ø³: ${cA ? "âœ…" : "â€”"} | ØªØ£ÙƒÙŠØ¯ Ù„Ø§Ù†Ø§: ${cL ? "âœ…" : "â€”"} | (Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ø§ ØªØ·Ù„Ø¹ Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ø§Ù„Ø§Ø«Ù†ÙŠÙ† âœ…âœ…)`;
}

const locked = !!opt3?.autoNext && !opt3?.autoNextDone;
setChoicesEnabled(!locked);

if(fishNextBtn) fishNextBtn.disabled = true;
}

async function fishChoose(choiceIndex){
await pushRoomUpdate({
"opt3.selected": choiceIndex,
"opt3.solved": false,
"opt3.lastText": "âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø®ÙŠØ§Ø±.\nØ§Ù„Ø¢Ù† Ø§Ø¶ØºØ·ÙˆØ§ (ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¬ÙˆØ§Ø¨) Ø£Ù†ØªÙ… Ø§Ù„Ø§Ø«Ù†ÙŠÙ† Ø¹Ø´Ø§Ù† ØªØ·Ù„Ø¹ Ø§Ù„Ù†ØªÙŠØ¬Ø©.",
"opt3.loveText": "",
"opt3.showLove": false,

"opt3.confirmAnas": false,
"opt3.confirmLana": false,
"opt3.evaluatedStage": 0,
"opt3.autoNext": false,
"opt3.autoNextDone": false,
"opt3.updatedBy": currentName || "unknown"
});
}

fishC0?.addEventListener("click", ()=> fishChoose(0));
fishC1?.addEventListener("click", ()=> fishChoose(1));
fishC2?.addEventListener("click", ()=> fishChoose(2));
fishC3?.addEventListener("click", ()=> fishChoose(3));

fishPunishBtn?.addEventListener("click", async ()=>{
const p = fishPickPunish();
await pushRoomUpdate({
"opt3.punishText": `âš ï¸ Ø¹Ù‚Ø§Ø¨: ${p}`,
"opt3.lastText": `âš ï¸ Ø¹Ù‚Ø§Ø¨ Ø·Ù„Ø¹ Ù„ÙƒÙ…:\n${p}`,
"opt3.updatedBy": currentName || "unknown"
});
});

fishConfirmBtn?.addEventListener("click", async ()=>{
const sel = parseInt(window.__fishSelectedCache ?? -1, 10);
if(sel < 0){
await pushRoomUpdate({
"opt3.lastText": "Ø§Ø®ØªØ§Ø±ÙˆØ§ Ø®ÙŠØ§Ø± Ø£ÙˆÙ„Ø§Ù‹ ğŸ‘† Ø«Ù… Ø§Ø¶ØºØ·ÙˆØ§ ØªØ£ÙƒÙŠØ¯ âœ…",
"opt3.updatedBy": currentName || "unknown"
});
return;
}

if(currentName === "ANAS"){
await pushRoomUpdate({ "opt3.confirmAnas": true, "opt3.updatedBy": currentName || "unknown" });
}else{
await pushRoomUpdate({ "opt3.confirmLana": true, "opt3.updatedBy": currentName || "unknown" });
}

await pushRoomUpdate({
"opt3.lastText": "âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯Ùƒ.\nÙ†Ø³ØªÙ†Ù‰ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠâ€¦",
"opt3.updatedBy": currentName || "unknown"
});
});

let __autoNextTimer = null;

async function evaluateIfNeeded(opt3){
if(!currentName) return;

const stage = Math.max(1, Math.min(150, parseInt(opt3?.stage||1,10)));
const selected = parseInt(opt3?.selected ?? -1, 10);

const bothConfirmed = !!opt3?.confirmAnas && !!opt3?.confirmLana;
if(!bothConfirmed) return;

const evaluatedStage = parseInt(opt3?.evaluatedStage||0, 10);
if(evaluatedStage === stage) return;

if((opt3?.updatedBy || "") !== currentName) return;

const lvl = fishGetLevel(stage);
const correct = parseInt(lvl?.[2] ?? 0, 10);
const isCorrect = (selected === correct);

if(isCorrect){
const love = fishLoveTextForStage(stage);
await pushRoomUpdate({
"opt3.solved": true,
"opt3.lastText": "âœ… ØªØ®Ø³ÙŠ Ø§Ù„Ø³Ù…ÙƒØ© Ø§Ø­Ù†Ø§ Ø§Ù‚ÙˆÙ‰ ğŸŸğŸ’ª",
"opt3.loveText": love || "",
"opt3.showLove": !!love,
"opt3.evaluatedStage": stage,
"opt3.autoNext": true,
"opt3.autoNextDone": false,
"opt3.updatedBy": currentName || "unknown"
});
}else{
await pushRoomUpdate({
"opt3.solved": false,
"opt3.lastText": "âŒ ØºÙ„Ø·â€¦ Ø¬Ø±Ù‘Ø¨ÙˆØ§ Ø®ÙŠØ§Ø± Ø«Ø§Ù†ÙŠ ğŸ‘€\n(Ø§Ø®ØªØ§Ø±ÙˆØ§ Ù…Ù† Ø¬Ø¯ÙŠØ¯ Ø«Ù… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø«Ù†ÙŠÙ†)",
"opt3.loveText": "",
"opt3.showLove": false,
"opt3.evaluatedStage": stage,
"opt3.confirmAnas": false,
"opt3.confirmLana": false,
"opt3.updatedBy": currentName || "unknown"
});
}
}

async function autoNextIfNeeded(opt3){
if(!currentName) return;
const stage = Math.max(1, Math.min(150, parseInt(opt3?.stage||1,10)));

const shouldAuto = !!opt3?.autoNext && !opt3?.autoNextDone && !!opt3?.solved;
if(!shouldAuto) return;

if((opt3?.updatedBy || "") !== currentName) return;
if(__autoNextTimer) return;

__autoNextTimer = setTimeout(async ()=>{
__autoNextTimer = null;

if(stage >= 150){
await pushRoomUpdate({
"opt3.lastText": "ğŸ‰ Ø®Ù„ØµØªÙˆØ§ Ø§Ù„Ù€ 150 Ù…Ø±Ø­Ù„Ø©! Ø£Ù†ØªÙ… Ø£Ù‚ÙˆÙ‰ Ù…Ù† Ø§Ù„Ø³Ù…ÙƒØ© ÙˆÙ…Ù† ÙƒÙ„ Ø´ÙŠ â¤ï¸",
"opt3.showLove": true,
"opt3.loveText": "Ø£Ù†Ø³ ÙˆÙ„Ø§Ù†Ø§â€¦ ÙˆØµÙ„ØªÙˆØ§ Ù„Ù„Ù†Ù‡Ø§ÙŠØ© Ù„Ø£Ù†ÙƒÙ… Ù…Ø§ ØªØªØ±ÙƒÙˆÙ† Ø¨Ø¹Ø¶.\nØ£Ø­Ø¨ÙƒÙ… ğŸ’—",
"opt3.autoNextDone": true,
"opt3.updatedBy": currentName || "unknown"
});
return;
}

const nextStage = stage + 1;
await pushRoomUpdate({
"opt3.stage": nextStage,
"opt3.selected": -1,
"opt3.solved": false,
"opt3.lastText": "Ø§Ø®ØªØ§Ø±ÙˆØ§ Ø¬ÙˆØ§Ø¨ Ù…Ù† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ğŸ‘† (Live)",
"opt3.loveText": "",
"opt3.showLove": false,
"opt3.punishText": "",
"opt3.confirmAnas": false,
"opt3.confirmLana": false,
"opt3.evaluatedStage": 0,
"opt3.autoNext": false,
"opt3.autoNextDone": true,
"opt3.updatedBy": currentName || "unknown"
});
}, 900);
}

/********************
/********************
* âœ… OPTION 4: PUZZLE
********************/
const puzStageBadge = document.getElementById("puzStageBadge");
const puzRoleBadge = document.getElementById("puzRoleBadge");
const puzSwapBtn = document.getElementById("puzSwapBtn");
const puzResetBtn = document.getElementById("puzResetBtn");
const puzNextBtn = document.getElementById("puzNextBtn");
const puzViewerPanel = document.getElementById("puzViewerPanel");
const puzAssemblerPanel = document.getElementById("puzAssemblerPanel");
const puzFullImg = document.getElementById("puzFullImg");
const puzBoard = document.getElementById("puzBoard");
const puzTray = document.getElementById("puzTray");
const puzStatus = document.getElementById("puzStatus");
const puzSuccess = document.getElementById("puzSuccess");
const puzViewerMini = document.getElementById("puzViewerMini");
const puzAssemblerMini = document.getElementById("puzAssemblerMini");

const puzTabCoop = document.getElementById("puzTabCoop");
const puzTabChallenge = document.getElementById("puzTabChallenge");
const puzSectionBadge = document.getElementById("puzSectionBadge");

const puzMiniBoard = document.getElementById("puzMiniBoard");
const puzMiniBoardInfo = document.getElementById("puzMiniBoardInfo");
const puzMiniBoardWrap = document.getElementById("puzMiniBoardWrap");
const puzViewerHint = document.getElementById("puzViewerHint");

const PUZ_PER_SECTION = 100;

function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

/* âœ… ØµØ¹Ù‘Ø¨Ù†Ø§ Ø§Ù„Ø¨Ø²Ù„ Ø£ÙƒØ«Ø±: ÙŠÙˆØµÙ„ 6Ã—6 */
function puzGridForStage(stage){
  if(stage <= 15) return 3;
  if(stage <= 55) return 4;
  if(stage <= 90) return 5;
  return 6;
}

// âœ… Ù…Ø±Ø§Ø­Ù„ Ø®Ø§ØµØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ 200 (100 Ù…Ø´ØªØ±Ùƒ + 100 ØªØ­Ø¯ÙŠ)
const SPECIAL_BATMAN_GLOBAL = new Set([9, 50, 120, 180]);
const SPECIAL_KITTY_GLOBAL = new Set([18, 70, 160, 199]);

function puzGlobalStage(section, stage){
  const s = clamp(parseInt(stage||1,10), 1, PUZ_PER_SECTION);
  const base = (section === "coop") ? 0 : PUZ_PER_SECTION;
  return base + s; // 1..200
}

/* âœ… FIX: ØµÙˆØ± Ù…Ø³ØªÙ‚Ø±Ø© Ø¬Ø¯Ù‹Ø§ Ø¨Ø¯Ù„ Unsplash */
function picsumUrl(seed){
  return `https://picsum.photos/seed/${encodeURIComponent(seed)}/900/900`;
}

/* âœ… ØµÙˆØ± Batman / Hello Kitty Ù…ÙˆÙ„Ø¯Ø© Canvas (Ù…Ø¶Ù…ÙˆÙ†Ø© ØªØ¸Ù‡Ø±) */
const PUZ_IMG_CACHE = new Map();

function makePosterDataUrl(opts){
  const { bg1, bg2, emoji, title, subtitle } = opts;
  const c = document.createElement("canvas");
  c.width = 900;
  c.height = 900;
  const ctx = c.getContext("2d");

  const grad = ctx.createLinearGradient(0, 0, 900, 900);
  grad.addColorStop(0, bg1);
  grad.addColorStop(1, bg2);
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, 900, 900);

  // dots
  ctx.globalAlpha = 0.18;
  for(let i=0;i<120;i++){
    ctx.beginPath();
    ctx.arc(rand(0,900), rand(0,900), rand(2,10), 0, Math.PI*2);
    ctx.fillStyle = "white";
    ctx.fill();
  }
  ctx.globalAlpha = 1;

  // emoji
  ctx.font = "160px system-ui, -apple-system, Segoe UI, Arial";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillStyle = "rgba(255,255,255,.95)";
  ctx.fillText(emoji, 450, 330);

  // title
  ctx.font = "900 88px system-ui, -apple-system, Segoe UI, Arial";
  ctx.fillStyle = "rgba(255,255,255,.96)";
  ctx.fillText(title, 450, 520);

  // subtitle
  ctx.font = "700 34px system-ui, -apple-system, Segoe UI, Arial";
  ctx.fillStyle = "rgba(255,255,255,.78)";
  ctx.fillText(subtitle, 450, 600);

  // frame
  ctx.strokeStyle = "rgba(255,255,255,.18)";
  ctx.lineWidth = 10;
  ctx.strokeRect(30,30,840,840);

  return c.toDataURL("image/png");
}

function puzGetImage(section, stage){
  const g = puzGlobalStage(section, stage);
  if(PUZ_IMG_CACHE.has(g)) return PUZ_IMG_CACHE.get(g);

  let url = "";
  if(SPECIAL_BATMAN_GLOBAL.has(g)){
    url = makePosterDataUrl({
      bg1:"#0b0f1e", bg2:"#eab308",
      emoji:"ğŸ¦‡",
      title:"BATMAN",
      subtitle:"Ù…Ø±Ø­Ù„Ø© Ø®Ø§ØµØ© Ù„ÙƒÙ… ğŸ’›"
    });
  }else if(SPECIAL_KITTY_GLOBAL.has(g)){
    url = makePosterDataUrl({
      bg1:"#ff4d7d", bg2:"#7c3aed",
      emoji:"ğŸ€ğŸ±",
      title:"HELLO KITTY",
      subtitle:"Ù…Ø±Ø­Ù„Ø© Ø®Ø§ØµØ© Ù„ÙƒÙ… ğŸ’—"
    });
  }else{
    url = picsumUrl(`puz-${g}`);
  }

  PUZ_IMG_CACHE.set(g, url);
  return url;
}

function makeShuffle(n){
  const a = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function objKeysLen(obj){
  try{ return Object.keys(obj||{}).length; }catch(e){ return 0; }
}

function puzIsSolved(placed, n){
  for(let i=0;i<n;i++){
    const v = placed?.[String(i)];
    if(typeof v !== "number") return false;
    if(v !== i) return false;
  }
  return true;
}

/* âœ… ÙŠÙ…Ù†Ø¹ â€œØ·Ù„ÙˆØ¹ Ø§Ù„ØµÙØ­Ø© Ù„ÙÙˆÙ‚â€ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ */
function puzNoScroll(e){
  if(!e) return;

  // Ø£Ù‡Ù… Ø´ÙŠØ¡: Ù†Ø®Ù„ÙŠ Ø§Ù„Ù„Ù…Ø³ ÙŠØ´ØªØºÙ„ (Ù„Ø§ Ù†Ù…Ù†Ø¹ Ø§Ù„Ù„Ù…Ø³)
  // ÙˆÙ†Ù…Ù†Ø¹ Ø¨Ø³ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ù„ÙŠ ÙŠØ³Ø¨Ø¨ Ù‚ÙØ²Ø©/Ù„ÙŠÙ†Ùƒ
  e.stopPropagation();

  // Ù†Ù…Ù†Ø¹ Ø§Ù„Ù€ default ÙÙ‚Ø· ÙÙŠ "click" (Ø¹Ø´Ø§Ù† Ù„Ùˆ ÙÙŠÙ‡ a href Ø£Ùˆ Ø´ÙŠ)
  if(e.type === "click" && e.cancelable) e.preventDefault();
}
/* âœ… Ù‚Ø·Ø¹Ø© */
function puzCreatePieceEl(grid, img, pieceIndex){
  const el = document.createElement("div");
  el.className = "puzPiece";
  el.dataset.piece = String(pieceIndex);
  el.style.backgroundImage = `url("${img}")`;
  const row = Math.floor(pieceIndex / grid);
  const col = pieceIndex % grid;
  el.style.backgroundSize = `${grid*100}% ${grid*100}%`;
  el.style.backgroundPosition = `${(col/(grid-1))*100}% ${(row/(grid-1))*100}%`;
  // ÙŠÙ…Ù†Ø¹ Ø³Ù„ÙˆÙƒ Ø§Ù„Ù„Ù…Ø³ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø§Ù„Ù„ÙŠ ÙŠØ³Ø¨Ø¨ Ù‚ÙØ²Ø©
  el.style.touchAction = "manipulation";
  return el;
}

function puzSetTabsUI(section){
  if(puzTabCoop) puzTabCoop.classList.toggle("active", section==="coop");
  if(puzTabChallenge) puzTabChallenge.classList.toggle("active", section==="challenge");
  if(puzSectionBadge){
    puzSectionBadge.textContent = `Ø§Ù„Ù‚Ø³Ù…: ${section==="coop" ? "Ù…Ø´ØªØ±Ùƒ ğŸ¤" : "ØªØ­Ø¯Ù‘ÙŠ ğŸ”¥"}`;
  }
}

function canAssembleNow(section, roles){
  if(section === "coop") return true;
  const r = roles || {viewer:"ANAS", assembler:"LANA"};
  return (currentName === (r.assembler || "LANA"));
}

function isViewerNow(section, roles){
  if(section === "coop") return false;
  const r = roles || {viewer:"ANAS", assembler:"LANA"};
  return (currentName === (r.viewer || "ANAS"));
}

function puzSetRoleUI(section, roles){
  if(section === "coop"){
    if(puzRoleBadge) puzRoleBadge.textContent = `Ø§Ù„Ø¯ÙˆØ±: ğŸ¤ Ø§Ù„Ø§Ø«Ù†ÙŠÙ† ÙŠØ±ÙƒÙ‘Ø¨ÙˆÙ† Ø³ÙˆØ§`;
    if(puzViewerPanel) puzViewerPanel.style.display = "block";
    if(puzAssemblerPanel) puzAssemblerPanel.style.display = "block";
    if(puzSwapBtn) puzSwapBtn.style.display = "none";
    if(puzMiniBoardWrap) puzMiniBoardWrap.style.display = "none";
    if(puzViewerHint) puzViewerHint.textContent = "ÙÙŠ Ø§Ù„Ù…Ø´ØªØ±Ùƒ: Ø§Ù„Ø§Ø«Ù†ÙŠÙ† ÙŠØ±ÙƒÙ‘Ø¨ÙˆÙ† Ø³ÙˆØ§ âœ…";
    return;
  }

  if(puzSwapBtn) puzSwapBtn.style.display = "inline-flex";
  const v = roles?.viewer || "â€”";
  const a = roles?.assembler || "â€”";
  if(puzRoleBadge) puzRoleBadge.textContent = `Ø§Ù„Ø¯ÙˆØ±: ğŸ‘ï¸ ${v} | ğŸ§© ${a}`;

  const viewer = isViewerNow(section, roles);
  if(puzViewerPanel) puzViewerPanel.style.display = viewer ? "block" : "none";
  if(puzAssemblerPanel) puzAssemblerPanel.style.display = viewer ? "none" : "block";
  if(puzMiniBoardWrap) puzMiniBoardWrap.style.display = viewer ? "block" : "none";
  if(puzViewerHint) puzViewerHint.textContent = "Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ÙŠØ¸Ù‡Ø± Ù„Ù„Ø´Ø®Øµ â€œØ§Ù„Ù…Ø´Ø§Ù‡Ø¯â€ ÙÙ‚Ø· ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø¯Ù‘ÙŠ.";
}

const PUZ_CHEERS = [
  "ÙŠØ§ Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…â€¦ ÙØ±ÙŠÙ‚ ÙˆØ§Ø­Ø¯ ÙˆÙ‚Ù„Ø¨ ÙˆØ§Ø­Ø¯ ğŸ’—",
  "ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© ØªØ®Ù„Ù‘ØµÙˆÙ†Ù‡Ø§ ØªØ«Ø¨Øª Ø¥Ù†ÙƒÙ… Ø£Ù‚ÙˆÙ‰ Ø³ÙˆØ§ ğŸ¤",
  "Ø£Ù†ØªÙ… Ù…Ø§Ø´ÙŠÙŠÙ† ØµØ­â€¦ ÙƒÙ…Ù„ÙˆØ§ Ø¨Ù†ÙØ³ Ø§Ù„Ø±ÙˆØ­ ğŸŒ¹",
  "Ø£Ù†Ø§ ÙØ®ÙˆØ± ÙÙŠÙƒÙ…â€¦ ÙƒØ°Ø§ Ø§Ù„Ø­Ø¨ ÙŠÙƒÙˆÙ† ğŸ«¶",
  "Ù‚Ø±Ø¨ÙƒÙ… ÙŠÙƒØ¨Ø± Ø­ØªÙ‰ ÙˆØ£Ù†ØªÙ… Ø¨Ø¹ÙŠØ¯ÙŠÙ† â¤ï¸",
  "Ø¨Ø±Ø§ÙÙˆ! Ø§Ù„Ù„ÙŠ Ø¨ÙŠÙ†ÙƒÙ… ÙŠÙ„Ù…Ø¹ Ù…Ø¹ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© âœ¨",
  "Ù‡Ø°Ø§ Ø¹Ø§Ù„Ù…ÙƒÙ…â€¦ ÙˆÙ…Ø§ ÙÙŠÙ‡ Ø´ÙŠ ÙŠÙˆÙ‚ÙÙƒÙ… ğŸ’",
  "ÙŠØ§ Ø­Ù„Ùˆ ØªØ¹Ø§ÙˆÙ†ÙƒÙ…â€¦ ÙŠÙƒØ³Ø± Ø£ÙŠ ØµØ¹ÙˆØ¨Ø© ğŸ§©"
];
function pickCheer(stageGlobal){
  return PUZ_CHEERS[(stageGlobal * 3) % PUZ_CHEERS.length];
}

async function puzEnsureStageFields(opt4puz){
  const section = (opt4puz?.section === "coop") ? "coop" : "challenge";
  const stage = clamp(parseInt(opt4puz?.stage||1,10), 1, PUZ_PER_SECTION);
  const grid = puzGridForStage(stage);
  const n = grid*grid;

  const img = puzGetImage(section, stage);

  let shuffle = Array.isArray(opt4puz?.shuffle) ? opt4puz.shuffle.slice(0) : [];
  if(shuffle.length !== n){
    shuffle = makeShuffle(n);
  }

  const needUpdate =
    (opt4puz?.section !== section) ||
    (opt4puz?.grid !== grid) ||
    (opt4puz?.img !== img) ||
    (!Array.isArray(opt4puz?.shuffle) || opt4puz.shuffle.length !== n) ||
    (parseInt(opt4puz?.gateStage||0,10) !== stage);

  if(needUpdate){
    await pushRoomUpdate({
      "opt4puz.section": section,
      "opt4puz.grid": grid,
      "opt4puz.img": img,
      "opt4puz.shuffle": shuffle,

      // gate align
      "opt4puz.gateStage": stage,
      "opt4puz.gateDone": false,

      "opt4puz.updatedBy": currentName || "unknown"
    });
  }
}

function renderMiniBoard(section, grid, img, placed){
  if(!puzMiniBoard) return;
  if(section === "coop") return;

  puzMiniBoard.style.gridTemplateColumns = `repeat(${grid}, 1fr)`;
  puzMiniBoard.innerHTML = "";

  const n = grid*grid;
  let filled = 0;
  for(let s=0;s<n;s++){
    const slot = document.createElement("div");
    slot.className = "puzMiniSlot";
    const p = placed?.[String(s)];
    if(typeof p === "number"){
      filled++;
      slot.classList.add("filled");
      const piece = document.createElement("div");
      piece.className = "puzMiniPiece";
      piece.style.backgroundImage = `url("${img}")`;
      const row = Math.floor(p / grid);
      const col = p % grid;
      piece.style.backgroundSize = `${grid*100}% ${grid*100}%`;
      piece.style.backgroundPosition = `${(col/(grid-1))*100}% ${(row/(grid-1))*100}%`;
      piece.style.touchAction = "manipulation";
      slot.appendChild(piece);
    }
    puzMiniBoard.appendChild(slot);
  }

  if(puzMiniBoardInfo){
    puzMiniBoardInfo.textContent = `Ù…Ø±ÙƒÙ‘Ø¨: ${filled}/${n}`;
  }
}

/* âœ… Ø²Ø± Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ø´ØºØ§Ù„ Ø¯Ø§ÙŠÙ… */
async function puzToggleReady(){
  const stage = clamp(parseInt(window.__puzStageCache||1,10), 1, PUZ_PER_SECTION);

  const gStage = parseInt(window.__puzGateStageCache||stage,10);
  if(gStage !== stage){
    await pushRoomUpdate({
      "opt4puz.gateStage": stage,
      "opt4puz.gateDone": false,
      "opt4puz.updatedBy": currentName || "unknown"
    });
  }

  const isAnas = (currentName === "ANAS");
  const curA = !!window.__puzNextReadyAnasCache;
  const curL = !!window.__puzNextReadyLanaCache;

  const nextA = isAnas ? !curA : curA;
  const nextL = isAnas ? curL : !curL;

  await pushRoomUpdate({
    "opt4puz.nextReadyAnas": nextA,
    "opt4puz.nextReadyLana": nextL,
    "opt4puz.updatedBy": currentName || "unknown"
  });
}

let __puzGateTimer = null;
async function puzAutoAdvanceIfReady(opt4puz){
  if(!currentName) return;

  const section = (opt4puz?.section === "coop") ? "coop" : "challenge";
  const stageNow = clamp(parseInt(opt4puz?.stage||1,10), 1, PUZ_PER_SECTION);

  const gateStage = clamp(parseInt(opt4puz?.gateStage||stageNow,10), 1, PUZ_PER_SECTION);
  const gateDone = !!opt4puz?.gateDone;
  const readyA = !!opt4puz?.nextReadyAnas;
  const readyL = !!opt4puz?.nextReadyLana;

  // âœ… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ ÙÙ‚Ø· Ø¥Ø°Ø§ Ø§Ù„Ø§Ø«Ù†ÙŠÙ† Ø¬Ø§Ù‡Ø²ÙŠÙ† (Ø¨Ø¯ÙˆÙ† Ø´Ø±Ø· Ø­Ù„ Ø§Ù„Ø¨Ø²Ù„)
  if(gateDone) return;
  if(gateStage !== stageNow) return;
  if(!(readyA && readyL)) return;

  // âœ… Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„: ANAS ÙÙ‚Ø·
  if(currentName !== "ANAS") return;
  if(__puzGateTimer) return;

  __puzGateTimer = setTimeout(async ()=>{
    __puzGateTimer = null;

    if(stageNow >= PUZ_PER_SECTION){
      const cheer = pickCheer(puzGlobalStage(section, stageNow));
      await pushRoomUpdate({
        "opt4puz.cheer": `ğŸ‰ Ø®Ù„ØµØªÙˆØ§ Ù‚Ø³Ù… ${section==="coop" ? "Ù…Ø´ØªØ±Ùƒ" : "ØªØ­Ø¯Ù‘ÙŠ"} Ø¨Ø§Ù„ÙƒØ§Ù…Ù„!\n${cheer}`,
        "opt4puz.gateDone": true,
        "opt4puz.updatedBy": currentName || "unknown"
      });
      return;
    }

    const nextStage = stageNow + 1;
    const grid = puzGridForStage(nextStage);
    const n = grid*grid;
    const img = puzGetImage(section, nextStage);
    const shuffle = makeShuffle(n);
    const cheer = pickCheer(puzGlobalStage(section, nextStage));

    await pushRoomUpdate({
      "opt4puz.stage": nextStage,
      "opt4puz.grid": grid,
      "opt4puz.img": img,
      "opt4puz.shuffle": shuffle,
      "opt4puz.placed": {},
      "opt4puz.sel": -1,
      "opt4puz.solved": false,

      // reset ready + gate
      "opt4puz.nextReadyAnas": false,
      "opt4puz.nextReadyLana": false,
      "opt4puz.gateStage": nextStage,
      "opt4puz.gateDone": false,

      "opt4puz.cheer": cheer,
      "opt4puz.updatedBy": currentName || "unknown"
    });
  }, 250);
}

function puzApplyUI(opt4puz){
  const section = (opt4puz?.section === "coop") ? "coop" : "challenge";
  const stage = clamp(parseInt(opt4puz?.stage||1,10), 1, PUZ_PER_SECTION);
  const grid = puzGridForStage(stage);
  const n = grid*grid;

  puzSetTabsUI(section);

  if(puzStageBadge) puzStageBadge.textContent = `Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${stage} / ${PUZ_PER_SECTION}`;
  const roles = opt4puz?.roles || {viewer:"ANAS", assembler:"LANA"};
  puzSetRoleUI(section, roles);

  const img = puzGetImage(section, stage);

  // âœ… FIX: Ù„Ùˆ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© (Ù†Ø§Ø¯Ø±)ØŒ Ù†Ø±Ø¬Ø¹ Picsum
  if(puzFullImg){
    puzFullImg.onerror = null;
    puzFullImg.src = img;
    puzFullImg.onerror = ()=>{
      puzFullImg.onerror = null;
      puzFullImg.src = picsumUrl(`fallback-${section}-${stage}`);
    };
    // Ù…Ù†Ø¹ Ø³Ù„ÙˆÙƒ Ø§Ù„Ù„Ù…Ø³ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    puzFullImg.style.touchAction = "manipulation";
  }

  const placed = opt4puz?.placed || {};
  const sel = parseInt(opt4puz?.sel ?? -1, 10);
  const solved = !!opt4puz?.solved;

  const readyA = !!opt4puz?.nextReadyAnas;
  const readyL = !!opt4puz?.nextReadyLana;

  if(puzViewerMini){
    const g = puzGlobalStage(section, stage);
    puzViewerMini.textContent = `Ù…Ø±Ø­Ù„Ø© ${stage} â€¢ Global ${g}`;
  }
  if(puzAssemblerMini){
    puzAssemblerMini.textContent = `Ø§Ø®ØªÙŠØ§Ø±: ${sel >= 0 ? (sel+1) : "â€”"} â€¢ Ù‚Ø·Ø¹: ${n}`;
  }

  renderMiniBoard(section, grid, img, placed);

  // âœ… Ù…Ù†Ø¹ Ø§Ù„Ù‚ÙØ²Ø©: Ø£ÙŠ Ù„Ù…Ø³/Ø¶ØºØ· Ø¯Ø§Ø®Ù„ Ù„ÙˆØ­ Ø§Ù„Ø¨Ø²Ù„ Ù…Ø§ ÙŠØ±Ø¬Ù‘Ø¹ Ø§Ù„ØµÙØ­Ø© Ù„ÙÙˆÙ‚
if(puzBoard){
  puzBoard.style.touchAction = "manipulation";
}
if(puzTray){
  puzTray.style.touchAction = "manipulation";
}

  // Board
  if(puzBoard){
    puzBoard.style.gridTemplateColumns = `repeat(${grid}, 1fr)`;
    puzBoard.innerHTML = "";
    for(let s=0;s<n;s++){
      const slot = document.createElement("div");
      slot.className = "puzSlot";
      slot.dataset.slot = String(s);
      slot.style.touchAction = "manipulation";

      const p = placed[String(s)];
      if(typeof p === "number"){
        slot.classList.add("filled");
        const piece = puzCreatePieceEl(grid, img, p);
        slot.appendChild(piece);

        slot.addEventListener("click", async (e)=>{
          puzNoScroll(e);

          const rolesNow = window.__puzRolesCache || roles;
          const sectionNow = window.__puzSectionCache || section;
          if(!canAssembleNow(sectionNow, rolesNow)) return;

          const nextPlaced = {...(window.__puzPlacedCache||placed)};
          delete nextPlaced[String(s)];
          await pushRoomUpdate({
            "opt4puz.placed": nextPlaced,
            "opt4puz.sel": -1,
            "opt4puz.solved": false,

            // âœ… Ø£ÙŠ ØªØºÙŠÙŠØ± ÙŠØµÙÙ‘Ø± Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ù„Ù„Ø·Ø±ÙÙŠÙ†
            "opt4puz.nextReadyAnas": false,
            "opt4puz.nextReadyLana": false,
            "opt4puz.gateStage": stage,
            "opt4puz.gateDone": false,

            "opt4puz.updatedBy": currentName || "unknown"
          });
        }, { passive:false });

        slot.addEventListener("touchstart", puzNoScroll, { passive:false });

      }else{
        slot.addEventListener("click", async (e)=>{
          puzNoScroll(e);

          const rolesNow = window.__puzRolesCache || roles;
          const sectionNow = window.__puzSectionCache || section;
          if(!canAssembleNow(sectionNow, rolesNow)) return;

          const selected = parseInt(window.__puzSelCache ?? sel, 10);
          if(selected < 0) return;

          const nextPlaced = {...(window.__puzPlacedCache||placed)};
          for(const k of Object.keys(nextPlaced)){
            if(nextPlaced[k] === selected) delete nextPlaced[k];
          }
          nextPlaced[String(s)] = selected;

          const done = puzIsSolved(nextPlaced, n);

          await pushRoomUpdate({
            "opt4puz.placed": nextPlaced,
            "opt4puz.sel": -1,
            "opt4puz.solved": done,

            // âœ… Ø£ÙŠ ØªØºÙŠÙŠØ± ÙŠØµÙÙ‘Ø± Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ù„Ù„Ø·Ø±ÙÙŠÙ†
            "opt4puz.nextReadyAnas": false,
            "opt4puz.nextReadyLana": false,
            "opt4puz.gateStage": stage,
            "opt4puz.gateDone": false,

            "opt4puz.updatedBy": currentName || "unknown"
          });
        }, { passive:false });

        slot.addEventListener("touchstart", puzNoScroll, { passive:false });
      }

      puzBoard.appendChild(slot);
    }
  }

  // Tray
  if(puzTray){
    puzTray.innerHTML = "";
    const shuffle = Array.isArray(opt4puz?.shuffle) ? opt4puz.shuffle.slice(0) : Array.from({length:n},(_,i)=>i);

    const used = new Set();
    for(const k of Object.keys(placed||{})){
      const v = placed[k];
      if(typeof v === "number") used.add(v);
    }

    for(const pieceIndex of shuffle){
      if(used.has(pieceIndex)) continue;

      const tile = document.createElement("div");
      tile.className = "puzTile";
      tile.dataset.piece = String(pieceIndex);
      tile.style.touchAction = "manipulation";

      if(pieceIndex === sel) tile.classList.add("selected");

      const pieceEl = puzCreatePieceEl(grid, img, pieceIndex);
      tile.appendChild(pieceEl);

      tile.addEventListener("click", async (e)=>{
        puzNoScroll(e);

        const rolesNow = window.__puzRolesCache || roles;
        const sectionNow = window.__puzSectionCache || section;
        if(!canAssembleNow(sectionNow, rolesNow)) return;

        const currentSel = parseInt(window.__puzSelCache ?? sel, 10);
        const nextSel = (currentSel === pieceIndex) ? -1 : pieceIndex;
        await pushRoomUpdate({
          "opt4puz.sel": nextSel,
          "opt4puz.updatedBy": currentName || "unknown"
        });
      }, { passive:false });

      tile.addEventListener("touchstart", puzNoScroll, { passive:false });

      puzTray.appendChild(tile);
    }
  }

  const placedCount = objKeysLen(placed);
  const remain = Math.max(0, n - placedCount);

  if(puzSuccess){
    puzSuccess.classList.toggle("show", solved);
    if(solved){
      const cheer = (typeof opt4puz?.cheer === "string" && opt4puz.cheer.trim()) ? opt4puz.cheer.trim() : "";
      puzSuccess.textContent = cheer
        ? `âœ… Ø¨Ø±Ø§ÙÙˆ! Ø®Ù„ØµØªÙˆØ§ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ğŸ’—\n${cheer}`
        : `âœ… Ø¨Ø±Ø§ÙÙˆ! Ø®Ù„ØµØªÙˆØ§ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ğŸ’—`;
    }else{
      puzSuccess.textContent = "âœ… Ø¨Ø±Ø§ÙÙˆ! Ø®Ù„ØµØªÙˆØ§ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ğŸ’—";
    }
  }

  /* âœ… Ø²Ø± Ø¬Ø§Ù‡Ø²: Ù…Ø§ Ø¹Ø§Ø¯ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù„ */
  if(puzNextBtn){
    const myReady = (currentName === "ANAS") ? readyA : readyL;
    const bothReady = readyA && readyL;

    puzNextBtn.textContent = myReady
      ? "âœ… Ø¬Ø§Ù‡Ø² (ØªÙ…) â€” Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ"
      : "âœ… Ø£Ù†Ø§ Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ§Ù„ÙŠ";

    puzNextBtn.style.opacity = (bothReady ? 0.95 : 1);
  }

  if(puzStatus){
    const by = opt4puz?.updatedBy || "â€”";
    const gateLine = `Ø¬Ø§Ù‡Ø²ÙŠØ© Ø£Ù†Ø³: ${readyA ? "âœ…" : "â€”"} | Ø¬Ø§Ù‡Ø²ÙŠØ© Ù„Ø§Ù†Ø§: ${readyL ? "âœ…" : "â€”"}\n(Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„: Ù„Ø§Ø²Ù… âœ…âœ… ÙÙ‚Ø·)`;
    puzStatus.textContent =
      `Live âœ… | Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${by}\nÙ‚Ø³Ù…: ${section==="coop" ? "Ù…Ø´ØªØ±Ùƒ" : "ØªØ­Ø¯Ù‘ÙŠ"} | Ø´Ø¨ÙƒØ©: ${grid}x${grid} | Ø¨Ø§Ù‚ÙŠ: ${remain} Ù‚Ø·Ø¹Ø©\n${gateLine}`;
  }
}

async function puzSwitchSection(nextSection){
  const section = (nextSection === "coop") ? "coop" : "challenge";
  const stage = 1;
  const grid = puzGridForStage(stage);
  const n = grid*grid;

  const img = puzGetImage(section, stage);
  const shuffle = makeShuffle(n);

  await pushRoomUpdate({
    "opt4puz.section": section,
    "opt4puz.stage": stage,
    "opt4puz.grid": grid,
    "opt4puz.img": img,
    "opt4puz.shuffle": shuffle,
    "opt4puz.placed": {},
    "opt4puz.sel": -1,
    "opt4puz.solved": false,

    "opt4puz.nextReadyAnas": false,
    "opt4puz.nextReadyLana": false,
    "opt4puz.gateStage": stage,
    "opt4puz.gateDone": false,
    "opt4puz.cheer": "",

    "opt4puz.updatedBy": currentName || "unknown"
  });
}

async function puzSwapRoles(){
  const section = window.__puzSectionCache || "challenge";
  if(section === "coop") return;

  const roles = window.__puzRolesCache || {viewer:"ANAS", assembler:"LANA"};
  const nextRoles = { viewer: roles.assembler || "LANA", assembler: roles.viewer || "ANAS" };
  await pushRoomUpdate({
    "opt4puz.roles": nextRoles,
    "opt4puz.sel": -1,
    "opt4puz.updatedBy": currentName || "unknown"
  });
}

async function puzResetStage(){
  const section = window.__puzSectionCache || "challenge";
  const stage = clamp(parseInt(window.__puzStageCache||1,10), 1, PUZ_PER_SECTION);
  const grid = puzGridForStage(stage);
  const n = grid*grid;

  const img = puzGetImage(section, stage);
  const shuffle = makeShuffle(n);

  await pushRoomUpdate({
    "opt4puz.grid": grid,
    "opt4puz.img": img,
    "opt4puz.shuffle": shuffle,
    "opt4puz.placed": {},
    "opt4puz.sel": -1,
    "opt4puz.solved": false,

    "opt4puz.nextReadyAnas": false,
    "opt4puz.nextReadyLana": false,
    "opt4puz.gateStage": stage,
    "opt4puz.gateDone": false,
    "opt4puz.cheer": "",

    "opt4puz.updatedBy": currentName || "unknown"
  });
}

puzTabCoop?.addEventListener("click", ()=> puzSwitchSection("coop"));
puzTabChallenge?.addEventListener("click", ()=> puzSwitchSection("challenge"));
puzSwapBtn?.addEventListener("click", puzSwapRoles);
puzResetBtn?.addEventListener("click", puzResetStage);
puzNextBtn?.addEventListener("click", puzToggleReady);


/********************
* âœ… OPTION 5: KITCHEN (Live) â€” FIXED (phase-based)
********************/
const kitStageBadge = document.getElementById("kitStageBadge");
const kitRecipeBadge = document.getElementById("kitRecipeBadge");
const kitLiveLine = document.getElementById("kitLiveLine");
const kitProgressText = document.getElementById("kitProgressText");

const kitRecipeGrid = document.getElementById("kitRecipeGrid");
const kitConfirmRecipeBtn = document.getElementById("kitConfirmRecipeBtn");
const kitResetAllBtn = document.getElementById("kitResetAllBtn");
const kitRecipeConfirmLine = document.getElementById("kitRecipeConfirmLine");

const kitDecoBoard = document.getElementById("kitDecoBoard");
const kitDecoHint = document.getElementById("kitDecoHint");
const kitMadeByUsBtn = document.getElementById("kitMadeByUsBtn");
const kitSaveBtn = document.getElementById("kitSaveBtn");
const kitStatus = document.getElementById("kitStatus");

const kitAlbumBtn = document.getElementById("kitAlbumBtn");
const kitAlbumModal = document.getElementById("kitAlbumModal");
const kitAlbumClose = document.getElementById("kitAlbumClose");
const kitAlbumGrid = document.getElementById("kitAlbumGrid");

const kitReadyBuildBtn = document.getElementById("kitReadyBuildBtn");

// phases: 0=pick, 1=build (cake only), 2=decorate, 3=serve
const KIT_PHASES = [
  { title:"ğŸ“– Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆØµÙØ©", desc:"Ø§Ø®ØªØ§Ø±ÙˆØ§ ÙˆØµÙØ©â€¦ Ø«Ù… Ù„Ø§Ø²Ù… (ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙˆØµÙØ©) Ù…Ù† Ø§Ù„Ø·Ø±ÙÙŠÙ† âœ…" },
  { title:"ğŸ° Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª", desc:"Ø£Ø¶ÙŠÙÙˆØ§ Ø·Ø¨Ù‚Ø§Øª + Ø­Ø´ÙˆØ© + Ù„ÙˆÙ† Ø§Ù„Ø·Ø¨Ù‚â€¦ Ø«Ù… Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ø§Ø«Ù†ÙŠÙ† âœ…âœ…" },
  { title:"ğŸ¨ ØªØ²ÙŠÙŠÙ†", desc:"ØªØ²ÙŠÙŠÙ† ÙƒØ¨ÙŠØ±: Ø´Ù…ÙˆØ¹/Ù‚Ù„ÙˆØ¨/ÙÙˆØ§ÙƒÙ‡/Ø­Ø±ÙˆÙ/ØµÙˆØµØ§Øªâ€¦ ÙƒÙ„ Ø´ÙŠØ¡ Live ğŸ’—" },
  { title:"ğŸ½ï¸ ØªÙ‚Ø¯ÙŠÙ… + Ø­ÙØ¸", desc:"Ø§ÙƒØªØ¨ÙˆØ§ Ø§Ø³Ù… Ø§Ù„Ø­Ù„Ùˆ ÙˆØ§Ø­ÙØ¸ÙˆÙ‡ ÙÙŠ Ø§Ù„Ø£Ù„Ø¨ÙˆÙ… âœ…" }
];

const BUILD_COLORS = ["pink","red","black","white","brown"];
const PLATE_COLORS = ["pink","red","black","white","purple"];
const FILLINGS = ["vanilla","choco","strawberry","none"];

const KIT_RECIPES = [
  { id:"cake_layers", name:"ğŸ‚ ÙƒÙŠÙƒ Ø·Ø¨Ù‚Ø§Øª", type:"cake" },
  { id:"cake_redvelvet", name:"â¤ï¸ ÙƒÙŠÙƒ Ø±ÙŠØ¯ ÙÙŠÙ„ÙØª", type:"cake" },
  { id:"cake_choco", name:"ğŸ« ÙƒÙŠÙƒ Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©", type:"cake" },
  { id:"cake_strawberry", name:"ğŸ“ ÙƒÙŠÙƒ ÙØ±Ø§ÙˆÙ„Ø©", type:"cake" },
  { id:"donut", name:"ğŸ© Ø¯ÙˆÙ†Ø§Øª (ØªØ²ÙŠÙŠÙ† ÙÙ‚Ø·)", type:"donut" },
];

function kitIsAnas(){ return currentName === "ANAS"; }
function kitMyReadyKey(){ return kitIsAnas() ? "readyNextAnas" : "readyNextLana"; }
function kitMyConfirmKey(){ return kitIsAnas() ? "confirmRecipeAnas" : "confirmRecipeLana"; }
function kitMyPickKey(){ return kitIsAnas() ? "pickAnas" : "pickLana"; }

function kitId(){ return Math.random().toString(36).slice(2) + Date.now().toString(36); }
function kitNowDateStr(){
  const d = new Date();
  const yy = d.getFullYear();
  const mm = String(d.getMonth()+1).padStart(2,"0");
  const dd = String(d.getDate()).padStart(2,"0");
  const hh = String(d.getHours()).padStart(2,"0");
  const mi = String(d.getMinutes()).padStart(2,"0");
  return `${yy}-${mm}-${dd} ${hh}:${mi}`;
}

function kitCanBuild(opt5){
  return !!opt5.recipeLocked && (opt5.recipeType !== "donut") && parseInt(opt5.phase||0,10) === 1;
}
function kitCanDecoratePhase(opt5){
  return !!opt5.recipeLocked && parseInt(opt5.phase||0,10) === 2;
}
function kitCanServe(opt5){
  return !!opt5.recipeLocked && parseInt(opt5.phase||0,10) === 3;
}

function kitOpenAlbum(){ kitAlbumModal?.classList.add("show"); }
function kitCloseAlbum(){ kitAlbumModal?.classList.remove("show"); }

function kitRenderRecipeGrid(selectedId){
  if(!kitRecipeGrid) return;
  kitRecipeGrid.innerHTML = "";
  KIT_RECIPES.forEach(r=>{
    const b = document.createElement("button");
    b.className = "kitRecipeBtn";
    b.textContent = r.name;
    if(r.id === selectedId) b.classList.add("selected");
    b.addEventListener("click", async ()=>{
      const opt5 = window.__kitCache || {};
      if(opt5.recipeLocked) return;

      await pushRoomUpdate({
        "opt5kitchen.recipeId": r.id,
        "opt5kitchen.recipeName": r.name,
        "opt5kitchen.recipeType": r.type,
        [`opt5kitchen.${kitMyPickKey()}`]: r.id,

        // reset confirms + lock
        "opt5kitchen.confirmRecipeAnas": false,
        "opt5kitchen.confirmRecipeLana": false,
        "opt5kitchen.recipeLocked": false,

        // reset phase
        "opt5kitchen.phase": 0,
        "opt5kitchen.readyNextAnas": false,
        "opt5kitchen.readyNextLana": false,

        // reset build + deco
        "opt5kitchen.build": { plate:"pink", layers:[], filling:"none" },
        "opt5kitchen.decoItems": [],
        "opt5kitchen.madeByUs": false,

        "opt5kitchen.updatedBy": currentName || "unknown"
      });
    });
    kitRecipeGrid.appendChild(b);
  });
}

// âœ… missing in your file
async function kitConfirmRecipe(){
  const opt5 = window.__kitCache || {};
  if(opt5.recipeLocked) return;

  if(!opt5.recipeId){
    alert("Ø§Ø®ØªØ§Ø±ÙˆØ§ ÙˆØµÙØ© Ø£ÙˆÙ„Ø§Ù‹ ğŸ‘‡");
    return;
  }

  await pushRoomUpdate({
    [`opt5kitchen.${kitMyConfirmKey()}`]: true,
    "opt5kitchen.updatedBy": currentName || "unknown"
  });
}

// auto-lock when both confirmed (leader: ANAS)
async function kitAutoLockRecipeIfBoth(opt5){
  if(!currentName) return;
  if(opt5.recipeLocked) return;

  const both = !!opt5.confirmRecipeAnas && !!opt5.confirmRecipeLana;
  if(!both) return;

  if(currentName !== "ANAS") return;

  const type = opt5.recipeType || "cake";
  const nextPhase = (type === "donut") ? 2 : 1;

  await pushRoomUpdate({
    "opt5kitchen.recipeLocked": true,
    "opt5kitchen.phase": nextPhase,
    "opt5kitchen.readyNextAnas": false,
    "opt5kitchen.readyNextLana": false,
    "opt5kitchen.updatedBy": currentName || "unknown"
  });
}

async function kitToggleReadyPhase(){
  const opt5 = window.__kitCache || {};
  if(!opt5.recipeLocked) return;

  const mine = !!opt5[kitMyReadyKey()];
  await pushRoomUpdate({
    [`opt5kitchen.${kitMyReadyKey()}`]: !mine,
    "opt5kitchen.updatedBy": currentName || "unknown"
  });
}

let __kitPhaseTimer = null;
async function kitAutoAdvancePhase(opt5){
  if(!currentName) return;
  if(!opt5.recipeLocked) return;

  const phase = parseInt(opt5.phase||0,10);
  const rA = !!opt5.readyNextAnas;
  const rL = !!opt5.readyNextLana;
  if(!(rA && rL)) return;

  if(currentName !== "ANAS") return;
  if(__kitPhaseTimer) return;

  __kitPhaseTimer = setTimeout(async ()=>{
    __kitPhaseTimer = null;

    let next = phase + 1;
    if(next > 3) next = 3;

    await pushRoomUpdate({
      "opt5kitchen.phase": next,
      "opt5kitchen.readyNextAnas": false,
      "opt5kitchen.readyNextLana": false,
      "opt5kitchen.updatedBy": currentName || "unknown"
    });
  }, 350);
}

async function kitBuildAction(action){
  const opt5 = window.__kitCache || {};
  if(!kitCanBuild(opt5)) return;

  const build = opt5.build || { plate:"pink", layers:[], filling:"none" };
  const next = {
    plate: build.plate || "pink",
    layers: Array.isArray(build.layers) ? build.layers.slice(0) : [],
    filling: build.filling || "none"
  };

  if(action === "addLayer"){
    const c = BUILD_COLORS[Math.floor(Math.random()*BUILD_COLORS.length)];
    next.layers.push({ color: c, height: 18 });
  }
  if(action === "addFilling"){
    next.filling = FILLINGS[Math.floor(Math.random()*FILLINGS.length)];
  }
  if(action === "plateColor"){
    next.plate = PLATE_COLORS[Math.floor(Math.random()*PLATE_COLORS.length)];
  }
  if(action === "undo"){
    if(next.layers.length > 0) next.layers.pop();
    else next.filling = "none";
  }
  if(action === "resetBuild"){
    next.plate = "pink"; next.layers = []; next.filling = "none";
  }

  await pushRoomUpdate({
    "opt5kitchen.build": next,
    "opt5kitchen.readyNextAnas": false,
    "opt5kitchen.readyNextLana": false,
    "opt5kitchen.updatedBy": currentName || "unknown"
  });
}

function kitRenderAlbum(album){
  if(!kitAlbumGrid) return;
  kitAlbumGrid.innerHTML = "";

  const list = Array.isArray(album) ? album.slice(0) : [];
  list.sort((a,b)=> (b?.date||"").localeCompare(a?.date||""));

  if(list.length === 0){
    const div = document.createElement("div");
    div.className = "kitAlbumCard";
    div.innerHTML = `<div class="kitAlbumMeta">Ø§Ù„Ø£Ù„Ø¨ÙˆÙ… ÙØ§Ø¶ÙŠâ€¦ Ø£ÙˆÙ„ Ø­ÙØ¸ Ø¨ÙŠØ·Ù„Ø¹ Ù‡Ù†Ø§ ğŸ’—</div>`;
    kitAlbumGrid.appendChild(div);
    return;
  }

  list.forEach(item=>{
    const card = document.createElement("div");
    card.className = "kitAlbumCard";

    const img = document.createElement("img");
    img.className = "kitAlbumImg";
    img.alt = "album";
    img.loading = "lazy";
    img.src = item.img || "";

    const meta = document.createElement("div");
    meta.className = "kitAlbumMeta";
    meta.textContent =
      `ğŸ“Œ ${item.name || "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"}\n` +
      `ğŸ½ï¸ ${item.recipe || "â€”"}\n` +
      `ğŸ—“ï¸ ${item.date || "â€”"}`;

    card.appendChild(img);
    card.appendChild(meta);
    kitAlbumGrid.appendChild(card);
  });
}
	/********************
* âœ… KITCHEN MISSING FUNCS (RENDER + DECO + EXPORT)
********************/

const kitCakeBoard = document.getElementById("kitCakeBoard");
const kitCakeHint = document.getElementById("kitCakeHint");

// 1) Render cake build preview
function kitFillingColor(f){
  if(f==="vanilla") return "#fff3c4";
  if(f==="choco") return "#6b3f2a";
  if(f==="strawberry") return "#ff7aa5";
  return "transparent";
}
function kitLayerColor(c){
  if(c==="red") return "#ff5a6a";
  if(c==="black") return "#2a2a2a";
  if(c==="white") return "#f3f3f3";
  if(c==="brown") return "#8b5a3c";
  return "#ff6fb1";
}
function kitPlateColor(p){
  if(p==="red") return "#ff4b4b";
  if(p==="black") return "#1c1c1c";
  if(p==="white") return "#eaeaea";
  if(p==="purple") return "#a855f7";
  return "#ff6fb1";
}

function kitDrawCakeInto(container, opt5, {mini=false} = {}){
  const build = opt5?.build || { plate:"pink", layers:[], filling:"none" };
  const plate = build.plate || "pink";
  const layers = Array.isArray(build.layers) ? build.layers : [];
  const filling = build.filling || "none";

  container.innerHTML = "";

  // plate
  const plateEl = document.createElement("div");
  plateEl.className = mini ? "kitCakePlate kitMini" : "kitCakePlate";
  plateEl.style.background = kitPlateColor(plate);
  container.appendChild(plateEl);

  // stack
  const max = Math.min(layers.length, 6);
  const baseBottom = mini ? 18 : 22;
  const gap = mini ? 10 : 11;

  for(let i=0;i<max;i++){
    const c = layers[i]?.color || "pink";

    const layerEl = document.createElement("div");
    layerEl.className = mini ? "kitCakeLayer kitMini" : "kitCakeLayer";
    layerEl.style.background = kitLayerColor(c);
    layerEl.style.bottom = (baseBottom + i*gap) + "%";
    container.appendChild(layerEl);

    // filling between layers (except after last)
    if(i < max-1 && filling !== "none"){
      const cream = document.createElement("div");
      cream.className = mini ? "kitCakeCream kitMini" : "kitCakeCream";
      cream.style.background = kitFillingColor(filling);
      cream.style.bottom = (baseBottom + i*gap + (mini?7:8)) + "%";
      container.appendChild(cream);
    }
  }

  // label
  const fillTxt = (filling==="vanilla") ? "ğŸ¥› ÙØ§Ù†ÙŠÙ„Ø§"
               : (filling==="choco") ? "ğŸ« Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©"
               : (filling==="strawberry") ? "ğŸ“ ÙØ±Ø§ÙˆÙ„Ø©"
               : "ğŸš« Ø¨Ø¯ÙˆÙ† Ø­Ø´ÙˆØ©";

  const badge = document.createElement("div");
  badge.className = mini ? "kitCakeFilling kitMini" : "kitCakeFilling";
  badge.textContent = fillTxt;
  container.appendChild(badge);
}

function kitRenderCake(opt5){
  if(!kitCakeBoard) return;

  // Ù„Ùˆ ÙˆØµÙ„Ù†Ø§ Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ²ÙŠÙŠÙ†: Ù„Ø§ ØªØ¹Ø±Ø¶ â€œØ§Ø®ØªØ§Ø±ÙˆØ§ ÙˆØµÙØ©â€
  if(kitCanDecoratePhase(opt5)){
    kitCakeBoard.innerHTML = `<div class="kitDecoHint">âœ… ØªÙ… Ù†Ù‚Ù„ Ø§Ù„ÙƒÙŠÙƒØ© Ø¥Ù„Ù‰ Ù…Ø±Ø¨Ø¹ â€œØ§Ù„ØªØ²ÙŠÙŠÙ†â€</div>`;
    return;
  }

  // Ø¨Ù†Ø§Ø¡ ÙÙ‚Ø·
  if(!kitCanBuild(opt5)){
    kitCakeBoard.innerHTML = `<div class="kitDecoHint">Ø§Ø®ØªØ§Ø±ÙˆØ§ ÙˆØµÙØ© Ø£ÙˆÙ„Ù‹Ø§â€¦ Ø¨Ø¹Ø¯ÙŠÙ† ØªØ¨Ø¯Ø£ÙˆÙ† Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª ğŸ’—</div>`;
    return;
  }

  kitCakeBoard.innerHTML = "";
  const holder = document.createElement("div");
  holder.className = "kitCakeStage";
  kitCakeBoard.appendChild(holder);

  kitDrawCakeInto(holder, opt5, {mini:false});

  const layers = Array.isArray(opt5?.build?.layers) ? opt5.build.layers : [];
  if(layers.length === 0){
    const note = document.createElement("div");
    note.className = "kitDecoHint";
    note.textContent = "Ø§Ø¨Ø¯Ø£ÙˆØ§: Ø§Ø¶ØºØ·ÙˆØ§ â• Ø·Ø¨Ù‚Ø© Ø¹Ø´Ø§Ù† ÙŠØ·Ù„Ø¹ Ø§Ù„ÙƒÙŠÙƒ Ù‡Ù†Ø§ ğŸ°";
    kitCakeBoard.appendChild(note);
  }
}
// 2) Decoration: add emojis as draggable-ish items
function kitAddDeco(type){
  const opt5 = window.__kitCache || {};
  if(!kitCanDecoratePhase(opt5)){
    alert("Ø§Ù„ØªØ²ÙŠÙŠÙ† ÙŠÙØªØ­ ÙÙŠ Ù…Ø±Ø­Ù„Ø© (ğŸ¨ ØªØ²ÙŠÙŠÙ†) âœ…\nØ®Ù„Ù‘ØµÙˆØ§ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø«Ù… Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ø§Ø«Ù†ÙŠÙ†.");
    return;
  }

  const map = {
    layer: "ğŸ°",
    cream: "ğŸ¦",
    sauce: "ğŸ«",
    fruit: "ğŸ“",
    choco: "ğŸª",
    sprinkle: "âœ¨",
    candle: "ğŸ•¯ï¸",
    heart: "ğŸ’—",
    text: "ğŸ“",
    random: "ğŸ²"
  };

  let emoji = map[type] || "âœ¨";
  if(type === "random"){
    const arr = ["ğŸ“","ğŸ«","ğŸª","âœ¨","ğŸ’—","ğŸ•¯ï¸","ğŸ’","ğŸ§","ğŸ¬"];
    emoji = arr[Math.floor(Math.random()*arr.length)];
  }

  let txt = "";
  if(type === "text"){
    txt = prompt("Ø§ÙƒØªØ¨ Ø§Ø³Ù…/ÙƒÙ„Ù…Ø© Ù‚ØµÙŠØ±Ø© Ù„Ù„ØªØ²ÙŠÙŠÙ†:");
    if(txt === null) return;
    txt = (txt || "").trim().slice(0, 12);
    if(!txt) return;
  }

  const item = {
    id: kitId(),
    t: type,
    v: (type === "text") ? txt : emoji,
    x: Math.floor(rand(15, 85)),
    y: Math.floor(rand(20, 75)),
    s: Math.floor(rand(20, 42))
  };

  const list = Array.isArray(opt5.decoItems) ? opt5.decoItems.slice(0) : [];
  list.push(item);

  return pushRoomUpdate({
    "opt5kitchen.decoItems": list,
    "opt5kitchen.updatedBy": currentName || "unknown"
  });
}

// 3) â€œMade by usâ€
function kitMadeByUs(){
  const opt5 = window.__kitCache || {};
  if(!kitCanDecoratePhase(opt5)){
    alert("Ø²Ø± (ØµÙ†Ø¹ ÙŠØ¯Ù†Ø§) ÙŠØ´ØªØºÙ„ ÙÙŠ Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ²ÙŠÙŠÙ† âœ…");
    return;
  }
  return pushRoomUpdate({
    "opt5kitchen.madeByUs": true,
    "opt5kitchen.updatedBy": currentName || "unknown"
  });
}

// Render deco items to board
function kitRenderDeco(opt5){
  if(!kitDecoBoard) return;

  kitDecoBoard.innerHTML = `<div class="kitDecoHint" id="kitDecoHint"></div>`;
  const hint = kitDecoBoard.querySelector("#kitDecoHint");

  if(!kitCanDecoratePhase(opt5)){
    if(hint) hint.textContent = "Ø§Ø¨Ø¯Ø£ÙˆØ§ Ø§Ù„ØªØ²ÙŠÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù…Ø±Ø­Ù„Ø© â€œØ§Ù„ØªØ²ÙŠÙŠÙ†â€ ğŸ’—";
    return;
  }
  if(hint) hint.style.display = "none";

  // base cake in deco board (mini)
  const stage = document.createElement("div");
  stage.className = "kitDecoStage";
  kitDecoBoard.appendChild(stage);

  const cakeBase = document.createElement("div");
  cakeBase.className = "kitCakeStage kitMiniWrap";
  stage.appendChild(cakeBase);

  kitDrawCakeInto(cakeBase, opt5, {mini:true});

  // deco overlay
  const overlay = document.createElement("div");
  overlay.className = "kitDecoOverlay";
  stage.appendChild(overlay);

  const items = Array.isArray(opt5.decoItems) ? opt5.decoItems : [];
  items.forEach(it=>{
    const d = document.createElement("div");
    d.className = "kitDecoItem";
    d.textContent = it.v || "âœ¨";
    d.style.left = (it.x || 50) + "%";
    d.style.top  = (it.y || 50) + "%";
    d.style.fontSize = (it.s || 28) + "px";
    overlay.appendChild(d);

    d.addEventListener("click", async ()=>{
      const cur = window.__kitCache || {};
      const arr = Array.isArray(cur.decoItems) ? cur.decoItems.slice(0) : [];
      const next = arr.filter(x=> x.id !== it.id);
      await pushRoomUpdate({
        "opt5kitchen.decoItems": next,
        "opt5kitchen.updatedBy": currentName || "unknown"
      });
    });
  });

  if(opt5.madeByUs){
    const badge = document.createElement("div");
    badge.className = "kitCakeFilling kitMini";
    badge.textContent = "ğŸ’— ØµÙ†Ø¹ ÙŠØ¯Ù†Ø§";
    kitDecoBoard.appendChild(badge);
  }
}
// 4) Export board to image (simple canvas drawing)
function kitBoardToDataURL(opt5){
  try{
    const c = document.createElement("canvas");
    c.width = 900; c.height = 560;
    const ctx = c.getContext("2d");

    // background
    const g = ctx.createLinearGradient(0,0,900,560);
    g.addColorStop(0, "rgba(255,255,255,.08)");
    g.addColorStop(1, "rgba(0,0,0,.18)");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,900,560);

    // title
    ctx.fillStyle = "rgba(255,255,255,.95)";
    ctx.font = "700 28px system-ui, -apple-system, Segoe UI, Arial";
    ctx.fillText("Our Kitchen ğŸ’—", 22, 44);

    // recipe
    ctx.fillStyle = "rgba(255,255,255,.80)";
    ctx.font = "700 18px system-ui, -apple-system, Segoe UI, Arial";
    ctx.fillText(opt5?.recipeName || "â€”", 22, 76);

    // draw cake simplified
    const build = opt5?.build || { plate:"pink", layers:[], filling:"none" };
    const layers = Array.isArray(build.layers) ? build.layers : [];
    const plate = build.plate || "pink";
    const filling = build.filling || "none";

    function plateColor(p){
      if(p==="red") return "#ff4b4b";
      if(p==="black") return "#1c1c1c";
      if(p==="white") return "#eaeaea";
      if(p==="purple") return "#a855f7";
      return "#ff6fb1";
    }
    function layerColor(c){
      if(c==="red") return "#ff5a5a";
      if(c==="black") return "#242424";
      if(c==="white") return "#f1f1f1";
      if(c==="brown") return "#8b5a3c";
      return "#ff6fb1";
    }

    // plate
    ctx.fillStyle = plateColor(plate);
    ctx.globalAlpha = 0.85;
    ctx.beginPath();
    ctx.ellipse(450, 470, 260, 46, 0, 0, Math.PI*2);
    ctx.fill();
    ctx.globalAlpha = 1;

    // layers
    const max = Math.min(layers.length, 6);
    for(let i=0;i<max;i++){
      const y = 420 - i*48;
      ctx.fillStyle = layerColor(layers[i]?.color || "pink");
      ctx.globalAlpha = 0.9;
      ctx.fillRect(320, y, 260, 40);
      ctx.globalAlpha = 1;
    }

    // filling label
    ctx.fillStyle = "rgba(255,255,255,.85)";
    ctx.font = "800 18px system-ui, -apple-system, Segoe UI, Arial";
    const fillTxt = (filling==="vanilla") ? "Vanilla"
                 : (filling==="choco") ? "Choco"
                 : (filling==="strawberry") ? "Strawberry"
                 : "None";
    ctx.fillText("Filling: " + fillTxt, 22, 110);

    // deco items text
    const items = Array.isArray(opt5?.decoItems) ? opt5.decoItems : [];
    ctx.font = "40px system-ui, -apple-system, Segoe UI, Arial";
    items.slice(0,14).forEach(it=>{
      const x = 140 + (it.x||50)/100 * 620;
      const y = 160 + (it.y||50)/100 * 330;
      ctx.fillText(it.v || "âœ¨", x, y);
    });

    // footer
    ctx.fillStyle = "rgba(255,255,255,.75)";
    ctx.font = "700 16px system-ui, -apple-system, Segoe UI, Arial";
    ctx.fillText(kitNowDateStr(), 22, 540);

    return c.toDataURL("image/png");
  }catch(e){
    return "";
  }
}

// (Ø§Ø®ØªØµØ±Ù†Ø§ Ø§Ù„Ø­ÙØ¸: ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ kitBoardToDataURL Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¹Ù†Ø¯Ùƒ)
// Ø§Ù„Ù…Ù‡Ù…: Ù„Ø§ ØªÙƒÙˆÙ† Ø¯Ø§Ø®Ù„Ù‡Ø§ Ø¯ÙˆØ§Ù„ Ø«Ø§Ù†ÙŠØ© Ø£Ùˆ Ø£Ù‚ÙˆØ§Ø³ Ù†Ø§Ù‚ØµØ©
async function kitSaveToAlbum(){if(__savingAlbum) return;
__savingAlbum = true;
let __savingAlbum = false;
  const opt5 = window.__kitCache || {};
  const phase = parseInt(opt5.phase||0,10);
if(phase < 2){ // 2 = Ø§Ù„ØªØ²ÙŠÙŠÙ†
  alert("ÙƒÙ…Ù‘Ù„ÙˆØ§ Ø§Ù„ØªØ²ÙŠÙŠÙ† Ø£ÙˆÙ„Ø§Ù‹ ğŸ¨");
  return;
}

  const dishName = prompt("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø·Ø¨Ù‚ / Ø§Ù„Ø­Ù„Ùˆ Ø§Ù„Ù„ÙŠ Ø³ÙˆÙŠØªÙˆ ğŸ’—:");
  if(dishName === null) return;
  const name = (dishName||"").trim().slice(0, 40);
  if(!name) return;

  const img = kitBoardToDataURL(opt5);
  if(!img) return;

  const entry = {
    id: kitId(),
    name,
    date: kitNowDateStr(),
    recipe: opt5.recipeName || "â€”",
    img
  };

  const album = Array.isArray(opt5.album) ? opt5.album.slice(0) : [];
  album.unshift(entry);
  if(album.length > 40) album.length = 40;

  await pushRoomUpdate({
    "opt5kitchen.album": album,
    "opt5kitchen.updatedBy": currentName || "unknown"
  });

  kitOpenAlbum();
}

function kitApplyUI(opt5){
  const phase = parseInt(opt5.phase||0,10);
  const phaseTitle = KIT_PHASES[phase]?.title || "â€¦";

  if(kitStageBadge) kitStageBadge.textContent = `Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${phaseTitle}`;
  if(kitRecipeBadge) kitRecipeBadge.textContent = `Ø§Ù„ÙˆØµÙØ©: ${opt5.recipeName || "â€”"}`;

  if(kitLiveLine){
    const by = opt5.updatedBy || "â€”";
    kitLiveLine.textContent = `Live âœ… | Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${by} | Ù…Ù‚ÙÙ„: ${opt5.recipeLocked ? "âœ…" : "â€”"}`;
  }

  kitRenderRecipeGrid(opt5.recipeId || "");

  if(kitRecipeConfirmLine){
    kitRecipeConfirmLine.textContent =
      `Ø§Ø®ØªÙŠØ§Ø± Ø£Ù†Ø³: ${opt5.pickAnas ? "âœ…" : "â€”"} | Ø§Ø®ØªÙŠØ§Ø± Ù„Ø§Ù†Ø§: ${opt5.pickLana ? "âœ…" : "â€”"}\n` +
      `ØªØ£ÙƒÙŠØ¯ Ø£Ù†Ø³: ${opt5.confirmRecipeAnas ? "âœ…" : "â€”"} | ØªØ£ÙƒÙŠØ¯ Ù„Ø§Ù†Ø§: ${opt5.confirmRecipeLana ? "âœ…" : "â€”"} | (Ø§Ù„Ù‚ÙÙ„ ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯ âœ…âœ…)`;
  }

  if(kitConfirmRecipeBtn){
    kitConfirmRecipeBtn.disabled = !!opt5.recipeLocked;
    kitConfirmRecipeBtn.style.opacity = opt5.recipeLocked ? 0.6 : 1;
	  kitRenderCake(opt5);
kitRenderDeco(opt5);
  }

  // hint in deco board
  const canDeco = kitCanDecoratePhase(opt5);
  if(kitDecoHint) kitDecoHint.style.display = canDeco ? "none" : "grid";

  if(kitProgressText){
    if(!opt5.recipeLocked){
      kitProgressText.textContent = "Ø§Ø®ØªØ§Ø±ÙˆØ§ ÙˆØµÙØ© Ù…Ù† ØªØ­Øªâ€¦ Ø«Ù… (ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙˆØµÙØ©) Ù…Ù† Ø§Ù„Ø·Ø±ÙÙŠÙ† âœ…";
    } else {
      kitProgressText.textContent = KIT_PHASES[phase]?.desc || "â€¦";
    }
  }

  if(kitReadyBuildBtn){
    const myReady = !!opt5[kitMyReadyKey()];
    const can = !!opt5.recipeLocked && (phase >= 1 && phase <= 2);
    kitReadyBuildBtn.disabled = !can;
    kitReadyBuildBtn.style.opacity = can ? 1 : 0.6;
    kitReadyBuildBtn.textContent = myReady ? "âœ… Ø¬Ø§Ù‡Ø² (ØªÙ…) â€” Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ" : "âœ… Ø£Ù†Ø§ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„";
  }

  if(kitStatus){
    const decoCount = Array.isArray(opt5.decoItems) ? opt5.decoItems.length : 0;
    kitStatus.textContent =
      `Live âœ… | ğŸ½ï¸ ${opt5.recipeName || "â€”"}\n` +
      `Phase: ${phase} | ØªØ²ÙŠÙŠÙ†: ${decoCount} | Ø£Ù„Ø¨ÙˆÙ…: ${(Array.isArray(opt5.album)?opt5.album.length:0)}`;
  }

  kitRenderAlbum(opt5.album);

	kitRenderCake(opt5);
kitRenderDeco(opt5);

  // autos
  kitAutoLockRecipeIfBoth(opt5);
  kitAutoAdvancePhase(opt5);
}

// âœ… bind
(function bindKitchenUI(){
  kitConfirmRecipeBtn?.addEventListener("click", kitConfirmRecipe);

  kitResetAllBtn?.addEventListener("click", async ()=>{
    await pushRoomUpdate({
      "opt5kitchen.recipeId": "",
      "opt5kitchen.recipeName": "",
      "opt5kitchen.recipeType": "",
      "opt5kitchen.pickAnas": "",
      "opt5kitchen.pickLana": "",
      "opt5kitchen.confirmRecipeAnas": false,
      "opt5kitchen.confirmRecipeLana": false,
      "opt5kitchen.recipeLocked": false,
      "opt5kitchen.phase": 0,
      "opt5kitchen.readyNextAnas": false,
      "opt5kitchen.readyNextLana": false,
      "opt5kitchen.build": { plate:"pink", layers:[], filling:"none" },
      "opt5kitchen.decoItems": [],
      "opt5kitchen.madeByUs": false,
      "opt5kitchen.updatedBy": currentName || "unknown"
    });
  });

  document.getElementById("kitReadyBuildBtn")?.addEventListener("click", kitToggleReadyPhase);

  document.querySelectorAll(".kitTool").forEach(btn=>{
    btn.addEventListener("click", async ()=>{
      const buildAct = btn.getAttribute("data-build");
      const decoType = btn.getAttribute("data-tool");
      if(buildAct) return kitBuildAction(buildAct);
     if(decoType) return window.kitAddDeco?.(decoType);// Ø¯Ø§Ù„ØªÙƒ Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙˆÙ‚
    });
  });

  kitMadeByUsBtn?.addEventListener("click", ()=> window.kitMadeByUs?.()); // Ø¯Ø§Ù„ØªÙƒ Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙˆÙ‚
  kitSaveBtn?.addEventListener("click", kitSaveToAlbum);

  kitAlbumBtn?.addEventListener("click", kitOpenAlbum);
  kitAlbumClose?.addEventListener("click", kitCloseAlbum);
  kitAlbumModal?.addEventListener("click", (e)=>{ if(e.target === kitAlbumModal) kitCloseAlbum(); });
})();
	/********************
* âœ… OPTION 6: INVESTIGATION â€” 100 CASES (Live + No-back)
********************/
const invStageBadge = document.getElementById("invStageBadge");
const invRoleBadge  = document.getElementById("invRoleBadge");
const invJudgeLine  = document.getElementById("invJudgeLine");
const invCaseTitle  = document.getElementById("invCaseTitle");
const invCharge     = document.getElementById("invCharge");
const invBrief      = document.getElementById("invBrief");
const invFull       = document.getElementById("invFull");
const invTruthBox   = document.getElementById("invTruthBox");
const invTruth      = document.getElementById("invTruth");
const invActions    = document.getElementById("invActions");
const invBtnGuilty  = document.getElementById("invBtnGuilty");
const invBtnInnocent= document.getElementById("invBtnInnocent");
const invResult     = document.getElementById("invResult");
const invLockLine   = document.getElementById("invLockLine");
const invStatus     = document.getElementById("invStatus");

function invIsAnas(){ return currentName === "ANAS"; }
function invInvestigatorForStage(stage){
  // ÙŠØªØ¨Ø¯Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙƒÙ„ Ù‚Ø¶ÙŠØ©
  // Ù‚Ø¶ÙŠØ© 1: Ø§Ù„Ù…Ø­Ù‚Ù‚ ANASØŒ Ù‚Ø¶ÙŠØ© 2: Ø§Ù„Ù…Ø­Ù‚Ù‚ LANAØŒ ÙˆÙ‡ÙƒØ°Ø§
  return (stage % 2 === 1) ? "ANAS" : "LANA";
}
function invAccusedForStage(stage){
  return invInvestigatorForStage(stage) === "ANAS" ? "LANA" : "ANAS";
}
function invAmIInvestigator(stage){ return currentName === invInvestigatorForStage(stage); }
function invAmIAccused(stage){ return currentName === invAccusedForStage(stage); }

function invSeededRng(seed){
  let t = seed >>> 0;
  return function(){
    t += 0x6D2B79F5;
    let x = Math.imul(t ^ (t >>> 15), 1 | t);
    x ^= x + Math.imul(x ^ (x >>> 7), 61 | x);
    return ((x ^ (x >>> 14)) >>> 0) / 4294967296;
  };
}
function invPick(rng, arr){ return arr[Math.floor(rng()*arr.length)]; }
function invClamp(n,a,b){ return Math.max(a, Math.min(b, n)); }

function invGenerateCase(stage){
  const s = invClamp(parseInt(stage||1,10), 1, 100);
  const rng = invSeededRng(1000 + s*777);

  const cities = ["Ø¬Ø¯Ø©","Ø§Ù„Ø±ÙŠØ§Ø¶","Ø§Ù„Ø¯Ù…Ø§Ù…","Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©","Ù…ÙƒØ©","Ø£Ø¨Ù‡Ø§","Ø§Ù„Ø·Ø§Ø¦Ù","Ø§Ù„Ø®Ø¨Ø±"];
  const places = ["Ù…Ù‚Ù‡Ù‰ Ù‡Ø§Ø¯Ø¦","Ø¹ÙŠØ§Ø¯Ø© Ø®Ø§ØµØ©","Ù…ÙƒØªØ¨ Ù…Ø­Ø§Ø³Ø¨Ø©","Ø´Ù‚Ø© Ù…ÙØ±ÙˆØ´Ø©","ÙˆØ±Ø´Ø© Ø³ÙŠØ§Ø±Ø§Øª","Ù…Ø³ØªÙˆØ¯Ø¹ ØµØºÙŠØ±","ØµØ§Ù„Ø© Ø±ÙŠØ§Ø¶Ø©","ÙÙ†Ø¯Ù‚"];
  const victims = ["Ù…Ø¯ÙŠØ±","Ø´Ø±ÙŠÙƒ","Ø²Ù…ÙŠÙ„","Ù‚Ø±ÙŠØ¨","Ø¹Ù…ÙŠÙ„","Ø¬Ø§Ø±","ØµØ¯ÙŠÙ‚ Ù‚Ø¯ÙŠÙ…","Ù…ÙˆØ¸Ù"];
  const charges = [
    "Ø³Ø±Ù‚Ø© Ø£Ù…ÙˆØ§Ù„/Ø¹Ù‡Ø¯Ø©",
    "ØªØ²ÙˆÙŠØ± Ù…Ø³ØªÙ†Ø¯ Ø±Ø³Ù…ÙŠ",
    "Ø§Ø¨ØªØ²Ø§Ø² ÙˆØªÙ‡Ø¯ÙŠØ¯",
    "Ø¥ØªÙ„Ø§Ù Ù…Ù…ØªÙ„ÙƒØ§Øª Ø¹Ù…Ø¯Ù‹Ø§",
    "Ø§Ø®ØªØ±Ø§Ù‚ Ø­Ø³Ø§Ø¨/Ø¨ÙŠØ§Ù†Ø§Øª",
    "Ø§Ø¹ØªØ¯Ø§Ø¡ Ø¨Ø§Ù„Ø¶Ø±Ø¨",
    "Ø®ÙŠØ§Ù†Ø© Ø£Ù…Ø§Ù†Ø©",
    "ØªÙ„Ø§Ø¹Ø¨ Ø¨ÙÙˆØ§ØªÙŠØ± ÙˆÙ…Ø­Ø§Ø³Ø¨Ø©"
  ];

  const emotions = ["Ø¨Ø§Ø±Ø¯ Ø¬Ø¯Ù‹Ø§","Ù…ØªÙˆØªØ± Ù„ÙƒÙ† Ø«Ø§Ø¨Øª","ÙŠØªØ¬Ù†Ø¨ Ø§Ù„Ù†Ø¸Ø±","ÙƒØ«ÙŠØ± Ø§Ù„ÙƒÙ„Ø§Ù…","ÙŠØ¶Ø­Ùƒ ÙˆÙ‚Øª ØºÙ„Ø·","ÙŠØ±ØªØ¨Ùƒ Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµØºÙŠØ±Ø©","ÙŠØ¸Ù‡Ø± ÙƒØ£Ù†Ù‡ Ø¶Ø­ÙŠØ©"];
  const tells = [
    "ÙŠØºÙŠÙ‘Ø± Ø§Ù„Ù‚ØµØ© ÙÙŠ Ù†Ù‚Ø·Ø© ØµØºÙŠØ±Ø© ÙƒÙ„ Ù…Ø±Ø©",
    "ÙŠØ°ÙƒØ± ØªÙØ§ØµÙŠÙ„ ÙƒØ«ÙŠØ±Ø© ØºÙŠØ± Ù…Ù‡Ù…Ø© ÙˆÙŠØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø£Ù‡Ù…",
    "ÙŠØ±ÙƒØ² Ø¹Ù„Ù‰ ØªØ¨Ø±ÙŠØ± Ø´Ø¹ÙˆØ±Ù‡ Ø¨Ø¯Ù„ ØªØ¨Ø±ÙŠØ± ÙØ¹Ù„Ù‡",
    "ÙŠØ³ØªØ®Ø¯Ù… Ø¬Ù…Ù„ Ø¹Ø§Ù…Ø©: (Ø£ÙƒÙŠØ¯â€¦ ÙŠÙ…ÙƒÙ†â€¦ Ù…Ø§ Ø£ØªØ°ÙƒØ±)",
    "ÙŠÙ†ÙØ¹Ù„ Ø¹Ù†Ø¯ Ø³Ø¤Ø§Ù„ Ø¨Ø³ÙŠØ·",
    "ÙŠØ­Ø§ÙˆÙ„ ÙŠÙ‚Ù„Ø¨ Ø§Ù„Ù‡Ø¬ÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ù‚Ù‚"
  ];

  const twistSoft = [
    "ÙÙŠ Ø´Ø§Ù‡Ø¯ ÙˆØ§Ø­Ø¯ ÙƒÙ„Ø§Ù…Ù‡ Ù…ØªÙ†Ø§Ù‚Ø¶",
    "ÙÙŠ ÙƒØ§Ù…ÙŠØ±Ø§ ÙÙŠÙ‡Ø§ Ø¯Ù‚ÙŠÙ‚Ø© Ù…ÙÙ‚ÙˆØ¯Ø©",
    "ÙÙŠ Ø¥ÙŠØµØ§Ù„ Ù†Ø§Ù‚Øµ Ø±Ù‚Ù…",
    "ÙÙŠ Ø±Ø³Ø§Ù„Ø© Ù…Ø­Ø°ÙˆÙØ© ØªØ±Ø¬Ø¹ Ù…Ù† Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ",
    "ÙÙŠ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ Ù…Ù‚Ø·ÙˆØ¹ Ø¢Ø®Ø±Ù‡"
  ];

  const twistHard = [
    "Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ØµØ­ÙŠØ­ Ù„ÙƒÙ† ØªÙØ³ÙŠØ±Ù‡ Ø®Ø§Ø·Ø¦",
    "ÙÙŠ Ø·Ø±Ù Ø«Ø§Ù„Ø« ÙŠØ³ØªÙÙŠØ¯ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ù†Ø©",
    "Ø§Ù„Ù…ØªÙ‡Ù… Ø¹Ù†Ø¯Ù‡ Ø³Ø¨Ø¨ ÙŠØ®Ù„ÙŠÙ‡ ÙŠÙƒØ°Ø¨ Ø­ØªÙ‰ Ù„Ùˆ Ø¨Ø±ÙŠØ¡",
    "Ø§Ù„Ù…ØªÙ‡Ù… Ù…Ø°Ù†Ø¨ Ù„ÙƒÙ† Ù…Ùˆ Ø¨Ø§Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„Ù„ÙŠ ØªØªÙˆÙ‚Ø¹Ù‡Ø§",
    "Ø§Ù„Ù…ØªÙ‡Ù… Ø¨Ø±ÙŠØ¡ Ù„ÙƒÙ† ØªØµØ±ÙØ§ØªÙ‡ ØªØ®Ù„ÙŠÙ‡ ÙŠØ¨Ø¯Ùˆ Ù…Ø°Ù†Ø¨"
  ];

  const city = invPick(rng, cities);
  const place = invPick(rng, places);
  const vic = invPick(rng, victims);
  const charge = invPick(rng, charges);

  // Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© ØªØªØ¯Ø±Ø¬: Ø¨Ø§Ù„Ø¨Ø¯Ø§ÙŠØ§Øª Ø¨Ø³ÙŠØ·Ø©ØŒ Ø¨Ø§Ù„Ù†Ù‡Ø§ÙŠØ§Øª Ø£Ø¹Ù‚Ø¯ (Ù„ÙƒÙ† ØªØ¸Ù„ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©)
  const guiltChance = (s <= 20) ? 0.55 : (s <= 60) ? 0.50 : 0.48;
  const guilty = rng() < guiltChance;

  const mood = invPick(rng, emotions);
  const tell = invPick(rng, tells);

  const soft = invPick(rng, twistSoft);
  const hard = (s >= 35) ? invPick(rng, twistHard) : "";

  const title = `Ù‚Ø¶ÙŠØ© (${s}) â€” ${charge}`;
  const timeLine =
`Ø§Ù„Ø²Ù…Ø§Ù†: Ù„ÙŠÙ„Ø© Ù…ØªØ£Ø®Ø±Ø© (Ø¨Ø¹Ø¯ 10Ù…)
Ø§Ù„Ù…ÙƒØ§Ù†: ${city} â€” ${place}
Ø§Ù„Ø·Ø±Ù Ø§Ù„Ù…ØªØ¶Ø±Ø±: ${vic}`;

  // Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø·ÙˆÙŠÙ„ (Ù„Ù„Ù…ØªÙ‡Ù…)
  const full =
`[Ù…Ù„Ù Ø§Ù„Ù…ØªÙ‡Ù… â€” Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ ÙƒØ§Ù…Ù„]
${timeLine}

Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ø¸Ø§Ù‡Ø±:
ØµØ§Ø± ØªØµØ¹ÙŠØ¯ Ù…ÙØ§Ø¬Ø¦ Ø¨Ø¹Ø¯ Ø®Ù„Ø§Ù Ø¨Ø³ÙŠØ·. ÙÙŠ ÙŠÙˆÙ…ÙŠÙ† Ù‚Ø¨Ù„ Ø§Ù„ÙˆØ§Ù‚Ø¹Ø© ÙƒØ§Ù† ÙÙŠÙ‡ ØªÙˆØªØ± ÙˆØªØ±Ø§ÙƒÙ… ÙƒÙ„Ø§Ù…ØŒ ÙˆÙÙŠ Ø§Ù„Ù„ÙŠÙ„Ø© Ù†ÙØ³Ù‡Ø§ ØµØ§Ø± Ù…ÙˆÙ‚Ù ÙƒØ£Ù†Ù‡ â€œÙŠÙ†ÙØ¬Ø±â€ Ø¯ÙØ¹Ø© ÙˆØ­Ø¯Ø©.

Ø³Ù„ÙˆÙƒÙƒ Ø§Ù„Ø¹Ø§Ù…:
Ø£Ù†Øª Ø§Ù„ÙŠÙˆÙ… Ø¸Ø§Ù‡Ø± Ø¹Ù„ÙŠÙƒ: ${mood}.
ÙˆÙÙŠÙƒ Ø¹Ø§Ø¯Ø© ÙˆÙ‚Øª Ø§Ù„Ø¶ØºØ·: ${tell}.

ØªÙØ§ØµÙŠÙ„ Ù…Ù‡Ù…Ù‘Ø© (Ø£Ø­Ø¯Ø§Ø« + Ù…Ø´Ø§Ø¹Ø± + Ø¯ÙˆØ§ÙØ¹):
- Ù‚Ø¨Ù„ Ù…Ø§ ØªÙˆØµÙ„ Ù„Ù„Ù…ÙƒØ§Ù† ÙƒØ§Ù† Ø¹Ù†Ø¯Ùƒ Ø´ÙŠØ¡ ÙŠØ´ØºÙ„Ùƒ: Ø®ÙˆÙ Ù…Ù† Ø§Ù†Ùƒ ØªÙ†ÙƒØ´Ù/Ø£Ùˆ ØªØ®Ø³Ø± Ø´ÙŠØ¡ Ù…Ù‡Ù…/Ø£Ùˆ ØªÙ†Ø±ÙØ¶.
- ÙˆÙ‚Øª Ø§Ù„ÙˆØµÙˆÙ„ ÙƒØ§Ù† ÙÙŠÙ‡ Ø´ÙŠØ¡ ØºØ±ÙŠØ¨: ${soft}.
- Ø£Ù†Øª Ù…Ø§ ØªØ­Ø¨ ØªØ¯Ø®Ù„ ÙÙŠ Ù…ÙˆØ§Ø¬Ù‡Ø© Ù…Ø¨Ø§Ø´Ø±Ø©â€¦ Ù„ÙƒÙ† Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø© Ø³ÙˆÙŠØª ØªØµØ±Ù Ø®Ù„Ø§Ùƒ ØªÙ†Ø¯Ù…/Ø£Ùˆ ØªØªÙ…Ø§Ø¯Ù‰.
- ÙÙŠ Ù„Ø­Ø¸Ø© Ø­Ø§Ø³Ù…Ø©: Ù‚Ù„Øª Ø¬Ù…Ù„Ø©/Ø³ÙˆÙŠØª ÙØ¹Ù„ ØªØ±Ùƒ Ø£Ø«Ø± ÙˆØ§Ø¶Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ.
- Ø¨Ø¹Ø¯ Ø§Ù„ÙˆØ§Ù‚Ø¹Ø© Ù…Ø¨Ø§Ø´Ø±Ø©: Ø­Ø§ÙˆÙ„Øª â€œØªØµÙ„Ù‘Ø­â€ Ø£Ùˆ â€œØªØ®ÙÙŠâ€ Ø£Ùˆ â€œØªØ¨Ø±Ø±â€ Ø¨Ø·Ø±ÙŠÙ‚Ø© ØªØ®Ù„ÙŠÙƒ ØªØ¨Ø¯Ùˆ Ø£Ø³ÙˆØ£.

Ø§Ù„ØªÙˆØªØ± Ø§Ù„Ù†ÙØ³ÙŠ:
Ø§Ù„Ù…Ø­Ù‚Ù‚ Ù„Ùˆ Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ (Ø³Ø¨Ø¨Ùƒ) Ø£ÙƒØ«Ø± Ù…Ù† (Ù‚ØµØ© Ø§Ù„ÙØ¹Ù„) Ù…Ù…ÙƒÙ† ÙŠØ·ÙŠØ­Ùƒ.  
ÙˆÙ„Ùˆ Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ Ù„Ù„Ø£Ø­Ø¯Ø§Ø« Ù…Ù…ÙƒÙ† ÙŠÙƒØ´Ù ÙˆÙŠÙ† ØµØ§Ø± Ø§Ù„Ø§Ù†ÙƒØ³Ø§Ø±.

${hard ? `ØªØ¹Ù‚ÙŠØ¯ Ù…ØªØ£Ø®Ø± (ØµØ¹ÙˆØ¨Ø© Ø£Ø¹Ù„Ù‰): ${hard}\n` : ""}

Ù…Ù…Ù†ÙˆØ¹ ØªÙ‚ÙˆÙ„ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø± Ù„Ùˆ Ø£Ù†Øª Ù…Ø°Ù†Ø¨ØŒ ÙˆÙ…Ù…Ù†ÙˆØ¹ ØªØ¨Ø§Ù„Øº Ø¨Ø§Ù„Ø¨Ø±Ø§Ø¡Ø© Ù„Ùˆ Ø£Ù†Øª Ø¨Ø±ÙŠØ¡ â€” Ø®Ù„Ùƒ ÙˆØ§Ù‚Ø¹ÙŠ ÙˆØ§Ø«Ø¨Øª Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚.
`;

  // Ù…Ù„Ø®Øµ Ù…Ø­Ù‚Ù‚ (Ø¨Ø¯ÙˆÙ† ØªÙØ³ÙŠØ± Ø¯Ø§Ø®Ù„ÙŠ)
  const brief =
`[Ù…Ù„Ù Ø§Ù„Ù…Ø­Ù‚Ù‚ â€” Ù…Ù„Ø®Øµ Ø¨Ù„Ø§ ØªÙØ³ÙŠØ±]
${timeLine}

Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø¹Ø§Ù…:
Ø®Ù„Ø§Ù Ø«Ù… ØªØµØ¹ÙŠØ¯. ÙÙŠÙ‡ â€œØ«ØºØ±Ø©â€ ÙÙŠ Ø§Ù„ØªØ³Ù„Ø³Ù„: ${soft}.

Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù„Ù‰ Ø³Ù„ÙˆÙƒ Ø§Ù„Ù…ØªÙ‡Ù…:
Ø¸Ø§Ù‡Ø± Ø¹Ù„ÙŠÙ‡: ${mood}.
Ù…Ù…ÙƒÙ† ÙŠØ¨Ø§Ù† Ø¹Ù„ÙŠÙ‡: ${tell}.

Ù†Ù‚Ø§Ø· ØªØ­Ù‚ÙŠÙ‚ Ø°ÙƒÙŠØ©:
1) Ø§Ø·Ù„Ø¨ ØªØ³Ù„Ø³Ù„ Ø²Ù…Ù†ÙŠ Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ (Ù‚Ø¨Ù„/Ø£Ø«Ù†Ø§Ø¡/Ø¨Ø¹Ø¯).
2) Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ â€œØªÙØµÙŠÙ„Ø© ÙˆØ§Ø­Ø¯Ø© Ø«Ø§Ø¨ØªØ©â€ ÙˆØ´ÙˆÙ Ù‡Ù„ ØªØªØºÙŠØ± Ù…Ø¹ Ø§Ù„Ø¶ØºØ·.
3) Ø§Ø³Ø£Ù„: Ù„ÙŠØ´ Ù‡Ø°Ø§ Ø§Ù„ØªØµØ±Ù ØµØ§Ø± Ø§Ù„Ø¢Ù† Ø¨Ø§Ù„Ø°Ø§ØªØŸ
4) Ø§Ø±Ø¨Ø· Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø¨Ø§Ù„Ù…Ù†Ø·Ù‚: Ù‡Ù„ Ø§Ù„Ø¯Ù„ÙŠÙ„ ÙŠØ«Ø¨Øª Ø§Ù„ÙØ¹Ù„ØŸ ÙˆÙ„Ø§ ÙŠØ«Ø¨Øª ÙˆØ¬ÙˆØ¯Ù‡ ÙÙ‚Ø·ØŸ

Ù‡Ø¯ÙÙƒ:
ØªØ­ÙƒÙ… Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„ØªØ±Ø§Ø¨Ø· + Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¯ÙˆØ§ÙØ¹ + Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµØºÙŠØ±Ø©.
`;

  const truth =
guilty
? `âœ… Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©: Ø£Ù†Øª Ù…Ø°Ù†Ø¨.\nØ§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ: ÙƒØ§Ù† Ø¹Ù†Ø¯Ùƒ Ø¯Ø§ÙØ¹ ÙˆØ§Ø¶Ø­ (Ù…ØµÙ„Ø­Ø©/Ø®ÙˆÙ/Ø§Ù†ØªÙ‚Ø§Ù…) ÙˆØ®Ø·ÙˆØª Ø®Ø·ÙˆØ© Ø²ÙŠØ§Ø¯Ø© ÙˆØ­Ø§ÙˆÙ„Øª ØªØºØ·ÙŠÙ‡Ø§.`
: `âŒ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©: Ø£Ù†Øª Ø¨Ø±ÙŠØ¡.\nÙ„ÙƒÙ†: ÙÙŠ ØªØµØ±ÙØ§ØªÙƒ Ø´ÙŠØ¡ ÙŠØ®Ù„Ù‘ÙŠ Ø§Ù„Ù†Ø§Ø³ ØªØ´Ùƒ ÙÙŠÙƒ (Ø®ÙˆÙ/Ø³ØªØ±/Ø­Ø±Ø¬)ØŒ ÙˆÙ‡Ø°Ø§ Ø§Ù„Ù„ÙŠ ÙŠØµØ¹Ù‘Ø¨ Ø§Ù„Ù‚Ø¶ÙŠØ©.`;

  return { title, charge, brief, full, truth, guilty };
}

function invApplyUI(opt6){
  const stage = invClamp(parseInt(opt6?.stage||1,10), 1, 100);
  const maxDone = Math.max(0, parseInt(opt6?.maxDone||0,10));
  const decided = !!opt6?.decided;

  const invName = invInvestigatorForStage(stage);
  const accName = invAccusedForStage(stage);

  const isInv = invAmIInvestigator(stage);
  const isAcc = invAmIAccused(stage);

  const c = invGenerateCase(stage);

  if(invStageBadge) invStageBadge.textContent = `Ø§Ù„Ù‚Ø¶ÙŠØ©: ${stage} / 100`;
  if(invRoleBadge) invRoleBadge.textContent = `Ø§Ù„Ø¯ÙˆØ±: ğŸ‘®â€â™‚ï¸ Ø§Ù„Ù…Ø­Ù‚Ù‚ = ${invName} | ğŸ§‘â€âš–ï¸ Ø§Ù„Ù…ØªÙ‡Ù… = ${accName}`;

  if(invJudgeLine) invJudgeLine.textContent = opt6?.judgeLine || "ğŸŸâš–ï¸ Ø§ÙØªØ­ÙˆØ§ Ù…Ù„ÙØ§ØªÙƒÙ…â€¦ Ø§Ù„ØªØ­Ù‚ÙŠÙ‚ Ø­Ø±.";
  if(invCaseTitle) invCaseTitle.textContent = c.title;
  if(invCharge) invCharge.textContent = c.charge;

  // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
  if(invBrief) invBrief.textContent = isInv ? c.brief : "ğŸ”’ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù„Ù„Ù…Ø­Ù‚Ù‚ ÙÙ‚Ø·.";
  if(invFull) invFull.textContent  = isAcc ? c.full  : "ğŸ”’ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù„Ù„Ù…ØªÙ‡Ù… ÙÙ‚Ø·.";

  // Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ù…ØªÙ‡Ù…
  if(invTruthBox) invTruthBox.style.display = isAcc ? "block" : "none";
  if(invTruth) invTruth.textContent = isAcc ? c.truth : "";

  // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙƒÙ…: Ù„Ù„Ù…Ø­Ù‚Ù‚ ÙÙ‚Ø· + ØªØªÙ‚ÙÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø±
  if(invActions) invActions.style.display = isInv ? "flex" : "none";
  if(invBtnGuilty) invBtnGuilty.disabled = decided;
  if(invBtnInnocent) invBtnInnocent.disabled = decided;

  // Ø§Ù„Ø­Ø§Ù„Ø© / Ø§Ù„Ù†ØªÙŠØ¬Ø©
  if(invResult){
    if(decided){
      invResult.textContent = opt6?.reveal || "ğŸŸâš–ï¸ ØªÙ… Ø§Ù„Ø­ÙƒÙ…â€¦";
    }else{
      invResult.textContent = "ğŸ™ï¸ Ø§Ù„ØªØ­Ù‚ÙŠÙ‚ Ù…ÙØªÙˆØ­â€¦ Ø§Ø³Ø£Ù„/Ø§Ø¶ØºØ·/Ø§Ø³ÙƒØªâ€¦ ÙˆÙÙŠ Ø£ÙŠ Ù„Ø­Ø¸Ø© Ø§Ø­ÙƒÙ… (Ù…Ø°Ù†Ø¨/Ø¨Ø±ÙŠØ¡).";
    }
  }

  if(invLockLine){
    const lockMsg = (maxDone <= 0)
      ? "ğŸ”’ Ù„Ø§ Ø±Ø¬Ø¹Ø©: Ù…Ø§ ÙÙŠÙ‡ Ù‚Ø¶Ø§ÙŠØ§ Ù…Ù†ØªÙ‡ÙŠØ© Ø¨Ø¹Ø¯."
      : `ğŸ”’ Ù„Ø§ Ø±Ø¬Ø¹Ø©: Ø¢Ø®Ø± Ù‚Ø¶ÙŠØ© Ù…Ù†ØªÙ‡ÙŠØ© = ${maxDone}. Ø£ÙŠ Ø±Ø¬ÙˆØ¹ Ù…Ø³ØªØ­ÙŠÙ„ Ø­ØªÙ‰ Ø¨Ø¹Ø¯ Ø£ÙŠØ§Ù….`;
    invLockLine.textContent = lockMsg;
  }

  if(invStatus){
    invStatus.textContent =
      `Live âœ… | Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${(opt6?.updatedBy||"â€”")}\n` +
      `Stage=${stage} | maxDone=${maxDone} | decided=${decided ? "âœ…" : "â€”"}`;
  }
}

async function invForceNoBack(opt6){
  if(!currentName) return;

  const stage = invClamp(parseInt(opt6?.stage||1,10), 1, 100);
  const maxDone = Math.max(0, parseInt(opt6?.maxDone||0,10));

  // Ù„Ùˆ Ø­Ø§ÙˆÙ„ Ø£Ø­Ø¯ ÙŠØ±Ø¬Ø¹: Ù†Ø±Ø¬Ø¹Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„Ù„Ø£Ù…Ø§Ù…
  if(stage <= maxDone){
    // Ø§Ù„Ù‚Ø§Ø¦Ø¯: ANAS ÙÙ‚Ø·
    if(currentName !== "ANAS") return;

    const nextStage = invClamp(maxDone + 1, 1, 100);
    await pushRoomUpdate({
      "opt6invest.stage": nextStage,
      "opt6invest.decided": false,
      "opt6invest.decidedBy": "",
      "opt6invest.verdict": "",
      "opt6invest.win": null,
      "opt6invest.reveal": "",
      "opt6invest.judgeLine": "ğŸŸâš–ï¸ Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ø±Ø¬ÙˆØ¹â€¦ Ù†ÙØªØ­ Ø§Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©.",
      "opt6invest.updatedBy": currentName || "unknown"
    });
  }
}

async function invDecide(verdict){
  const opt6 = window.__invCache || {};
  const stage = invClamp(parseInt(opt6.stage||1,10), 1, 100);
  if(!invAmIInvestigator(stage)) return;     // ÙÙ‚Ø· Ø§Ù„Ù…Ø­Ù‚Ù‚ ÙŠØ­ÙƒÙ…
  if(opt6.decided) return;

  const c = invGenerateCase(stage);
  const pickGuilty = (verdict === "guilty");
  const correct = (pickGuilty === !!c.guilty);

  const reveal =
correct
? `âœ… Ø­ÙƒÙ… ØµØ­ÙŠØ­!\nğŸŸâš–ï¸ Ø§Ù„Ø³Ù…ÙƒØ©: Ø§Ù„Ù…Ø­Ù‚Ù‚ ÙƒØ³Ø¨.\n\n${c.truth}\n\nâ¡ï¸ Ù†Ù†ØªÙ‚Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©â€¦`
: `âŒ Ø­ÙƒÙ… ØºÙ„Ø·!\nğŸŸâš–ï¸ Ø§Ù„Ø³Ù…ÙƒØ©: Ø§Ù„Ù…Ø­Ù‚Ù‚ Ø®Ø³Ø±.\n\n${c.truth}\n\nâ¡ï¸ Ù†Ù†ØªÙ‚Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©â€¦`;

  // ØªØ­Ø¯ÙŠØ« Ù†Ù‡Ø§Ø¦ÙŠ
  await pushRoomUpdate({
    "opt6invest.decided": true,
    "opt6invest.decidedBy": currentName || "unknown",
    "opt6invest.verdict": verdict,
    "opt6invest.win": correct,
    "opt6invest.reveal": reveal,
    "opt6invest.judgeLine": "ğŸŸâš–ï¸ Ø§Ù„Ø­ÙƒÙ… ØµØ¯Ø±â€¦ Ù„Ø§ Ø±Ø¬Ø¹Ø©.",
    "opt6invest.updatedBy": currentName || "unknown"
  });

  // ØªÙ‚Ø¯Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø£Ù…Ø§Ù… (Ù‚Ø§Ø¦Ø¯: ANAS)
  if(currentName !== "ANAS") return;

  const maxDone = Math.max(0, parseInt(opt6.maxDone||0,10));
  const nextMax = Math.max(maxDone, stage);

  // Ù†Ù‡Ø§ÙŠØ© 100
  if(stage >= 100){
    await pushRoomUpdate({
      "opt6invest.maxDone": nextMax,
      "opt6invest.judgeLine": "ğŸ‰ğŸŸâš–ï¸ Ø®Ù„ØµØªÙˆØ§ 100 Ù‚Ø¶ÙŠØ©â€¦ Ø£Ù†ØªÙ… ÙˆØ­ÙˆØ´!",
      "opt6invest.updatedBy": currentName || "unknown"
    });
    return;
  }

  setTimeout(async ()=>{
    await pushRoomUpdate({
      "opt6invest.maxDone": nextMax,
      "opt6invest.stage": stage + 1,
      "opt6invest.decided": false,
      "opt6invest.decidedBy": "",
      "opt6invest.verdict": "",
      "opt6invest.win": null,
      "opt6invest.reveal": "",
      "opt6invest.judgeLine": "ğŸŸâš–ï¸ Ù‚Ø¶ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©â€¦ Ø§Ù„Ø¯ÙˆØ± Ø§Ù†Ù‚Ù„Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§. Ø§ÙØªØ­ÙˆØ§ Ø§Ù„Ù…Ù„ÙØ§Øª.",
      "opt6invest.updatedBy": currentName || "unknown"
    });
  }, 800);
}
	

invBtnGuilty?.addEventListener("click", ()=> invDecide("guilty"));
invBtnInnocent?.addEventListener("click", ()=> invDecide("innocent"));

/********************
* Room listener
********************/
function startRoomListener(){
if(unsubRoom) return;

unsubRoom = window.fb.onSnapshot(roomRef(), (snap)=>{
const data = snap.data() || {};
// ===== OPT6 cache + UI =====
window.__invCache = data.opt6invest || {};
invApplyUI(window.__invCache);
invForceNoBack(window.__invCache);
if(data.currentPage){
showPageLocal(data.currentPage);
}

if(data.currentMode && modeSelect.value !== data.currentMode){
modeSelect.value = data.currentMode;
CURRENT_MODE = data.currentMode;
}

if(typeof data.promptText === "string" && promptCard){
promptCard.textContent = data.promptText;
}

const by = data.lastBy || "â€”";
if(syncLine){
syncLine.textContent = `Ù…ØªØ²Ø§Ù…Ù† âœ… | Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${by} | Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${CURRENT_MODE}`;
}

// Option 2 sync
const opt2 = data.opt2 || {};

if(amkMeAs && amkOtherAs && currentName){
amkMeAs.textContent = (currentName === "ANAS") ? "LANA" : "ANAS";
amkOtherAs.textContent = (currentName === "ANAS") ? "ANAS" : "LANA";
}

if(amkHintMe) amkHintMe.textContent = "Ø§ÙƒØªØ¨ ÙƒØ£Ù†Ùƒ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠâ€¦ Ø¨Ø¶Ù…ÙŠØ±Ù‡ ÙˆÙ…Ø´Ø§Ø¹Ø±Ù‡.";
if(amkHintOther) amkHintOther.textContent = "ØªØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø­ÙØ¸ Ø§Ù„Ø§Ø«Ù†ÙŠÙ† âœ…";

if(amkQuestion){
amkQuestion.textContent = (typeof opt2.q === "string" && opt2.q) ? `â“ ${opt2.q}` : "â“ Ø§Ø¶ØºØ· (Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯) ğŸŒ¹";
}

const mine = (opt2[myKey()] || "");
const other = (opt2[otherKey()] || "");

safeSetTextareaValue(amkMe, mine);

const bothReady = !!opt2[myReadyKey()] && !!opt2[otherReadyKey()];
if(amkOther){
if(bothReady){
amkOther.value = other || "â€”";
}else{
amkOther.value = "ğŸ”’ Ù„Ù† ØªØ¸Ù‡Ø± Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ Ø­ØªÙ‰ ØªØ­ÙØ¸ÙˆÙ† Ø£Ù†ØªÙ… Ø§Ù„Ø§Ø«Ù†ÙŠÙ† ğŸ’—";
}
}

if(amkStatus){
const by2 = opt2.updatedBy || data.lastBy || "â€”";
amkStatus.textContent = `Live âœ… | Ø­ÙØ¸ Ø£Ù†Ø³: ${opt2.readyAnas ? "âœ…" : "â€”"} | Ø­ÙØ¸ Ù„Ø§Ù†Ø§: ${opt2.readyLana ? "âœ…" : "â€”"} | Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${by2}`;
}

// Option 3 sync
const opt3 = data.opt3 || {};
const stage = Math.max(1, Math.min(150, parseInt(opt3.stage||1,10)));
window.__fishStageCache = stage;
window.__fishSelectedCache = parseInt(opt3.selected ?? -1, 10);

applyFishUI(opt3);
evaluateIfNeeded(opt3);
autoNextIfNeeded(opt3);

if(fishStatus){
const who = opt3.updatedBy || data.lastBy || "â€”";
fishStatus.textContent = `Live âœ… | Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${who} | Ù…Ø±Ø­Ù„Ø©: ${stage} | Ø§Ø®ØªÙŠØ§Ø±: ${window.__fishSelectedCache}`;
}

// âœ… Option 4 sync
const opt4puz = data.opt4puz || {};
const section = (opt4puz.section === "coop") ? "coop" : "challenge";
const puzStage = clamp(parseInt(opt4puz.stage||1,10), 1, PUZ_PER_SECTION);

window.__puzSectionCache = section;
window.__puzStageCache = puzStage;
window.__puzSelCache = parseInt(opt4puz.sel ?? -1, 10);
window.__puzPlacedCache = opt4puz.placed || {};
window.__puzRolesCache = opt4puz.roles || {viewer:"ANAS", assembler:"LANA"};
window.__puzSolvedCache = !!opt4puz.solved;

window.__puzNextReadyAnasCache = !!opt4puz.nextReadyAnas;
window.__puzNextReadyLanaCache = !!opt4puz.nextReadyLana;
window.__puzGateStageCache = parseInt(opt4puz.gateStage||puzStage,10);

if((data.currentPage === "pageOpt4") && currentName){
puzEnsureStageFields(opt4puz);
}

puzApplyUI(opt4puz);
puzAutoAdvanceIfReady(opt4puz);

// âœ… Option 5 sync (Kitchen)
const opt5 = data.opt5kitchen || {};
window.__kitCache = opt5;

if(data.currentPage === "pageOpt5" && currentName){
kitApplyUI(opt5);
}else{
// Ø­ØªÙ‰ Ù„Ùˆ Ù…Ùˆ ÙØ§ØªØ­ Ø§Ù„ØµÙØ­Ø©ØŒ Ù†Ø­Ø¯Ù‘Ø« Ø§Ù„Ø£Ù„Ø¨ÙˆÙ… Ù„Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©
kitRenderAlbum(opt5.album);
}


}); // â† ÙŠÙ‚ÙÙ„ onSnapshot
} // âœ… ÙŠÙ‚ÙÙ„ startRoomListener

/********************
* Bind UI
********************/
document.getElementById("backHomeBtn")?.addEventListener("click", ()=> pushPage("pageHome"));
document.querySelectorAll(".backAny").forEach(b=> b.addEventListener("click", ()=> pushPage("pageHome")));

document.getElementById("btnQ")?.addEventListener("click", ()=> pushPrompt("q"));
document.getElementById("btnC")?.addEventListener("click", ()=> pushPrompt("c"));

modeSelect.addEventListener("change", async ()=>{
CURRENT_MODE = modeSelect.value || "lana1";
await pushRoomUpdate({ currentMode: CURRENT_MODE });
});

document.querySelectorAll(".opt").forEach(btn=>{
btn.addEventListener("click", ()=>{
const go = btn.getAttribute("data-go");
closeModalFn();
if(go) pushPage(go);
});
});

/********************
* Start after Firebase
********************/
(async ()=>{
await waitForFb();

window.fb.onAuthStateChanged(window.fb.auth, async (user)=>{
if(!user){
currentName = null;
topbar.classList.add("hide");
showPageLocal("pageLogin");
return;
}

const em = (user.email||"").toLowerCase();
currentName = em.startsWith("lana") ? "LANA" : "ANAS";

whoPill.textContent = `ğŸ’— Ø£Ù†Øª: ${currentName}`;
topbar.classList.remove("hide");

CURRENT_MODE = modeSelect.value || "lana1";

await ensureRoom();
startRoomListener();

pushPage("pageHome");
});

window.addEventListener("visibilitychange", ()=>{
if(document.visibilityState==="visible" && window.fb?.auth?.currentUser){
ensureRoom();
}
});
})();
/* =========================================
   LOCK SCROLL â€“ Ø­Ù„ Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù‚ÙØ²Ø© Ø§Ù„Ø¬ÙˆØ§Ù„
   ========================================= */
(function lockScrollJump(){
  let lockedY = window.scrollY || 0;

  // Ø­ÙØ¸ Ù…ÙƒØ§Ù† Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø¯Ø§Ø¦Ù…Ù‹Ø§
  window.addEventListener("scroll", () => {
    lockedY = window.scrollY || document.documentElement.scrollTop || 0;
  }, { passive:true });

  // Ù…Ù†Ø¹ submit (Ø£ÙƒØ¨Ø± Ø³Ø¨Ø¨)
  document.addEventListener("submit", e => {
    e.preventDefault();
    e.stopPropagation();
    requestAnimationFrame(() => window.scrollTo(0, lockedY));
  }, true);

  // Ù…Ù†Ø¹ Ø±ÙˆØ§Ø¨Ø· # Ø£Ùˆ Ø±ÙˆØ§Ø¨Ø· ÙØ§Ø¶ÙŠØ©
  document.addEventListener("click", e => {
    const a = e.target.closest("a");
    if(!a) return;
    const href = (a.getAttribute("href") || "").trim();
    if(href === "" || href === "#" || href.startsWith("#")){
      e.preventDefault();
      e.stopPropagation();
      requestAnimationFrame(() => window.scrollTo(0, lockedY));
    }
  }, true);

  // Ø£ÙŠ Ø²Ø± Ø¨Ø¯ÙˆÙ† type Ø®Ù„ÙŠÙ‡ button
  document.addEventListener("click", e => {
    const btn = e.target.closest("button");
    if(!btn) return;
    if(!btn.hasAttribute("type")){
      btn.type = "button";
    }
  }, true);

  // Ù…Ù†Ø¹ focus Ø§Ù„Ù„ÙŠ ÙŠØ·Ù„Ø¹ Ø§Ù„ØµÙØ­Ø©
  document.addEventListener("focusin", e => {
    const t = e.target;
    if(t && (t.tagName === "INPUT" || t.tagName === "TEXTAREA")) return;
    requestAnimationFrame(() => window.scrollTo(0, lockedY));
  }, true);

})();
document.addEventListener("submit", function(e){
  e.preventDefault();
  e.stopPropagation();
}, true);

</script>

<script>
function updateLoveCounter(){
const startDate = new Date(2025, 10, 24);
const today = new Date();
const diffTime = today.getTime() - startDate.getTime();
const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
const counterEl = document.getElementById("loveCounter");
if(counterEl){
counterEl.textContent = `ğŸ’— ${diffDays} DAY`;
}
}
updateLoveCounter();
setInterval(updateLoveCounter, 1000 * 60 * 60);
</script>
<script>
/********************
* âœ… OPTION 6: INVESTIGATION â€” 100 CASES (Live + No-back)
********************/
const invStageBadge = document.getElementById("invStageBadge");
const invRoleBadge  = document.getElementById("invRoleBadge");
const invJudgeLine  = document.getElementById("invJudgeLine");
const invCaseTitle  = document.getElementById("invCaseTitle");
const invCharge     = document.getElementById("invCharge");
const invBrief      = document.getElementById("invBrief");
const invFull       = document.getElementById("invFull");
const invTruthBox   = document.getElementById("invTruthBox");
const invTruth      = document.getElementById("invTruth");
const invActions    = document.getElementById("invActions");
const invBtnGuilty  = document.getElementById("invBtnGuilty");
const invBtnInnocent= document.getElementById("invBtnInnocent");
const invResult     = document.getElementById("invResult");
const invLockLine   = document.getElementById("invLockLine");
const invStatus     = document.getElementById("invStatus");

function invIsAnas(){ return currentName === "ANAS"; }
function invInvestigatorForStage(stage){
  // ÙŠØªØ¨Ø¯Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙƒÙ„ Ù‚Ø¶ÙŠØ©
  // Ù‚Ø¶ÙŠØ© 1: Ø§Ù„Ù…Ø­Ù‚Ù‚ ANASØŒ Ù‚Ø¶ÙŠØ© 2: Ø§Ù„Ù…Ø­Ù‚Ù‚ LANAØŒ ÙˆÙ‡ÙƒØ°Ø§
  return (stage % 2 === 1) ? "ANAS" : "LANA";
}
function invAccusedForStage(stage){
  return invInvestigatorForStage(stage) === "ANAS" ? "LANA" : "ANAS";
}
function invAmIInvestigator(stage){ return currentName === invInvestigatorForStage(stage); }
function invAmIAccused(stage){ return currentName === invAccusedForStage(stage); }

function invSeededRng(seed){
  let t = seed >>> 0;
  return function(){
    t += 0x6D2B79F5;
    let x = Math.imul(t ^ (t >>> 15), 1 | t);
    x ^= x + Math.imul(x ^ (x >>> 7), 61 | x);
    return ((x ^ (x >>> 14)) >>> 0) / 4294967296;
  };
}
function invPick(rng, arr){ return arr[Math.floor(rng()*arr.length)]; }
function invClamp(n,a,b){ return Math.max(a, Math.min(b, n)); }

function invGenerateCase(stage){
  const s = invClamp(parseInt(stage||1,10), 1, 100);
  const rng = invSeededRng(1000 + s*777);

  const cities = ["Ø¬Ø¯Ø©","Ø§Ù„Ø±ÙŠØ§Ø¶","Ø§Ù„Ø¯Ù…Ø§Ù…","Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©","Ù…ÙƒØ©","Ø£Ø¨Ù‡Ø§","Ø§Ù„Ø·Ø§Ø¦Ù","Ø§Ù„Ø®Ø¨Ø±"];
  const places = ["Ù…Ù‚Ù‡Ù‰ Ù‡Ø§Ø¯Ø¦","Ø¹ÙŠØ§Ø¯Ø© Ø®Ø§ØµØ©","Ù…ÙƒØªØ¨ Ù…Ø­Ø§Ø³Ø¨Ø©","Ø´Ù‚Ø© Ù…ÙØ±ÙˆØ´Ø©","ÙˆØ±Ø´Ø© Ø³ÙŠØ§Ø±Ø§Øª","Ù…Ø³ØªÙˆØ¯Ø¹ ØµØºÙŠØ±","ØµØ§Ù„Ø© Ø±ÙŠØ§Ø¶Ø©","ÙÙ†Ø¯Ù‚"];
  const victims = ["Ù…Ø¯ÙŠØ±","Ø´Ø±ÙŠÙƒ","Ø²Ù…ÙŠÙ„","Ù‚Ø±ÙŠØ¨","Ø¹Ù…ÙŠÙ„","Ø¬Ø§Ø±","ØµØ¯ÙŠÙ‚ Ù‚Ø¯ÙŠÙ…","Ù…ÙˆØ¸Ù"];
  const charges = [
    "Ø³Ø±Ù‚Ø© Ø£Ù…ÙˆØ§Ù„/Ø¹Ù‡Ø¯Ø©",
    "ØªØ²ÙˆÙŠØ± Ù…Ø³ØªÙ†Ø¯ Ø±Ø³Ù…ÙŠ",
    "Ø§Ø¨ØªØ²Ø§Ø² ÙˆØªÙ‡Ø¯ÙŠØ¯",
    "Ø¥ØªÙ„Ø§Ù Ù…Ù…ØªÙ„ÙƒØ§Øª Ø¹Ù…Ø¯Ù‹Ø§",
    "Ø§Ø®ØªØ±Ø§Ù‚ Ø­Ø³Ø§Ø¨/Ø¨ÙŠØ§Ù†Ø§Øª",
    "Ø§Ø¹ØªØ¯Ø§Ø¡ Ø¨Ø§Ù„Ø¶Ø±Ø¨",
    "Ø®ÙŠØ§Ù†Ø© Ø£Ù…Ø§Ù†Ø©",
    "ØªÙ„Ø§Ø¹Ø¨ Ø¨ÙÙˆØ§ØªÙŠØ± ÙˆÙ…Ø­Ø§Ø³Ø¨Ø©"
  ];

  const emotions = ["Ø¨Ø§Ø±Ø¯ Ø¬Ø¯Ù‹Ø§","Ù…ØªÙˆØªØ± Ù„ÙƒÙ† Ø«Ø§Ø¨Øª","ÙŠØªØ¬Ù†Ø¨ Ø§Ù„Ù†Ø¸Ø±","ÙƒØ«ÙŠØ± Ø§Ù„ÙƒÙ„Ø§Ù…","ÙŠØ¶Ø­Ùƒ ÙˆÙ‚Øª ØºÙ„Ø·","ÙŠØ±ØªØ¨Ùƒ Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµØºÙŠØ±Ø©","ÙŠØ¸Ù‡Ø± ÙƒØ£Ù†Ù‡ Ø¶Ø­ÙŠØ©"];
  const tells = [
    "ÙŠØºÙŠÙ‘Ø± Ø§Ù„Ù‚ØµØ© ÙÙŠ Ù†Ù‚Ø·Ø© ØµØºÙŠØ±Ø© ÙƒÙ„ Ù…Ø±Ø©",
    "ÙŠØ°ÙƒØ± ØªÙØ§ØµÙŠÙ„ ÙƒØ«ÙŠØ±Ø© ØºÙŠØ± Ù…Ù‡Ù…Ø© ÙˆÙŠØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø£Ù‡Ù…",
    "ÙŠØ±ÙƒØ² Ø¹Ù„Ù‰ ØªØ¨Ø±ÙŠØ± Ø´Ø¹ÙˆØ±Ù‡ Ø¨Ø¯Ù„ ØªØ¨Ø±ÙŠØ± ÙØ¹Ù„Ù‡",
    "ÙŠØ³ØªØ®Ø¯Ù… Ø¬Ù…Ù„ Ø¹Ø§Ù…Ø©: (Ø£ÙƒÙŠØ¯â€¦ ÙŠÙ…ÙƒÙ†â€¦ Ù…Ø§ Ø£ØªØ°ÙƒØ±)",
    "ÙŠÙ†ÙØ¹Ù„ Ø¹Ù†Ø¯ Ø³Ø¤Ø§Ù„ Ø¨Ø³ÙŠØ·",
    "ÙŠØ­Ø§ÙˆÙ„ ÙŠÙ‚Ù„Ø¨ Ø§Ù„Ù‡Ø¬ÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ù‚Ù‚"
  ];

  const twistSoft = [
    "ÙÙŠ Ø´Ø§Ù‡Ø¯ ÙˆØ§Ø­Ø¯ ÙƒÙ„Ø§Ù…Ù‡ Ù…ØªÙ†Ø§Ù‚Ø¶",
    "ÙÙŠ ÙƒØ§Ù…ÙŠØ±Ø§ ÙÙŠÙ‡Ø§ Ø¯Ù‚ÙŠÙ‚Ø© Ù…ÙÙ‚ÙˆØ¯Ø©",
    "ÙÙŠ Ø¥ÙŠØµØ§Ù„ Ù†Ø§Ù‚Øµ Ø±Ù‚Ù…",
    "ÙÙŠ Ø±Ø³Ø§Ù„Ø© Ù…Ø­Ø°ÙˆÙØ© ØªØ±Ø¬Ø¹ Ù…Ù† Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ",
    "ÙÙŠ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ Ù…Ù‚Ø·ÙˆØ¹ Ø¢Ø®Ø±Ù‡"
  ];

  const twistHard = [
    "Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ØµØ­ÙŠØ­ Ù„ÙƒÙ† ØªÙØ³ÙŠØ±Ù‡ Ø®Ø§Ø·Ø¦",
    "ÙÙŠ Ø·Ø±Ù Ø«Ø§Ù„Ø« ÙŠØ³ØªÙÙŠØ¯ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ù†Ø©",
    "Ø§Ù„Ù…ØªÙ‡Ù… Ø¹Ù†Ø¯Ù‡ Ø³Ø¨Ø¨ ÙŠØ®Ù„ÙŠÙ‡ ÙŠÙƒØ°Ø¨ Ø­ØªÙ‰ Ù„Ùˆ Ø¨Ø±ÙŠØ¡",
    "Ø§Ù„Ù…ØªÙ‡Ù… Ù…Ø°Ù†Ø¨ Ù„ÙƒÙ† Ù…Ùˆ Ø¨Ø§Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„Ù„ÙŠ ØªØªÙˆÙ‚Ø¹Ù‡Ø§",
    "Ø§Ù„Ù…ØªÙ‡Ù… Ø¨Ø±ÙŠØ¡ Ù„ÙƒÙ† ØªØµØ±ÙØ§ØªÙ‡ ØªØ®Ù„ÙŠÙ‡ ÙŠØ¨Ø¯Ùˆ Ù…Ø°Ù†Ø¨"
  ];

  const city = invPick(rng, cities);
  const place = invPick(rng, places);
  const vic = invPick(rng, victims);
  const charge = invPick(rng, charges);

  // Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© ØªØªØ¯Ø±Ø¬: Ø¨Ø§Ù„Ø¨Ø¯Ø§ÙŠØ§Øª Ø¨Ø³ÙŠØ·Ø©ØŒ Ø¨Ø§Ù„Ù†Ù‡Ø§ÙŠØ§Øª Ø£Ø¹Ù‚Ø¯ (Ù„ÙƒÙ† ØªØ¸Ù„ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©)
  const guiltChance = (s <= 20) ? 0.55 : (s <= 60) ? 0.50 : 0.48;
  const guilty = rng() < guiltChance;

  const mood = invPick(rng, emotions);
  const tell = invPick(rng, tells);

  const soft = invPick(rng, twistSoft);
  const hard = (s >= 35) ? invPick(rng, twistHard) : "";

  const title = `Ù‚Ø¶ÙŠØ© (${s}) â€” ${charge}`;
  const timeLine =
`Ø§Ù„Ø²Ù…Ø§Ù†: Ù„ÙŠÙ„Ø© Ù…ØªØ£Ø®Ø±Ø© (Ø¨Ø¹Ø¯ 10Ù…)
Ø§Ù„Ù…ÙƒØ§Ù†: ${city} â€” ${place}
Ø§Ù„Ø·Ø±Ù Ø§Ù„Ù…ØªØ¶Ø±Ø±: ${vic}`;

  // Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø·ÙˆÙŠÙ„ (Ù„Ù„Ù…ØªÙ‡Ù…)
  const full =
`[Ù…Ù„Ù Ø§Ù„Ù…ØªÙ‡Ù… â€” Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ ÙƒØ§Ù…Ù„]
${timeLine}

Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ø¸Ø§Ù‡Ø±:
ØµØ§Ø± ØªØµØ¹ÙŠØ¯ Ù…ÙØ§Ø¬Ø¦ Ø¨Ø¹Ø¯ Ø®Ù„Ø§Ù Ø¨Ø³ÙŠØ·. ÙÙŠ ÙŠÙˆÙ…ÙŠÙ† Ù‚Ø¨Ù„ Ø§Ù„ÙˆØ§Ù‚Ø¹Ø© ÙƒØ§Ù† ÙÙŠÙ‡ ØªÙˆØªØ± ÙˆØªØ±Ø§ÙƒÙ… ÙƒÙ„Ø§Ù…ØŒ ÙˆÙÙŠ Ø§Ù„Ù„ÙŠÙ„Ø© Ù†ÙØ³Ù‡Ø§ ØµØ§Ø± Ù…ÙˆÙ‚Ù ÙƒØ£Ù†Ù‡ â€œÙŠÙ†ÙØ¬Ø±â€ Ø¯ÙØ¹Ø© ÙˆØ­Ø¯Ø©.

Ø³Ù„ÙˆÙƒÙƒ Ø§Ù„Ø¹Ø§Ù…:
Ø£Ù†Øª Ø§Ù„ÙŠÙˆÙ… Ø¸Ø§Ù‡Ø± Ø¹Ù„ÙŠÙƒ: ${mood}.
ÙˆÙÙŠÙƒ Ø¹Ø§Ø¯Ø© ÙˆÙ‚Øª Ø§Ù„Ø¶ØºØ·: ${tell}.

ØªÙØ§ØµÙŠÙ„ Ù…Ù‡Ù…Ù‘Ø© (Ø£Ø­Ø¯Ø§Ø« + Ù…Ø´Ø§Ø¹Ø± + Ø¯ÙˆØ§ÙØ¹):
- Ù‚Ø¨Ù„ Ù…Ø§ ØªÙˆØµÙ„ Ù„Ù„Ù…ÙƒØ§Ù† ÙƒØ§Ù† Ø¹Ù†Ø¯Ùƒ Ø´ÙŠØ¡ ÙŠØ´ØºÙ„Ùƒ: Ø®ÙˆÙ Ù…Ù† Ø§Ù†Ùƒ ØªÙ†ÙƒØ´Ù/Ø£Ùˆ ØªØ®Ø³Ø± Ø´ÙŠØ¡ Ù…Ù‡Ù…/Ø£Ùˆ ØªÙ†Ø±ÙØ¶.
- ÙˆÙ‚Øª Ø§Ù„ÙˆØµÙˆÙ„ ÙƒØ§Ù† ÙÙŠÙ‡ Ø´ÙŠØ¡ ØºØ±ÙŠØ¨: ${soft}.
- Ø£Ù†Øª Ù…Ø§ ØªØ­Ø¨ ØªØ¯Ø®Ù„ ÙÙŠ Ù…ÙˆØ§Ø¬Ù‡Ø© Ù…Ø¨Ø§Ø´Ø±Ø©â€¦ Ù„ÙƒÙ† Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø© Ø³ÙˆÙŠØª ØªØµØ±Ù Ø®Ù„Ø§Ùƒ ØªÙ†Ø¯Ù…/Ø£Ùˆ ØªØªÙ…Ø§Ø¯Ù‰.
- ÙÙŠ Ù„Ø­Ø¸Ø© Ø­Ø§Ø³Ù…Ø©: Ù‚Ù„Øª Ø¬Ù…Ù„Ø©/Ø³ÙˆÙŠØª ÙØ¹Ù„ ØªØ±Ùƒ Ø£Ø«Ø± ÙˆØ§Ø¶Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ.
- Ø¨Ø¹Ø¯ Ø§Ù„ÙˆØ§Ù‚Ø¹Ø© Ù…Ø¨Ø§Ø´Ø±Ø©: Ø­Ø§ÙˆÙ„Øª â€œØªØµÙ„Ù‘Ø­â€ Ø£Ùˆ â€œØªØ®ÙÙŠâ€ Ø£Ùˆ â€œØªØ¨Ø±Ø±â€ Ø¨Ø·Ø±ÙŠÙ‚Ø© ØªØ®Ù„ÙŠÙƒ ØªØ¨Ø¯Ùˆ Ø£Ø³ÙˆØ£.

Ø§Ù„ØªÙˆØªØ± Ø§Ù„Ù†ÙØ³ÙŠ:
Ø§Ù„Ù…Ø­Ù‚Ù‚ Ù„Ùˆ Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ (Ø³Ø¨Ø¨Ùƒ) Ø£ÙƒØ«Ø± Ù…Ù† (Ù‚ØµØ© Ø§Ù„ÙØ¹Ù„) Ù…Ù…ÙƒÙ† ÙŠØ·ÙŠØ­Ùƒ.  
ÙˆÙ„Ùˆ Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ Ù„Ù„Ø£Ø­Ø¯Ø§Ø« Ù…Ù…ÙƒÙ† ÙŠÙƒØ´Ù ÙˆÙŠÙ† ØµØ§Ø± Ø§Ù„Ø§Ù†ÙƒØ³Ø§Ø±.

${hard ? `ØªØ¹Ù‚ÙŠØ¯ Ù…ØªØ£Ø®Ø± (ØµØ¹ÙˆØ¨Ø© Ø£Ø¹Ù„Ù‰): ${hard}\n` : ""}

Ù…Ù…Ù†ÙˆØ¹ ØªÙ‚ÙˆÙ„ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø± Ù„Ùˆ Ø£Ù†Øª Ù…Ø°Ù†Ø¨ØŒ ÙˆÙ…Ù…Ù†ÙˆØ¹ ØªØ¨Ø§Ù„Øº Ø¨Ø§Ù„Ø¨Ø±Ø§Ø¡Ø© Ù„Ùˆ Ø£Ù†Øª Ø¨Ø±ÙŠØ¡ â€” Ø®Ù„Ùƒ ÙˆØ§Ù‚Ø¹ÙŠ ÙˆØ§Ø«Ø¨Øª Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚.
`;

  // Ù…Ù„Ø®Øµ Ù…Ø­Ù‚Ù‚ (Ø¨Ø¯ÙˆÙ† ØªÙØ³ÙŠØ± Ø¯Ø§Ø®Ù„ÙŠ)
  const brief =
`[Ù…Ù„Ù Ø§Ù„Ù…Ø­Ù‚Ù‚ â€” Ù…Ù„Ø®Øµ Ø¨Ù„Ø§ ØªÙØ³ÙŠØ±]
${timeLine}

Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø¹Ø§Ù…:
Ø®Ù„Ø§Ù Ø«Ù… ØªØµØ¹ÙŠØ¯. ÙÙŠÙ‡ â€œØ«ØºØ±Ø©â€ ÙÙŠ Ø§Ù„ØªØ³Ù„Ø³Ù„: ${soft}.

Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ù„Ù‰ Ø³Ù„ÙˆÙƒ Ø§Ù„Ù…ØªÙ‡Ù…:
Ø¸Ø§Ù‡Ø± Ø¹Ù„ÙŠÙ‡: ${mood}.
Ù…Ù…ÙƒÙ† ÙŠØ¨Ø§Ù† Ø¹Ù„ÙŠÙ‡: ${tell}.

Ù†Ù‚Ø§Ø· ØªØ­Ù‚ÙŠÙ‚ Ø°ÙƒÙŠØ©:
1) Ø§Ø·Ù„Ø¨ ØªØ³Ù„Ø³Ù„ Ø²Ù…Ù†ÙŠ Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ (Ù‚Ø¨Ù„/Ø£Ø«Ù†Ø§Ø¡/Ø¨Ø¹Ø¯).
2) Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ â€œØªÙØµÙŠÙ„Ø© ÙˆØ§Ø­Ø¯Ø© Ø«Ø§Ø¨ØªØ©â€ ÙˆØ´ÙˆÙ Ù‡Ù„ ØªØªØºÙŠØ± Ù…Ø¹ Ø§Ù„Ø¶ØºØ·.
3) Ø§Ø³Ø£Ù„: Ù„ÙŠØ´ Ù‡Ø°Ø§ Ø§Ù„ØªØµØ±Ù ØµØ§Ø± Ø§Ù„Ø¢Ù† Ø¨Ø§Ù„Ø°Ø§ØªØŸ
4) Ø§Ø±Ø¨Ø· Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø¨Ø§Ù„Ù…Ù†Ø·Ù‚: Ù‡Ù„ Ø§Ù„Ø¯Ù„ÙŠÙ„ ÙŠØ«Ø¨Øª Ø§Ù„ÙØ¹Ù„ØŸ ÙˆÙ„Ø§ ÙŠØ«Ø¨Øª ÙˆØ¬ÙˆØ¯Ù‡ ÙÙ‚Ø·ØŸ

Ù‡Ø¯ÙÙƒ:
ØªØ­ÙƒÙ… Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„ØªØ±Ø§Ø¨Ø· + Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¯ÙˆØ§ÙØ¹ + Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµØºÙŠØ±Ø©.
`;

  const truth =
guilty
? `âœ… Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©: Ø£Ù†Øª Ù…Ø°Ù†Ø¨.\nØ§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ: ÙƒØ§Ù† Ø¹Ù†Ø¯Ùƒ Ø¯Ø§ÙØ¹ ÙˆØ§Ø¶Ø­ (Ù…ØµÙ„Ø­Ø©/Ø®ÙˆÙ/Ø§Ù†ØªÙ‚Ø§Ù…) ÙˆØ®Ø·ÙˆØª Ø®Ø·ÙˆØ© Ø²ÙŠØ§Ø¯Ø© ÙˆØ­Ø§ÙˆÙ„Øª ØªØºØ·ÙŠÙ‡Ø§.`
: `âŒ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©: Ø£Ù†Øª Ø¨Ø±ÙŠØ¡.\nÙ„ÙƒÙ†: ÙÙŠ ØªØµØ±ÙØ§ØªÙƒ Ø´ÙŠØ¡ ÙŠØ®Ù„Ù‘ÙŠ Ø§Ù„Ù†Ø§Ø³ ØªØ´Ùƒ ÙÙŠÙƒ (Ø®ÙˆÙ/Ø³ØªØ±/Ø­Ø±Ø¬)ØŒ ÙˆÙ‡Ø°Ø§ Ø§Ù„Ù„ÙŠ ÙŠØµØ¹Ù‘Ø¨ Ø§Ù„Ù‚Ø¶ÙŠØ©.`;

  return { title, charge, brief, full, truth, guilty };
}

function invApplyUI(opt6){
  const stage = invClamp(parseInt(opt6?.stage||1,10), 1, 100);
  const maxDone = Math.max(0, parseInt(opt6?.maxDone||0,10));
  const decided = !!opt6?.decided;

  const invName = invInvestigatorForStage(stage);
  const accName = invAccusedForStage(stage);

  const isInv = invAmIInvestigator(stage);
  const isAcc = invAmIAccused(stage);

  const c = invGenerateCase(stage);

  if(invStageBadge) invStageBadge.textContent = `Ø§Ù„Ù‚Ø¶ÙŠØ©: ${stage} / 100`;
  if(invRoleBadge) invRoleBadge.textContent = `Ø§Ù„Ø¯ÙˆØ±: ğŸ‘®â€â™‚ï¸ Ø§Ù„Ù…Ø­Ù‚Ù‚ = ${invName} | ğŸ§‘â€âš–ï¸ Ø§Ù„Ù…ØªÙ‡Ù… = ${accName}`;

  if(invJudgeLine) invJudgeLine.textContent = opt6?.judgeLine || "ğŸŸâš–ï¸ Ø§ÙØªØ­ÙˆØ§ Ù…Ù„ÙØ§ØªÙƒÙ…â€¦ Ø§Ù„ØªØ­Ù‚ÙŠÙ‚ Ø­Ø±.";
  if(invCaseTitle) invCaseTitle.textContent = c.title;
  if(invCharge) invCharge.textContent = c.charge;

  // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
  if(invBrief) invBrief.textContent = isInv ? c.brief : "ğŸ”’ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù„Ù„Ù…Ø­Ù‚Ù‚ ÙÙ‚Ø·.";
  if(invFull) invFull.textContent  = isAcc ? c.full  : "ğŸ”’ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù„Ù„Ù…ØªÙ‡Ù… ÙÙ‚Ø·.";

  // Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ù…ØªÙ‡Ù…
  if(invTruthBox) invTruthBox.style.display = isAcc ? "block" : "none";
  if(invTruth) invTruth.textContent = isAcc ? c.truth : "";

  // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙƒÙ…: Ù„Ù„Ù…Ø­Ù‚Ù‚ ÙÙ‚Ø· + ØªØªÙ‚ÙÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø±
  if(invActions) invActions.style.display = isInv ? "flex" : "none";
  if(invBtnGuilty) invBtnGuilty.disabled = decided;
  if(invBtnInnocent) invBtnInnocent.disabled = decided;

  // Ø§Ù„Ø­Ø§Ù„Ø© / Ø§Ù„Ù†ØªÙŠØ¬Ø©
  if(invResult){
    if(decided){
      invResult.textContent = opt6?.reveal || "ğŸŸâš–ï¸ ØªÙ… Ø§Ù„Ø­ÙƒÙ…â€¦";
    }else{
      invResult.textContent = "ğŸ™ï¸ Ø§Ù„ØªØ­Ù‚ÙŠÙ‚ Ù…ÙØªÙˆØ­â€¦ Ø§Ø³Ø£Ù„/Ø§Ø¶ØºØ·/Ø§Ø³ÙƒØªâ€¦ ÙˆÙÙŠ Ø£ÙŠ Ù„Ø­Ø¸Ø© Ø§Ø­ÙƒÙ… (Ù…Ø°Ù†Ø¨/Ø¨Ø±ÙŠØ¡).";
    }
  }

  if(invLockLine){
    const lockMsg = (maxDone <= 0)
      ? "ğŸ”’ Ù„Ø§ Ø±Ø¬Ø¹Ø©: Ù…Ø§ ÙÙŠÙ‡ Ù‚Ø¶Ø§ÙŠØ§ Ù…Ù†ØªÙ‡ÙŠØ© Ø¨Ø¹Ø¯."
      : `ğŸ”’ Ù„Ø§ Ø±Ø¬Ø¹Ø©: Ø¢Ø®Ø± Ù‚Ø¶ÙŠØ© Ù…Ù†ØªÙ‡ÙŠØ© = ${maxDone}. Ø£ÙŠ Ø±Ø¬ÙˆØ¹ Ù…Ø³ØªØ­ÙŠÙ„ Ø­ØªÙ‰ Ø¨Ø¹Ø¯ Ø£ÙŠØ§Ù….`;
    invLockLine.textContent = lockMsg;
  }

  if(invStatus){
    invStatus.textContent =
      `Live âœ… | Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${(opt6?.updatedBy||"â€”")}\n` +
      `Stage=${stage} | maxDone=${maxDone} | decided=${decided ? "âœ…" : "â€”"}`;
  }
}

async function invForceNoBack(opt6){
  if(!currentName) return;

  const stage = invClamp(parseInt(opt6?.stage||1,10), 1, 100);
  const maxDone = Math.max(0, parseInt(opt6?.maxDone||0,10));

  // Ù„Ùˆ Ø­Ø§ÙˆÙ„ Ø£Ø­Ø¯ ÙŠØ±Ø¬Ø¹: Ù†Ø±Ø¬Ø¹Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„Ù„Ø£Ù…Ø§Ù…
  if(stage <= maxDone){
    // Ø§Ù„Ù‚Ø§Ø¦Ø¯: ANAS ÙÙ‚Ø·
    if(currentName !== "ANAS") return;

    const nextStage = invClamp(maxDone + 1, 1, 100);
    await pushRoomUpdate({
      "opt6invest.stage": nextStage,
      "opt6invest.decided": false,
      "opt6invest.decidedBy": "",
      "opt6invest.verdict": "",
      "opt6invest.win": null,
      "opt6invest.reveal": "",
      "opt6invest.judgeLine": "ğŸŸâš–ï¸ Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ø±Ø¬ÙˆØ¹â€¦ Ù†ÙØªØ­ Ø§Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©.",
      "opt6invest.updatedBy": currentName || "unknown"
    });
  }
}

async function invDecide(verdict){
  const opt6 = window.__invCache || {};
  const stage = invClamp(parseInt(opt6.stage||1,10), 1, 100);
  if(!invAmIInvestigator(stage)) return;     // ÙÙ‚Ø· Ø§Ù„Ù…Ø­Ù‚Ù‚ ÙŠØ­ÙƒÙ…
  if(opt6.decided) return;

  const c = invGenerateCase(stage);
  const pickGuilty = (verdict === "guilty");
  const correct = (pickGuilty === !!c.guilty);

  const reveal =
correct
? `âœ… Ø­ÙƒÙ… ØµØ­ÙŠØ­!\nğŸŸâš–ï¸ Ø§Ù„Ø³Ù…ÙƒØ©: Ø§Ù„Ù…Ø­Ù‚Ù‚ ÙƒØ³Ø¨.\n\n${c.truth}\n\nâ¡ï¸ Ù†Ù†ØªÙ‚Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©â€¦`
: `âŒ Ø­ÙƒÙ… ØºÙ„Ø·!\nğŸŸâš–ï¸ Ø§Ù„Ø³Ù…ÙƒØ©: Ø§Ù„Ù…Ø­Ù‚Ù‚ Ø®Ø³Ø±.\n\n${c.truth}\n\nâ¡ï¸ Ù†Ù†ØªÙ‚Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©â€¦`;

  // ØªØ­Ø¯ÙŠØ« Ù†Ù‡Ø§Ø¦ÙŠ
  await pushRoomUpdate({
    "opt6invest.decided": true,
    "opt6invest.decidedBy": currentName || "unknown",
    "opt6invest.verdict": verdict,
    "opt6invest.win": correct,
    "opt6invest.reveal": reveal,
    "opt6invest.judgeLine": "ğŸŸâš–ï¸ Ø§Ù„Ø­ÙƒÙ… ØµØ¯Ø±â€¦ Ù„Ø§ Ø±Ø¬Ø¹Ø©.",
    "opt6invest.updatedBy": currentName || "unknown"
  });

  // ØªÙ‚Ø¯Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø£Ù…Ø§Ù… (Ù‚Ø§Ø¦Ø¯: ANAS)
  if(currentName !== "ANAS") return;

  const maxDone = Math.max(0, parseInt(opt6.maxDone||0,10));
  const nextMax = Math.max(maxDone, stage);

  // Ù†Ù‡Ø§ÙŠØ© 100
  if(stage >= 100){
    await pushRoomUpdate({
      "opt6invest.maxDone": nextMax,
      "opt6invest.judgeLine": "ğŸ‰ğŸŸâš–ï¸ Ø®Ù„ØµØªÙˆØ§ 100 Ù‚Ø¶ÙŠØ©â€¦ Ø£Ù†ØªÙ… ÙˆØ­ÙˆØ´!",
      "opt6invest.updatedBy": currentName || "unknown"
    });
    return;
  }

  setTimeout(async ()=>{
    await pushRoomUpdate({
      "opt6invest.maxDone": nextMax,
      "opt6invest.stage": stage + 1,
      "opt6invest.decided": false,
      "opt6invest.decidedBy": "",
      "opt6invest.verdict": "",
      "opt6invest.win": null,
      "opt6invest.reveal": "",
      "opt6invest.judgeLine": "ğŸŸâš–ï¸ Ù‚Ø¶ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©â€¦ Ø§Ù„Ø¯ÙˆØ± Ø§Ù†Ù‚Ù„Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§. Ø§ÙØªØ­ÙˆØ§ Ø§Ù„Ù…Ù„ÙØ§Øª.",
      "opt6invest.updatedBy": currentName || "unknown"
    });
  }, 800);
}

invBtnGuilty?.addEventListener("click", ()=> invDecide("guilty"));
invBtnInnocent?.addEventListener("click", ()=> invDecide("innocent"));	
	// ===== FIX MOBILE AUTO SCROLL =====
document.addEventListener('click', (e) => {
  const el = e.target.closest('button, a');
  if (!el) return;

  if (el.tagName === 'A' && el.getAttribute('href') === '#') {
    e.preventDefault();
  }
}, true);
window.addEventListener("beforeunload", () => {
try {
if (window.fb?.auth?.currentUser) {
window.fb.signOut(window.fb.auth);
}
} catch (e) {}
});
</script>

</body>
</html>

















